{"version":3,"sources":["assets\\Scripts\\Game\\mapmove.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAM,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAAuC,6BAAY;IAAnD;QAAA,qEAyHC;QAtHG,YAAM,GAAW,IAAI,CAAC;QAEtB,UAAI,GAAU,IAAI,CAAC,CAAA,WAAW;QAC9B,YAAM,GAAS,IAAI,CAAA;QAEnB,cAAQ,GAAC,IAAI,CAAA;;IAiHjB,CAAC;IAhHG,0BAAM,GAAN;QACI,OAAM;QACN,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;QAC/B,+BAA+B;QAC/B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAC,CAAC,CAAC,CAAC,CAAC;QAC/K,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;IACxE,CAAC;IAED,8BAAU,GAAV,UAAW,KAAK;QAEZ,IAAI,OAAO,GAAG,KAAK,CAAC,UAAU,EAAE,CAAC;QACjC,IAAI,OAAO,CAAC,MAAM,IAAI,CAAC,EAAE;YACrB,OAAM;YACN,IAAI,MAAM,GAAG,OAAO,CAAC,CAAC,CAAC,EACnB,MAAM,GAAG,OAAO,CAAC,CAAC,CAAC,EACnB,MAAM,GAAG,MAAM,CAAC,QAAQ,EAAE,EAC1B,MAAM,GAAG,MAAM,CAAC,QAAQ,EAAE,CAAC;YAE/B,uBAAuB;YACvB,IAAI,WAAW,GAAG,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC;YACzE,IAAI,WAAW,GAAG,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC;YAEzE,eAAe;YACf,WAAW,GAAG,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC,CAAC,CAAC;YAClD,WAAW,GAAG,EAAE,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC,EAAE,WAAW,CAAC,CAAC,CAAC,CAAC;YAElD,iDAAiD;YACjD,IAAI,SAAS,GAAG,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC/C,IAAI,SAAS,GAAG,WAAW,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAE/C,YAAY;YACZ,IAAI,OAAO,GAAG,CAAC,SAAS,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YAC9C,IAAI,OAAO,GAAG,CAAC,SAAS,CAAC,CAAC,GAAG,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YAE9C,gBAAgB;YAChB,IAAI,OAAO,GAAG,OAAO,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YAChE,IAAI,OAAO,GAAG,OAAO,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YAEjE,UAAU;YACV,IAAI,OAAO,GAAG,CAAC,WAAW,CAAC,CAAC,GAAG,WAAW,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YAClD,IAAI,OAAO,GAAG,CAAC,WAAW,CAAC,CAAC,GAAG,WAAW,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;YAElD,kBAAkB;YAClB,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,OAAO,CAAC;YAC9B,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,OAAO,CAAC;YAE9B,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,OAAO,CAAC;YACxB,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,OAAO,CAAC;YAExB,iFAAiF;YACjF,8EAA8E;YAC9E,8DAA8D;YAC9D,qCAAqC;YAErC,IAAI;YACJ,IAAI,WAAW,GAAG,WAAW,CAAC,GAAG,CAAC,WAAW,CAAC,CAAA;YAC9C,IAAI,QAAQ,GAAG,WAAW,CAAA,CAAA,4CAA4C;YAEtE,IAAI,QAAQ,GAAG,MAAM,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;YACjC,IAAI,KAAK,GAAE,QAAQ,CAAA,CAAA,mCAAmC;YACtD,IAAI,KAAK,GAAG,CAAC,CAAC;YACd,IAAI,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE;gBAC7C,KAAK,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;aACnE;iBACI;gBACD,KAAK,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,CAAC,GAAG,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;aACnE;YAED,IAAG,KAAK,GAAC,CAAC,EAAC;gBACP,KAAK,GAAC,CAAC,CAAA;aACV;YACD,IAAG,KAAK,GAAC,CAAC,EAAC;gBACP,KAAK,GAAC,CAAC,CAAA;aACV;YACD,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,KAAK,GAAG,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC;YAC9C,SAAS;YACT,IAAI,CAAC,QAAQ,GAAG,EAAE,CAAC,EAAE,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;SAE3J;aAAM,IAAI,OAAO,CAAC,MAAM,IAAI,CAAC,EAAE;YAG5B,IAAI,KAAK,GAAG,KAAK,CAAC,QAAQ,EAAE,CAAC;YAC7B,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC;YACzB,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC;YACzB,QAAQ;YACR,IAAI,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;YACjD,IAAI,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;YAClD,IAAI,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;YACjD,IAAI,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;YAEpD,IAAI,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC;YACzC,IAAI,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC;YAE3C,IAAI;YACJ,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,YAAY,GAAG,QAAQ,EAAE;gBACzC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,QAAQ,GAAG,YAAY,CAAC;aAC3C;YACD,IAAI;YACJ,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,YAAY,GAAG,SAAS,EAAE;gBAC1C,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,SAAS,GAAG,YAAY,CAAC;aAC5C;YACD,IAAI;YACJ,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,aAAa,GAAG,OAAO,EAAE;gBACzC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,OAAO,GAAG,aAAa,CAAC;aAC3C;YACD,IAAI;YACJ,IAAI,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,aAAa,GAAG,UAAU,EAAE;gBAC5C,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,UAAU,GAAG,aAAa,CAAC;aAC9C;SAEJ;IACL,CAAC;IArHD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;6CACI;IAEtB;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;2CACC;IALF,SAAS;QAD7B,OAAO;OACa,SAAS,CAyH7B;IAAD,gBAAC;CAzHD,AAyHC,CAzHsC,EAAE,CAAC,SAAS,GAyHlD;kBAzHoB,SAAS","file":"","sourceRoot":"/","sourcesContent":["const {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Tutorials extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    target:cc.Node = null;\r\n    @property(cc.Node)\r\n    zone:cc.Node= null;// 宽高就是拖拽区域\r\n    parent:cc.Node=null\r\n\r\n    bgOrigin=null\r\n    onLoad() {\r\n        return\r\n        this.parent = this.node.parent;\r\n        // this.bgOrigin = cc.v2(0, 0);\r\n        this.bgOrigin = this.target.position.sub(cc.v3(this.target.width * this.target.anchorX * this.target.scaleX, this.target.height * this.target.anchorY * this.target.scaleY,0));\r\n        this.target.on(cc.Node.EventType.TOUCH_MOVE, this._touchMove, this);\r\n    }\r\n\r\n    _touchMove(event) {\r\n\r\n        let touches = event.getTouches();\r\n        if (touches.length >= 2) {\r\n            return  \r\n            let touch1 = touches[0],\r\n                touch2 = touches[1],\r\n                delta1 = touch1.getDelta(),\r\n                delta2 = touch2.getDelta();\r\n\r\n            // 得到当前两触摸点 转到parent下坐标\r\n            let touchPoint1 = this.parent.convertToNodeSpaceAR(touch1.getLocation());\r\n            let touchPoint2 = this.parent.convertToNodeSpaceAR(touch2.getLocation());\r\n\r\n            // 转换为坐标 进行向量计算\r\n            touchPoint1 = cc.v2(touchPoint1.x, touchPoint1.y);\r\n            touchPoint2 = cc.v2(touchPoint2.x, touchPoint2.y);\r\n\r\n            // 两触摸点与原点的差向量，pointVec1和pointVec2是相对于bgSprite的位置\r\n            let pointVec1 = touchPoint1.sub(this.bgOrigin);\r\n            let pointVec2 = touchPoint2.sub(this.bgOrigin);\r\n\r\n            // 两触摸点的相对中点\r\n            let relMidx = (pointVec1.x + pointVec2.x) / 2;\r\n            let relMidy = (pointVec1.y + pointVec2.y) / 2;\r\n\r\n            // 计算bgSprite的锚点\r\n            let anchorX = relMidx / (this.target.width * this.target.scale);\r\n            let anchorY = relMidy / (this.target.height * this.target.scale);\r\n\r\n            // 相对屏幕的中点\r\n            let absMidx = (touchPoint2.x + touchPoint1.x) / 2;\r\n            let absMidy = (touchPoint2.y + touchPoint1.y) / 2;\r\n\r\n            // 重设bgSprite锚点和位置\r\n            this.target.anchorX = anchorX;\r\n            this.target.anchorY = anchorY;\r\n\r\n            this.target.x = absMidx;\r\n            this.target.y = absMidy;\r\n\r\n            // this.startPoint = cc.v2(event.getLocation().x,event.getLocation().y); //取起始点向量\r\n            // this.endPoint = cc.v2(event.getLocation().x,event.getLocation().y); //取终点向量\r\n            // let vec = this.endPoint.sub(this.startPoint); //向量相减，得到目标向量\r\n            // let distance = vec.mag(); //取向量的模长\r\n\r\n            //缩放\r\n            let distancevec = touchPoint2.sub(touchPoint1)\r\n            let distance = distancevec//.mag()//cc.pSub(touchPoint1, touchPoint2);\r\n\r\n            let deltavec = delta2.sub(delta1)\r\n            let delta =deltavec//.mag() //cc.pSub(delta1, delta2);\r\n            let scale = 1;\r\n            if (Math.abs(distance.x) > Math.abs(distance.y)) {\r\n                scale = (distance.x + delta.x) / distance.x * this.target.scale;\r\n            }\r\n            else {\r\n                scale = (distance.y + delta.y) / distance.y * this.target.scale;\r\n            }\r\n\r\n            if(scale<1){\r\n                scale=1\r\n            }\r\n            if(scale>2){\r\n                scale=2\r\n            }\r\n            this.target.scale = scale < 0.1 ? 0.1 : scale;\r\n            // 更新原点位置\r\n            this.bgOrigin = cc.v2(absMidx, absMidy).sub(cc.v2(this.target.width * anchorX * this.target.scaleX, this.target.height * anchorY * this.target.scaleY));\r\n\r\n        } else if (touches.length == 1) {\r\n\r\n            \r\n            let delta = event.getDelta();\r\n            this.target.x += delta.x;\r\n            this.target.y += delta.y;\r\n            //判断左边距离\r\n            let zoneLeft = this.zone.x - this.zone.width / 2;\r\n            let zoneRight = this.zone.x + this.zone.width / 2;\r\n            let zoneTop = this.zone.y + this.zone.height / 2;\r\n            let zoneBottom = this.zone.y - this.zone.height / 2;\r\n\r\n            let halfMapWidth = this.target.width / 2;\r\n            let halfMapHeight = this.target.height / 2;\r\n\r\n            //左边\r\n            if (this.target.x - halfMapWidth > zoneLeft) {\r\n                this.target.x = zoneLeft + halfMapWidth;\r\n            }\r\n            //右边\r\n            if (this.target.x + halfMapWidth < zoneRight) {\r\n                this.target.x = zoneRight - halfMapWidth;\r\n            }\r\n            //上边\r\n            if (this.target.y + halfMapHeight < zoneTop) {\r\n                this.target.y = zoneTop - halfMapHeight;\r\n            }\r\n            //下边\r\n            if (this.target.y - halfMapHeight > zoneBottom) {\r\n                this.target.y = zoneBottom + halfMapHeight;\r\n            }\r\n\r\n        }\r\n    }\r\n}"]}