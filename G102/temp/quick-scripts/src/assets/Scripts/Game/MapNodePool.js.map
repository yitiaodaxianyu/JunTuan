{"version":3,"sources":["assets\\Scripts\\Game\\MapNodePool.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import WXManagerEX from \"../../startscene/WXManagerEX\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\n/**动态对象池*/\r\nexport default class MapNodePool extends cc.Component {\r\n\r\n    map_node_pools: Map<number,cc.NodePool>=null;\r\n    map_prefabs: Map<number,cc.Prefab>=null;\r\n    preload_id:number[]=[];\r\n\r\n    protected onLoad(): void {\r\n        this.map_node_pools=new Map<number,cc.NodePool>();\r\n        this.map_prefabs=new Map<number,cc.Prefab>();\r\n        this.preload_id=new Array();\r\n    }\r\n\r\n    /**根据id和资源目录 新建一个对象池,返回是否需要加载*/\r\n    protected addNodePool(id:number,path:string,initCount:number,loadCallback?:Function):boolean{\r\n        //如果已经添加了，那么就不继续添加了\r\n       \r\n        if(this.map_node_pools.has(id)){\r\n            if(loadCallback){\r\n                loadCallback();\r\n            }\r\n            return false;\r\n        }\r\n\r\n        if(this.preload_id.includes(id)){\r\n            return false;\r\n        }\r\n\r\n        this.preload_id.push(id);\r\n      \r\n        WXManagerEX.getInstance().resourcesBundle.load(path,cc.Prefab,(error: Error, assets:cc.Prefab)=> {\r\n            if(error){\r\n                console.log(error);\r\n                return;\r\n            }\r\n            \r\n            this.map_prefabs.set(id,assets);\r\n         \r\n            let pool=new cc.NodePool();// 创建对象池\r\n            //初始先放置多少个对象到对象池\r\n            for(let i=0; i<initCount; ++i){\r\n                let node = cc.instantiate(assets); // 创建节点\r\n                pool.put(node);// 通过 put 接口放入对象池\r\n                this.map_node_pools.set(id,pool); //把对象池放进map对象\r\n            }\r\n            if(loadCallback){\r\n                loadCallback(pool.get());\r\n            }\r\n        });\r\n\r\n        return true;\r\n    }\r\n    /**根据id获得一个对象节点*/\r\n    protected getNodeById(id:number):cc.Node\r\n    {\r\n        let node:cc.Node = null;\r\n        //获得id对应的对象池\r\n        let pool=this.map_node_pools.get(id);\r\n        if(pool){\r\n            if (pool.size() > 0) { // 通过 size 接口判断对象池中是否有空闲的对象\r\n                node = pool.get();\r\n            } else { // 如果没有空闲对象，也就是对象池中备用对象不够时，我们就用 cc.instantiate 重新创建\r\n                node = cc.instantiate(this.map_prefabs.get(id));\r\n            }\r\n        }\r\n        return node;\r\n    }\r\n    /**根据id删除一个对象节点*/\r\n    protected destroyNode(id:number,node:cc.Node)\r\n    {\r\n        //获得id对应的对象池\r\n        let pool=this.map_node_pools.get(id);\r\n        if(pool){\r\n            // 和初始化时的方法一样，将节点放进对象池，这个方法会同时调用节点的 removeFromParent\r\n            pool.put(node);\r\n        }\r\n    }\r\n\r\n    protected onDestroy()\r\n    {\r\n        if(this.map_node_pools){\r\n            this.map_node_pools.forEach((v,k)=>{\r\n                v.clear();\r\n            });\r\n            this.map_node_pools=null;            \r\n        }\r\n        \r\n        //cc.log(cc.assetManager.assets.count);\r\n        if(this.map_prefabs){\r\n            // this.map_prefabs.forEach((v,k)=>{\r\n                \r\n            //     //cc.log(cc.assetManager.assets.count);\r\n            // });\r\n            this.map_prefabs=null;\r\n        }\r\n        if(this.preload_id){\r\n            this.preload_id=null;\r\n        }\r\n        //this.map_prefabs=null;\r\n        //cc.log(cc.assetManager.assets.count);\r\n    }\r\n\r\n}\r\n"]}