{"version":3,"sources":["assets\\Scripts\\Game\\Move.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameState } from \"../Constants\";\r\nimport GameManager from \"../GameManager\";\r\nimport { GameEffectId, GameEffectsManager } from \"./GameEffectsManager\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Move extends cc.Component {\r\n\r\n    move_speed:number=320;\r\n    move_direction:number=Math.PI*3/2;\r\n\r\n    //移动的目标地点\r\n    private move_target_pos:cc.Vec2=null;\r\n    /**移动到目标地点后的回调 */\r\n    private move_end_callback:Function=null;\r\n    /**移动到城墙位置后的回调 */\r\n    private move_wall_callback:Function=null;\r\n\r\n    @property({type:cc.Prefab})\r\n    prefab_tuowei:cc.Prefab=null;\r\n    /**拖尾节点 */\r\n    tuowei_node:cc.Node=null;\r\n\r\n    game_effect_id:GameEffectId=GameEffectId.Null;\r\n\r\n    onLoad()\r\n    {\r\n        \r\n    }\r\n\r\n    init(speed:number,dir:number,id:GameEffectId)\r\n    {\r\n        this.game_effect_id=id;\r\n        this.move_speed=speed;\r\n        this.update(0.015);\r\n        if(this.prefab_tuowei){\r\n            this.tuowei_node=cc.instantiate(this.prefab_tuowei);\r\n            this.tuowei_node.parent=this.node.parent;\r\n            this.node.zIndex=1;\r\n        }\r\n    }\r\n\r\n    private changeDir(dir:number)\r\n    {\r\n        this.move_direction=(dir+Math.PI*2)%(Math.PI*2);\r\n    }\r\n\r\n    /**设置移动的目标位置，以及到达目标后需要做的事情 */\r\n    setTargetPos(pos:cc.Vec2,endCallback:Function,wallCallback?:Function){\r\n        this.move_target_pos=pos;\r\n        this.move_end_callback=endCallback;\r\n        this.move_wall_callback=wallCallback;\r\n        this.update(0.015);\r\n    }\r\n\r\n    update (dt) {\r\n        if(GameManager.getInstance().cur_game_state!=GameState.Game_Playing)\r\n        return;\r\n        let prevPos=this.node.getPosition();\r\n        let disX=this.node.x;\r\n        let disY=this.node.y;\r\n        if(this.move_target_pos){\r\n            let speed=this.move_speed*dt;\r\n            let offsetPos=this.move_target_pos.sub(this.node.getPosition());\r\n            if(offsetPos.mag()<speed)\r\n            {\r\n                if(this.move_end_callback){\r\n                    this.destroySelf();\r\n                    this.move_end_callback();\r\n                    this.move_end_callback=null;\r\n                }\r\n            }else\r\n            {\r\n                let pi2=Math.PI*2;\r\n                this.move_direction=(Math.atan2(offsetPos.y,offsetPos.x)+pi2)%pi2;\r\n                disX+=speed*Math.cos(this.move_direction);\r\n                disY+=speed*Math.sin(this.move_direction);\r\n            }\r\n        }\r\n        this.setDirection(this.move_direction);\r\n        this.node.x=disX;\r\n        this.node.y=disY;\r\n        if(this.move_wall_callback && disY<=GameManager.getInstance().enemy_att_y){\r\n            this.destroySelf();\r\n            this.move_wall_callback();\r\n            this.move_wall_callback=null;\r\n        }\r\n        if(this.tuowei_node){\r\n            let pos=this.node.getPosition();\r\n            //添加在子弹前面\r\n            let offsetPos=pos.sub(prevPos);\r\n            let distance=offsetPos.mag()*4;\r\n            let dir=Math.atan2(offsetPos.y,offsetPos.x);\r\n            let xx=pos.x+Math.cos(dir)*distance;\r\n            let yy=pos.y+Math.sin(dir)*distance;\r\n            this.tuowei_node.setPosition(cc.v2(xx,yy));\r\n        }\r\n    }\r\n\r\n    destroySelf()\r\n    {\r\n        GameEffectsManager.getInstance().destroyGameEffectById(this.game_effect_id,this.node);\r\n        if(this.tuowei_node){            \r\n            let dt=this.tuowei_node.getComponent(cc.MotionStreak).fadeTime;\r\n            cc.tween(this.tuowei_node).delay(dt/10).removeSelf().start();\r\n            this.tuowei_node=null;\r\n        }\r\n    }\r\n\r\n    setDirection(dir:number)\r\n    {\r\n        this.move_direction=dir;\r\n        this.node.angle=180*dir/Math.PI+90;\r\n    }\r\n\r\n}\r\n"]}