{"version":3,"sources":["assets\\Scripts\\Maze\\MazeLeaseUi.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport GameManager from \"../GameManager\";\r\nimport { LevelManager } from \"../Level/LevelManager\";\r\nimport { Follow_Type } from \"../multiLanguage/FollowConstants\";\r\nimport FollowManager from \"../multiLanguage/FollowManager\";\r\nimport LanguageManager from \"../multiLanguage/LanguageManager\";\r\nimport { LeaseType, PetInfo } from \"../Pet/PetConfig\";\r\nimport { PetManager } from \"../Pet/PetManager\";\r\nimport { SoundIndex } from \"../Sound/AudioConstants\";\r\nimport MyTool from \"../Tools/MyTool\";\r\nimport UIComponent from \"../UI/UIComponent\";\r\nimport { RoguePetsLeaseManager } from \"./Data/RoguePetsLease\";\r\nimport { MazeManager } from \"./MazeManager\";\r\nimport MazePetItem from \"./MazePetItem\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class MazeLeaseUi extends UIComponent {\r\n\r\n    @property(cc.Prefab)\r\n    pet_item: cc.Prefab = null;\r\n\r\n     /**格子id */\r\n    box_id:number=10011;\r\n\r\n    select_index:number=-1;\r\n    is_can_go:boolean=false;\r\n    private pet_list:Array<PetInfo>=[];\r\n\r\n    initData (id:number,isCanGo:boolean) {\r\n        this.box_id=id;\r\n        this.is_can_go=isCanGo;\r\n        this.initUi();\r\n    }\r\n\r\n    initUi () {\r\n        // let ll=PetManager.getInstance().getDeepPetList();\r\n        let petList=[];\r\n        // ll.forEach((v)=>{\r\n        //     petList.push(cc.instantiate(v));\r\n        // })        \r\n        //重新排列一下，等级排列\r\n        petList.sort((a:PetInfo,b:PetInfo)=>{\r\n            return b.pet_level-a.pet_level;\r\n        });        \r\n        let totalLevel=0;\r\n        let totalNum=0;\r\n        let len=petList.length;\r\n        if(len<=0){\r\n            return;\r\n        }\r\n        for(let i=0; i<len; i++){\r\n            if(i<4){\r\n                totalLevel+=petList[i].pet_level;\r\n                totalNum++;\r\n            }else{\r\n                break;\r\n            }\r\n        }\r\n        let userLevel=Math.round(totalLevel/totalNum);\r\n        let randPetList=MazeManager.getInstance().getRandPetList(this.box_id);\r\n        if(randPetList.length>0){\r\n            this.useOldList(randPetList,userLevel);\r\n        }else{\r\n            this.initPetList(userLevel);\r\n        }\r\n        this.node.getChildByName('btnYes').active=this.is_can_go;\r\n    }\r\n\r\n    initPetList(userLevel:number){\r\n        \r\n        let jsonData=RoguePetsLeaseManager.getInstance().getJsonRoguePetsLease(LevelManager.getInstance().getFinishChapter());\r\n        let list=this.node.getChildByName('list');\r\n        let petIndex=MyTool.getWeightIndexs(jsonData.PetsWeight,4);\r\n        for(let i=0; i<4; i++){\r\n            let item=cc.instantiate(this.pet_item);\r\n            list.addChild(item);\r\n            let petInfo=new PetInfo();\r\n            petInfo.pet_level=userLevel;\r\n            petInfo.pet_id=jsonData.PetsLeaseID[petIndex[i]];\r\n            petInfo.pet_quality=jsonData.PetsQuality[petIndex[i]];\r\n            petInfo.sequence_id=new Date().getTime()/1000*10+i;\r\n            petInfo.lease_type=LeaseType.Maze;\r\n            this.pet_list.push(petInfo);\r\n            item.getComponent(MazePetItem).init(petInfo,i,this);\r\n        }\r\n        MazeManager.getInstance().setRandPetList(this.box_id,this.pet_list);\r\n    }\r\n\r\n    useOldList(petList:PetInfo[],userLevel:number){\r\n        let list=this.node.getChildByName('list');\r\n        this.pet_list=petList;\r\n        for(let i=0; i<petList.length; i++){\r\n            let item=cc.instantiate(this.pet_item);\r\n            list.addChild(item);   \r\n            let petInfo=petList[i];\r\n            petInfo.pet_level=userLevel;\r\n            item.getComponent(MazePetItem).init(petInfo,i,this);\r\n            \r\n        }\r\n    }\r\n\r\n    clickBtnItem(index:number){\r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.click);\r\n        if(this.select_index==index){\r\n            this.select_index=-1;\r\n        }else{\r\n            this.select_index=index;\r\n        }\r\n        this.refreshAllItem();\r\n    }\r\n\r\n    refreshAllItem(): void {\r\n        let list=this.node.getChildByName('list');\r\n        for(let i=0; i<list.childrenCount; i++){\r\n            let item=list.children[i];\r\n            item.getComponent(MazePetItem).refresh(this.select_index==i);\r\n        }\r\n    }\r\n\r\n    clickBtnOk(){\r\n        if(this.is_can_go){\r\n            if(this.select_index>=0){\r\n                MazeManager.getInstance().addLeasePetList(this.pet_list[this.select_index]);\r\n                super.onRefresh();\r\n                super.onClose();\r\n                FollowManager.getInstance().followEvent(Follow_Type.rogue玩法获得宠物事件);\r\n            }else{\r\n                GameManager.getInstance().showMessage(LanguageManager.getInstance().getStrByTextId(830023));\r\n            }\r\n        }        \r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}