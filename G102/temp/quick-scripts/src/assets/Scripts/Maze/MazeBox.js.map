{"version":3,"sources":["assets\\Scripts\\Maze\\MazeBox.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import GameManager from \"../GameManager\";\r\nimport { SoundIndex } from \"../Sound/AudioConstants\";\r\nimport { UIManager } from \"../UI/UIManager\";\r\n// import { RogueHexagonTypesManager } from \"./Data/RogueHexagonTypes\";\r\nimport { RogueHexagonTypesManager } from \"../copy/voidcrack/RogueHexagonTypes\";\r\nimport { MazeManager } from \"./MazeManager\";\r\nimport MazeUi from \"./MazeUi\";\r\n\r\nenum FloatDir{\r\n    Up=1,\r\n    Down=2,\r\n}\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class MazeBox extends cc.Component {\r\n\r\n    @property([cc.SpriteFrame])\r\n    icon_event_type:cc.SpriteFrame[]=[];\r\n    /**格子id */\r\n    box_id:number=10011;\r\n    //列\r\n    row:number=0;\r\n    //行，层数\r\n    column:number=0;\r\n    /**浮动速度 */\r\n    float_speed:number=10;\r\n    center_pos_y:number=0;\r\n    cur_float_dir:FloatDir=FloatDir.Up;\r\n    top_yy:number=0;\r\n    bottom_yy:number=0;\r\n\r\n    init (row:number,column:number,id:number) {\r\n        this.row=row;\r\n        this.column=column;\r\n        let offsetY=6;\r\n        this.float_speed=Math.random()*offsetY/4+offsetY/4;\r\n        this.center_pos_y=this.node.y;\r\n        this.node.y=this.center_pos_y+Math.random()*offsetY-offsetY/2;\r\n        this.top_yy=this.center_pos_y+offsetY/2;\r\n        this.bottom_yy=this.center_pos_y-offsetY/2;\r\n        this.cur_float_dir=Math.random()>0.5?FloatDir.Up:FloatDir.Down;\r\n        this.box_id=id;        \r\n    }\r\n\r\n    refreshBox(){\r\n        //按钮\r\n        let btn=this.node.getComponent(cc.Button);\r\n        let shadow=this.node.getChildByName('shadow');\r\n        let curJsonData=RogueHexagonTypesManager.getInstance().getJsonRogueHexagonTypes(this.box_id);\r\n        let passedIds=MazeManager.getInstance().getMazePassedIds();\r\n        let lastPassedId=passedIds[passedIds.length-1];\r\n        let passedJsonData=RogueHexagonTypesManager.getInstance().getJsonRogueHexagonTypes(lastPassedId);\r\n        let passedTS=this.node.parent.getChildByName(''+lastPassedId).getComponent(MazeBox);\r\n        let fightingJsonData=RogueHexagonTypesManager.getInstance().getJsonRogueHexagonTypes(MazeManager.getInstance().getFightingId());\r\n        let fightingTS=this.node.parent.getChildByName(''+fightingJsonData.Hexagon_ID).getComponent(MazeBox);\r\n        //切换图标\r\n        let icon=this.node.getChildByName('icon');\r\n        icon.getComponent(cc.Sprite).spriteFrame=this.icon_event_type[curJsonData.HexagonType];\r\n        if(this.row<=passedTS.row){\r\n            //已经通过的\r\n            btn.interactable=false;\r\n            icon.active=false;\r\n            if(!passedIds.includes(curJsonData.Hexagon_ID)){\r\n                this.node.active=false;\r\n            }\r\n        }else if(this.row>passedTS.row){\r\n            //未通过的\r\n            if(this.row-passedTS.row<=2){\r\n                if(this.row-passedTS.row<=1){\r\n                    //判断是否相邻\r\n                    if(MazeManager.getInstance().checkAdjacent(passedTS.row,passedTS.column,this.row,this.column,passedTS.row%2==0)){\r\n                        btn.interactable=true;\r\n                        icon.active=true;\r\n                    }else{\r\n                        btn.interactable=false;\r\n                        icon.active=false;\r\n                        this.node.active=false;\r\n                    }\r\n                }else{\r\n                    btn.interactable=true;\r\n                    icon.active=true;\r\n                }    \r\n            }else{\r\n                if(curJsonData.HexagonType==1||curJsonData.HexagonType==2||curJsonData.HexagonType==6){\r\n                    btn.interactable=false;\r\n                    icon.active=false;\r\n                }else{                    \r\n                    btn.interactable=true;\r\n                    icon.active=true;\r\n                }                \r\n            }            \r\n        }\r\n        //和正在战斗同一行\r\n        if(this.row==fightingTS.row){            \r\n            if(curJsonData.Hexagon_ID==fightingJsonData.Hexagon_ID){\r\n                //相同\r\n                btn.interactable=true;\r\n                icon.active=true;\r\n                //箭头\r\n                if(curJsonData.Hexagon_ID!=passedJsonData.Hexagon_ID){\r\n                    MazeUi.getInstance().showArrow(this.node);\r\n                }                \r\n            }else{\r\n                //不同\r\n                btn.interactable=false;\r\n                icon.active=false;\r\n                this.node.active=false;\r\n            }\r\n        }        \r\n        if(curJsonData.Hexagon_ID==passedJsonData.Hexagon_ID){\r\n            btn.interactable=false;\r\n            icon.active=true;\r\n            icon.getComponent(cc.Sprite).spriteFrame=this.icon_event_type[0];\r\n        }\r\n        shadow.active=icon.active;\r\n    }\r\n\r\n    onClick(btn:cc.Event.EventTouch){\r\n        cc.log(this.box_id);\r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.click);\r\n        let passedIds=MazeManager.getInstance().getMazePassedIds();\r\n        let lastPassedId=passedIds[passedIds.length-1];\r\n        let curJsonData=RogueHexagonTypesManager.getInstance().getJsonRogueHexagonTypes(this.box_id);\r\n        let passedTS=this.node.parent.getChildByName(''+lastPassedId).getComponent(MazeBox);\r\n        let isCanGo=MazeManager.getInstance().checkAdjacent(passedTS.row,passedTS.column,this.row,this.column,passedTS.row%2==0);\r\n        switch(curJsonData.HexagonType){\r\n            case 1:\r\n            case 2:\r\n            case 6:{\r\n                if(MazeManager.getInstance().getPassingId()==this.box_id){\r\n                    UIManager.getInstance().showMazeBuffUi(null,this.box_id,isCanGo);\r\n                }else{\r\n                    UIManager.getInstance().showMazeFightingUi(null,this.box_id,isCanGo);\r\n                }\r\n                \r\n            }break;\r\n            case 3:{\r\n                UIManager.getInstance().showMazeLeaseUi({onRefresh:()=>{\r\n                    MazeManager.getInstance().addMazePassedId(this.box_id);\r\n                    MazeManager.getInstance().setFightingId(this.box_id);\r\n                    MazeUi.getInstance().refreshFloor();\r\n                }},this.box_id,isCanGo);\r\n            }break;\r\n            case 4:{\r\n                UIManager.getInstance().showMazeShopUi(null,this.box_id,isCanGo);\r\n            }break;\r\n            case 5:{\r\n                UIManager.getInstance().showMazeHealingPotionUi(null,this.box_id,isCanGo);\r\n            }break;\r\n            \r\n        }\r\n        \r\n    }\r\n\r\n    update (dt:number) {\r\n\r\n        switch(this.cur_float_dir){\r\n            case FloatDir.Up:{\r\n                this.node.y+=dt*this.float_speed;\r\n                if(this.node.y>this.top_yy){\r\n                    this.cur_float_dir=FloatDir.Down;\r\n                }\r\n            }break;\r\n            case FloatDir.Down:{\r\n                this.node.y-=dt*this.float_speed;\r\n                if(this.node.y<this.bottom_yy){\r\n                    this.cur_float_dir=FloatDir.Up;\r\n                }\r\n            }\r\n        }\r\n        \r\n        \r\n    }\r\n}\r\n\r\n"]}