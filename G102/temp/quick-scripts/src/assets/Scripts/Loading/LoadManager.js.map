{"version":3,"sources":["assets\\Scripts\\Loading\\LoadManager.ts"],"names":[],"mappings":";;;;;;;AAAA,0CAAoC;AAGpC,IAAY,SAGX;AAHD,WAAY,SAAS;IACjB,2CAAO,CAAA;IACP,6CAAQ,CAAA;AACZ,CAAC,EAHW,SAAS,GAAT,iBAAS,KAAT,iBAAS,QAGpB;AAED;IAAA;IAoDA,CAAC;IA3CU,gBAAI,GAAX;QACI,IAAI,CAAC,SAAS,GAAC,gBAAI,CAAA,CAAC,CAAA,SAAS,CAAC,MAAM,CAAA,CAAC,CAAA,SAAS,CAAC,KAAK,CAAC;IACzD,CAAC;IAEM,oBAAQ,GAAf,UAAgB,QAAe,EAAC,IAAc,EAAC,UAAqD;QAChG,IAAI,CAAC,eAAe,EAAE,CAAC;QACvB,QAAO,IAAI,EAAC;YACR,KAAK,SAAS,CAAC,KAAK;gBAAC;oBACjB,IAAI,CAAC,SAAS,CAAC,OAAO,GAAC,QAAQ,EAAC,EAAE,CAAC,SAAS,EAAC,UAAU,CAAC,CAAC;iBAC5D;gBAAA,MAAM;YACX,KAAK,SAAS,CAAC,MAAM;gBAAC;oBACd,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,eAAe,GAAC,QAAQ,GAAC,OAAO,EAAC,UAAU,CAAC,CAAC;iBACrE;gBAAA,MAAM;SACV;IACL,CAAC;IAEc,qBAAS,GAAxB,UAAyB,GAAU,EAAC,IAAqB,EAAC,UAAgD;QAA1G,iBAUC;QATG,EAAE,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,EAAC,IAAI,EAAC,UAAC,KAAY,EAAE,MAAe;YACrD,IAAG,KAAK,EAAC;gBACL,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;gBACnB,OAAO;aACV;YACD,KAAI,CAAC,gBAAgB,EAAE,CAAC;YACxB,UAAU,CAAC,KAAK,EAAC,MAAM,CAAC,CAAC;YACzB,EAAE,CAAC,YAAY,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;QACzC,CAAC,CAAC,CAAC;IACP,CAAC;IAEc,sBAAU,GAAzB,UAA0B,GAAU,EAAC,UAAoD;QAAzF,iBAUC;QATG,EAAE,CAAC,YAAY,CAAC,UAAU,CAAC,GAAG,EAAC,EAAC,YAAY,EAAC,KAAK,EAAC,EAAC,UAAC,KAAY,EAAE,MAAmB;YAClF,IAAG,KAAK,EAAC;gBACL,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;gBACnB,OAAO;aACV;YACD,KAAI,CAAC,gBAAgB,EAAE,CAAC;YACxB,UAAU,CAAC,KAAK,EAAC,MAAM,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;IAEP,CAAC;IAEa,6BAAiB,GAA/B;QACI,OAAO,IAAI,CAAC,gBAAgB,GAAC,CAAC,IAAE,IAAI,CAAC,gBAAgB,IAAE,IAAI,CAAC,eAAe,CAAC;IAChF,CAAC;IAlDD,2BAA2B;IACpB,2BAAe,GAAQ,6BAA6B,CAAC;IAC5D,SAAS;IACF,qBAAS,GAAW,SAAS,CAAC,KAAK,CAAC;IAC3C,SAAS;IACF,4BAAgB,GAAQ,CAAC,CAAC;IAC1B,2BAAe,GAAQ,CAAC,CAAC;IA6CpC,kBAAC;CApDD,AAoDC,IAAA;AApDY,kCAAW","file":"","sourceRoot":"/","sourcesContent":["import { IsGM } from \"../Constants\";\r\n\r\n\r\nexport enum Load_Mode {\r\n    local=1,//本地下载，将json文件在resources目录下的json目录\r\n    remote=2,//远程下载，将json文件在url的json目录\r\n}\r\n\r\nexport class LoadManager  {\r\n    //webServer的url，统一以json作为路径\r\n    static remote_url_json:string='http://localhost:8080/json/';\r\n    //使用的下载模式\r\n    static load_mode:Load_Mode=Load_Mode.local;\r\n    //下载成功的文件\r\n    static loaded_completed:number=0;\r\n    static max_num_loading:number=0;\r\n\r\n    static init(){\r\n        this.load_mode=IsGM?Load_Mode.remote:Load_Mode.local;\r\n    }\r\n\r\n    static loadJson(fileName:string,mode:Load_Mode,onComplete: (err: Error, asset: cc.JsonAsset) => void){\r\n        this.max_num_loading++;\r\n        switch(mode){\r\n            case Load_Mode.local:{\r\n                this.loadLocal('json/'+fileName,cc.JsonAsset,onComplete);\r\n            }break;\r\n        case Load_Mode.remote:{\r\n                this.loadRemote(this.remote_url_json+fileName+'.json',onComplete);\r\n            }break;\r\n        }\r\n    }\r\n\r\n    private static loadLocal(url:string,type: typeof cc.Asset,onComplete:(err: Error, asset: cc.Asset) => void){\r\n        cc.resources.load(url,type,(error: Error, assets:cc.Asset)=> {\r\n            if(error){\r\n                console.log(error);\r\n                return;\r\n            }\r\n            this.loaded_completed++;\r\n            onComplete(error,assets);\r\n            cc.assetManager.releaseAsset(assets);\r\n        });\r\n    }\r\n\r\n    private static loadRemote(url:string,onComplete:(err: Error, asset: cc.JsonAsset) => void){\r\n        cc.assetManager.loadRemote(url,{cacheEnabled:false},(error: Error, assets:cc.JsonAsset)=> {\r\n            if(error){\r\n                console.log(error);\r\n                return;\r\n            }\r\n            this.loaded_completed++;\r\n            onComplete(error,assets);\r\n        });\r\n        \r\n    }\r\n\r\n    public static getIsLoadComplete():boolean{\r\n        return this.loaded_completed>0&&this.loaded_completed>=this.max_num_loading;\r\n    }\r\n}\r\n"]}