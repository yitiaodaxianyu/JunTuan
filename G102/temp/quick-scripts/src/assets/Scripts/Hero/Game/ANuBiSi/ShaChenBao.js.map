{"version":3,"sources":["assets\\Scripts\\Hero\\Game\\ANuBiSi\\ShaChenBao.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameState } from \"../../../Constants\";\r\nimport { GameEffectId, GameEffectsManager } from \"../../../Game/GameEffectsManager\";\r\nimport GameManager from \"../../../GameManager\";\r\nimport Monster from \"../../../Monster/Monster\";\r\nimport { StrengthType } from \"../../../Monster/MonsterData\";\r\nimport MonsterManager from \"../../../Monster/MonsterManager\";\r\nimport { SoundIndex } from \"../../../Sound/AudioConstants\";\r\nimport MyTool from \"../../../Tools/MyTool\";\r\nimport { GongJiData } from \"../../Data/HeroData\";\r\nimport GongJi from \"../GongJi\";\r\nimport { BuffId } from \"../HeroConfig\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class ShaChenBao extends GongJi {\r\n\r\n    remain_time:number=0;\r\n    damage_time:number=0;\r\n    damage_jiange:number=1;\r\n    fanwei:number=100;\r\n    /**牵引速度 */\r\n    qianyin_sudu:number=200;\r\n    /**当前的旋转弧度度 */\r\n    cur_rotation:number=0;\r\n    /**旋转速度 */\r\n    ratating_speed:number=Math.PI;\r\n    /**漩涡最小距离 */\r\n    min_distance:number=100;\r\n\r\n    init(gjData:GongJiData,remainTime:number,damageJianGe:number,fanwei:number){\r\n        super.initData(gjData);\r\n        this.remain_time=remainTime;\r\n        this.damage_jiange=damageJianGe;\r\n        this.damage_time=0;\r\n        this.fanwei=fanwei;\r\n        this.node.scale=fanwei/110;\r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.YX_ANBSSkill);\r\n    }\r\n\r\n    destroySelf(){\r\n        GameEffectsManager.getInstance().destroyGameEffectById(GameEffectId.a_nu_bi_si_active_skill_1,this.node);\r\n    }\r\n\r\n    update (dt:number) {\r\n        if(GameManager.getInstance().cur_game_state==GameState.Game_Playing){\r\n            if(this.remain_time>0){\r\n                this.cur_rotation+=dt*this.ratating_speed;\r\n                this.remain_time-=dt;\r\n                let isDie=false;\r\n                if(this.remain_time<0){\r\n                    this.remain_time=0;\r\n                    this.destroySelf();\r\n                    isDie=true;\r\n                }\r\n                //牵引\r\n                let allMonster=MonsterManager.getInstance().node.children;\r\n                let len=allMonster.length;\r\n                this.damage_time-=dt;\r\n                let isCanDamage=false;\r\n                if(this.damage_time<0){\r\n                    this.damage_time=this.damage_jiange;\r\n                    //造成伤害\r\n                    isCanDamage=true;\r\n                }\r\n                if(len<=0)\r\n                {\r\n                    return null;\r\n                }            \r\n                for(let i=0;i<len; i++)\r\n                {\r\n                    let monster=allMonster[i];\r\n                    let monsterTS=monster.getComponent(Monster);\r\n                    if(monsterTS && monsterTS.getIsCanCheck())\r\n                    {\r\n                        let offsetPos=this.node.getPosition().sub(monsterTS.getCenterPos());\r\n                        let distance=offsetPos.mag();\r\n                        if(distance<=this.fanwei)\r\n                        {\r\n                            if(isCanDamage){\r\n                                monsterTS.beFlashInjured(this.gongji_data);\r\n                            }\r\n                            if(monsterTS.getStrengthType()!=StrengthType.Boss){                                \r\n                                let radian=Math.atan2(offsetPos.y,offsetPos.x);                                \r\n                                //牵引，强制位移\r\n                                let xx=Math.cos(radian)*this.qianyin_sudu*dt;\r\n                                let yy=Math.sin(radian)*this.qianyin_sudu*dt;\r\n                                let disX=monster.x+xx;\r\n                                let disY=monster.y+yy;\r\n                                //旋转\r\n                                let offsetCenter=cc.v2(disX,disY).sub(this.node.getPosition());\r\n                                let centerDistance=offsetCenter.mag();\r\n                                let min=MyTool.randomRangeInt(50,120);\r\n                                monsterTS.setQianYinMin(min);\r\n                                if(centerDistance<monsterTS.getQianYinMin()){\r\n                                    centerDistance=monsterTS.getQianYinMin();\r\n                                }\r\n                                //旋转,下一帧的相对弧度\r\n                                let curR=Math.atan2(offsetCenter.y,offsetCenter.x);\r\n                                curR=(curR+(Math.PI*2))%(Math.PI*2);\r\n                                let nextDadian=curR+this.ratating_speed*dt;\r\n                                nextDadian=(nextDadian+(Math.PI*2))%(Math.PI*2);\r\n                                //根据半径和弧度求下一点坐标\r\n                                disY=this.node.y+Math.sin(nextDadian)*centerDistance;\r\n                                disX=this.node.x+Math.cos(nextDadian)*centerDistance;\r\n                                monsterTS.setX(disX);\r\n                                monsterTS.setY(disY);\r\n                                if(monsterTS.isHaveDeBuff(BuffId.Hero_MeiMo_Active_MeiHuo)==false){\r\n                                    monsterTS.setMoveDir(radian+Math.PI);\r\n                                    monsterTS.setFlip(disX>this.node.x);\r\n                                }                                \r\n                                if(isDie){\r\n                                    monsterTS.setMoveDir(Math.PI*3/2);\r\n                                }\r\n                                // if(centerDistance>this.min_distance){\r\n                                //     monsterTS.setX(disX);\r\n                                //     monsterTS.setY(disY);\r\n                                // }\r\n                                \r\n\r\n                            }\r\n                        }else{\r\n                            if(monsterTS.isHaveDeBuff(BuffId.Hero_MeiMo_Active_MeiHuo)==false){\r\n                                monsterTS.setMoveDir(Math.PI*3/2);\r\n                            }\r\n                           \r\n                        }\r\n                    }\r\n                }\r\n                \r\n            }\r\n        }\r\n    }\r\n}\r\n"]}