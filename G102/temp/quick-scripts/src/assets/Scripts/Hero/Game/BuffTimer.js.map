{"version":3,"sources":["assets\\Scripts\\Hero\\Game\\BuffTimer.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameState } from \"../../Constants\";\r\nimport GameManager from \"../../GameManager\";\r\nimport { GongJiData } from \"../Data/HeroData\";\r\nimport { BuffId, BuffType, DamageType } from \"./HeroConfig\";\r\nimport { DamageListen, RecoveryListen } from \"../Skill/SkillConfig\";\r\nimport { GameEffectId, GameEffectsManager } from \"../../Game/GameEffectsManager\";\r\nimport { BuffData } from \"./BuffData\";\r\nimport { MonsterAttData } from \"../../Monster/MonsterData\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class BuffTimer extends cc.Component {\r\n    /**buff数据 */    \r\n    private buff_data:BuffData=null;\r\n    /**时间结束的回调 */\r\n    protected destroy_callback:Function[]=[];\r\n    //----------------------------伤害buff的属性-------------------------------------\r\n    /**时间到达触发时间时，触发伤害的回调 */\r\n    private damage_listen:DamageListen=null;\r\n    /**时间计数 */\r\n    private damage_jishu_time: number=0;\r\n    /**伤害来源的数据 */\r\n    private gongji_data:GongJiData|MonsterAttData=null;\r\n    //----------------------------治疗buff的属性-------------------------------------\r\n    /**时间到达触发时间时，治疗的回调 */\r\n    private recovery_listen:RecoveryListen=null;\r\n    /**时间计数 */\r\n    private recovery_jishu_time: number=0;\r\n    /**治疗量 */\r\n    private recovery_num:number=0;\r\n    //-----------------------------Buff层数----------------------------\r\n    /**buff爆发层数 */\r\n    private burst_num:number=0;\r\n    /**buff爆发回调 */\r\n    private burst_callback:Function=null;\r\n    /**buff添加层数回调 */\r\n    private add_floor_callback:Function=null;\r\n    /**额外的特效 */\r\n    private texiao:cc.Node=null;\r\n    private texiao_id:GameEffectId=GameEffectId.Null;\r\n    /**\r\n     * 初始化一个buff\r\n     * @param game_effect_id 该buff的特效id\r\n     * @param buffId buff的id\r\n     * @param type buff的类型\r\n     * @param remainTime buff的持续时间\r\n     * @param value buff的强度值（如减速buff会根据这个值作为减速强度）\r\n     */\r\n    init(buffData:BuffData){\r\n        this.buff_data=buffData;\r\n        this.buff_data.cur_floor=buffData.add_floor;\r\n        if(buffData.fade_time>0){\r\n            this.node.opacity=0;\r\n            cc.tween(this.node).to(buffData.fade_time,{opacity:255}).start();\r\n        }\r\n        this.initListen();\r\n    }\r\n\r\n    private initListen(){\r\n        this.destroy_callback=new Array();\r\n    }\r\n\r\n    /**添加销毁监听 */\r\n    addDestroyListen(callback:Function){\r\n        this.destroy_callback.push(callback);\r\n    }\r\n    /**添加buff层数添加监听 */\r\n    addFloorListen(callback:Function){\r\n        this.add_floor_callback=callback;\r\n    }\r\n    /**添加buff爆发监听 */\r\n    addBurstListen(num:number,callback:Function,gjData:GongJiData){\r\n        this.burst_num=num;\r\n        this.burst_callback=callback;\r\n        this.gongji_data=gjData;\r\n    }\r\n   /**\r\n    * 覆盖添加伤害触发的监听\r\n    * @param damageListen 伤害监听器\r\n    * @param gjData 攻击数据\r\n    */\r\n    addDamageListen(damageListen:DamageListen,gjData:GongJiData|MonsterAttData){\r\n        this.damage_listen=damageListen;\r\n        this.gongji_data=gjData;\r\n        this.damage_jishu_time=this.buff_data.damage_jiange_time;\r\n    }\r\n\r\n    /**\r\n    * 覆盖添加一个治疗监听事件\r\n    * @param recoveryListen 治疗监听器\r\n    * @param gjData \r\n    */\r\n    addRecoveryListen(recoveryListen:RecoveryListen,num:number){\r\n        this.recovery_listen=recoveryListen;\r\n        this.recovery_num=num;\r\n        this.recovery_jishu_time=this.buff_data.recovery_jiange_time;\r\n    }\r\n\r\n    /**获得剩余的时间 */\r\n    getRemainTime():number{\r\n        return this.buff_data.remain_time;\r\n    }\r\n    /**返回Buff类型 */\r\n    getBuffType():BuffType{\r\n        return this.buff_data.buff_type;\r\n    }\r\n    /**返回BuffId */\r\n    getBuffId():BuffId{\r\n        return this.buff_data.buff_id;\r\n    }\r\n    /**返回Buff数值 */\r\n    getBuffValue():number[]{        \r\n        return this.buff_data.buff_value;\r\n    }\r\n    /**返回Buff数值 */\r\n    getFirstBuffValue():number{        \r\n        return this.buff_data.buff_value[0];\r\n    }\r\n    /**返回buff的特效id */\r\n    getGameEffectId():GameEffectId{\r\n        return this.buff_data.game_effect_id;\r\n    }\r\n    /**返回buff叠加的层数 */\r\n    getFloorNum():number{\r\n        return this.buff_data.cur_floor;\r\n    }\r\n\r\n    /**添加额外的特效 */\r\n    addTeXiao(gameEffectId:GameEffectId,pos:cc.Vec2,parent:cc.Node){\r\n        this.texiao=GameEffectsManager.getInstance().createGameEffectForParent(gameEffectId,pos,parent);\r\n        this.texiao_id=gameEffectId;\r\n    }\r\n    // /**设置渐隐渐显时间 */\r\n    // setFadeTime(dt:number){\r\n    //     this.buff_data.fade_time=dt;\r\n    // }\r\n\r\n    /**刷新buff时间 */\r\n    refreshBuff(newBuff:BuffData){\r\n        if(newBuff.remain_time>this.buff_data.remain_time)\r\n        {\r\n            this.buff_data.remain_time=newBuff.remain_time;\r\n        }\r\n        this.addFloor(newBuff.add_floor);\r\n    }\r\n\r\n    addFloor(num:number=1){\r\n        let newFloor=this.buff_data.cur_floor+num;\r\n        if(this.buff_data.max_floor>0 &&newFloor>this.buff_data.max_floor){\r\n            newFloor=this.buff_data.max_floor;\r\n        }\r\n        this.buff_data.cur_floor=newFloor;\r\n        if(this.burst_num>0){            \r\n            if(this.buff_data.cur_floor>=this.burst_num){\r\n                this.buff_data.cur_floor=0;\r\n                if(this.burst_callback){\r\n                    this.burst_callback(this.buff_data,this.gongji_data);\r\n                }\r\n            }\r\n        }\r\n        if(this.add_floor_callback){\r\n            this.add_floor_callback(this.buff_data.cur_floor);\r\n        }\r\n    }\r\n\r\n    destroySelf(){\r\n        GameEffectsManager.getInstance().destroyGameEffectById(this.buff_data.game_effect_id,this.node);\r\n        if(this.destroy_callback.length>0){\r\n            for(let i=0; i<this.destroy_callback.length; i++){\r\n                this.destroy_callback[i](this.buff_data);\r\n            }\r\n            \r\n        }\r\n        if(this.texiao){\r\n            GameEffectsManager.getInstance().destroyGameEffectById(this.texiao_id,this.texiao);\r\n        }\r\n    }\r\n\r\n    doDamage(){\r\n        if(this.damage_listen){\r\n            //let num=this.damage_listen;\r\n            // if(this.buff_id==Enemy_DeBuff_Type.LiuXue_RenZhe_Active_Skill){\r\n            //     num*=this.buff_floor_num;\r\n            // }\r\n            this.damage_listen.doDamage(this.gongji_data);\r\n        }\r\n    }\r\n\r\n    doRecovery(){\r\n        if(this.recovery_listen){\r\n            this.recovery_listen.doRecovery(this.recovery_num);\r\n        }\r\n    }\r\n\r\n    protected update(dt: number): void {\r\n        if(GameManager.getInstance().cur_game_state==GameState.Game_Playing){\r\n            if(this.buff_data.remain_time>0){\r\n                this.buff_data.remain_time-=dt;\r\n                if(this.buff_data.remain_time<0){\r\n                    this.buff_data.remain_time=0;\r\n                    this.destroySelf();\r\n                }\r\n                if(this.buff_data.fade_time>0){\r\n                    if(this.buff_data.remain_time<this.buff_data.fade_time){\r\n                        this.node.opacity-=dt*2*this.buff_data.fade_time;\r\n                    }\r\n                }\r\n                if(this.damage_listen){\r\n                    this.damage_jishu_time+=dt;\r\n                    if(this.damage_jishu_time>=this.buff_data.damage_jiange_time){\r\n                        this.damage_jishu_time=0;\r\n                        this.doDamage();\r\n                    }\r\n                }\r\n                if(this.recovery_listen){\r\n                    this.recovery_jishu_time+=dt;\r\n                    if(this.recovery_jishu_time>=this.buff_data.recovery_jiange_time){\r\n                        this.recovery_jishu_time=0;\r\n                        this.doRecovery();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}