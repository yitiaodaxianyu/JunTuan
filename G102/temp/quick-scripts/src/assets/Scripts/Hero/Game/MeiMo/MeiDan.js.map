{"version":3,"sources":["assets\\Scripts\\Hero\\Game\\MeiMo\\MeiDan.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameEffectsManager, GameEffectId } from \"../../../Game/GameEffectsManager\";\r\nimport Monster from \"../../../Monster/Monster\";\r\nimport MonsterManager from \"../../../Monster/MonsterManager\";\r\nimport Bullect from \"../Bullect\";\r\nimport { BuffId, BuffType, DamageType, SkillType } from \"../HeroConfig\";\r\nimport MeiMo from \"./MeiMo\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class MeiDan extends Bullect {\r\n\r\n    is_ex_damage:boolean=false;\r\n    hero:MeiMo=null;\r\n\r\n    onLoad(): void {\r\n        super.onLoad();\r\n        super.addCollisionMonsterListen(this.onCollisionMonster);\r\n    }\r\n\r\n    setIsExDamage(hero:MeiMo,isEx:boolean){\r\n        this.is_ex_damage=isEx;\r\n        this.hero=hero;\r\n    }\r\n\r\n    onCollisionMonster(monsterTs:Monster) {\r\n        //普通弹\r\n        if(monsterTs){\r\n            if(monsterTs.isHaveDeBuff(BuffId.Hero_MeiMo_Active_ZhengShang)){\r\n                this.gongji_data.hero_data.all_increase_damage+=this.gongji_data.hero_data.getSkillValue4(SkillType.Active);\r\n            }\r\n            this.gongji_data.is_can_crit=true;\r\n            let data=monsterTs.beFlashInjured(this.gongji_data);\r\n            this.gongji_data.is_can_crit=false;\r\n            let isDie=data.is_die;\r\n            if(data.getDamageNum()>0){\r\n                GameEffectsManager.getInstance().createGameEffectById(GameEffectId.mei_mo_attack_hit,this.getHeadPos());\r\n                //额外伤害\r\n                if(isDie==false && this.is_ex_damage){\r\n                    //额外的技能伤害\r\n                    let exGjData=cc.instantiate(this.gongji_data);\r\n                    exGjData.damage_type=DamageType.Skill;\r\n                    exGjData.is_bullet=false;\r\n                    exGjData.skill_damage_rate=this.gongji_data.hero_data.getSkillValue4(SkillType.Passive_1);\r\n                    let exData=monsterTs.beFlashInjured(this.gongji_data);\r\n                    isDie=exData.is_die;\r\n                }                \r\n                if(isDie==false){\r\n                    //被动二\r\n                    if(this.hero.hero_data.getIsUnlock(SkillType.Passive_2)){\r\n                        let rate=this.hero.hero_data.getSkillValue1(SkillType.Passive_2);\r\n                        if(Math.random()<rate){                        \r\n                            let damageRate=this.hero.hero_data.getSkillValue2(SkillType.Passive_2);\r\n                            let curHpRate=monsterTs.getCurHp()/monsterTs.getMaxHp();\r\n                            if(curHpRate<0.3){\r\n                                curHpRate=0.3;\r\n                            }\r\n                            let remainRate=Math.floor((1-curHpRate)*100/10);\r\n                            damageRate+=remainRate;\r\n                            let exData=monsterTs.beFlashInjured(this.hero.getGongJiData(DamageType.Skill,false,SkillType.Passive_2,damageRate));\r\n                            isDie=exData.is_die;\r\n                        }\r\n                    }\r\n                    \r\n                }\r\n                if(isDie){\r\n                    //引爆\r\n                   if(this.hero){\r\n                        this.hero.startBomb(monsterTs);\r\n                   }\r\n                }\r\n                //专武判断\r\n                if(monsterTs.isHaveDeBuff(BuffId.Hero_MeiMo_Active_MeiHuo)){\r\n                    //范围伤害\r\n                    let ex1=this.gongji_data.hero_data.ExclusiveWeaponSkillValue_1;\r\n                    if(ex1&&ex1>0){\r\n                        /**范围伤害，不包括这个怪 */\r\n                        let monsters=MonsterManager.getInstance().getMonstersForCenterPos(-1,monsterTs.getCenterPos(),ex1);\r\n                        if(monsters){\r\n                            for(let i=0; i<monsters.length; i++){\r\n                                let monsterTTs=monsters[i].getComponent(Monster);\r\n                                if(monsterTTs.uuid!=monsterTs.uuid){\r\n                                    //伤害比值是多少，暂用本次伤害，是否享受魅惑增伤,                                \r\n                                    // let bzGjData=cc.instantiate(this.gongji_data);\r\n                                    // if(monsterTTs.isHaveDeBuff(BuffId.Hero_MeiMo_Active_ZhengShang)){\r\n                                    //     bzGjData.hero_data.all_increase_damage+=zengshang;\r\n                                    // }\r\n                                    let data=monsterTTs.beFlashInjured(this.gongji_data);\r\n                                    if(data.getDamageNum()>0){\r\n                                        GameEffectsManager.getInstance().createGameEffectById(GameEffectId.mei_mo_attack_hit,monsterTTs.getCenterPos());\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            this.destroySelf();\r\n        }\r\n    }\r\n\r\n}\r\n"]}