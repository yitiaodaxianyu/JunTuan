{"version":3,"sources":["assets\\Scripts\\Hero\\Game\\PaoShou\\SignalFlare.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameState } from \"../../../Constants\";\r\nimport { GameEffectId, GameEffectsManager } from \"../../../Game/GameEffectsManager\";\r\nimport GameManager from \"../../../GameManager\";\r\n\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class SignalFlare extends cc.Component {\r\n\r\n    @property({type:cc.Prefab})\r\n    tuowei:cc.Prefab=null;\r\n\r\n    game_effect_id:GameEffectId=GameEffectId.Null;\r\n    move_speed:number=700;\r\n    move_direction:number=Math.PI/2;\r\n\r\n    bomb_size:number=100;\r\n    //目标地点，到达后爆炸\r\n    target_pos:cc.Vec2=null;\r\n\r\n    tuo_wei:cc.Node=null;\r\n    prev_pos:cc.Vec2=cc.v2(0,0);\r\n    /**蔓延特效 */\r\n    spread_time:number=0.2;\r\n    /**蔓延位置 */\r\n    spread_pos:cc.Vec2[]=[];\r\n    end_callback:Function=null;\r\n    /**是否到达目的地 */\r\n    is_arrive:boolean=false;\r\n\r\n    init(id:GameEffectId,speed:number,targetPos:cc.Vec2,endCallback:Function)\r\n    {\r\n        this.game_effect_id=id;\r\n        this.move_speed=speed;\r\n        this.target_pos=targetPos;        \r\n        this.end_callback=endCallback;\r\n        let offsetPos=targetPos.sub(this.node.getPosition());\r\n        this.move_direction=Math.atan2(offsetPos.y,offsetPos.x);\r\n        //距离\r\n        let distance=offsetPos.mag();\r\n        let sp=this.move_speed/GameManager.getInstance().getGameRate();\r\n        this.spread_time=0.02*GameManager.getInstance().getGameRate();\r\n        let jtTime=distance/sp/GameManager.getInstance().getGameRate();;\r\n        this.node.scale=0.5;\r\n        cc.tween(this.node).then(cc.spawn(cc.sequence(cc.scaleTo(jtTime/4,1.1),cc.scaleTo(jtTime*3/4,0.8)),cc.jumpTo(jtTime,targetPos,distance/2,1))).call(this.destroySelf,this).start();\r\n        this.tuo_wei=cc.instantiate(this.tuowei)\r\n        this.tuo_wei.parent=this.node.parent;\r\n        this.node.zIndex=2;\r\n        this.prev_pos=this.node.getPosition();\r\n        let ms=this.tuo_wei.getComponent(cc.MotionStreak);\r\n        ms.fadeTime=ms.fadeTime*GameManager.getInstance().getGameRate();\r\n\r\n        this.spread_pos=new Array(4);\r\n        let len=this.spread_pos.length;\r\n        for(let i=0; i<len; i++)\r\n        {\r\n            this.spread_pos[i]=this.node.getPosition();\r\n        }\r\n        this.is_arrive=false;\r\n    }\r\n\r\n    destroySelf()\r\n    {\r\n        if(this.tuo_wei){\r\n            cc.tween(this.tuo_wei).delay(this.tuo_wei.getComponent(cc.MotionStreak).fadeTime/(10*GameManager.getInstance().getGameRate()))\r\n            .to(0.1,{opacity:0})\r\n            .removeSelf().start();\r\n        }\r\n        this.spread_time=0.6;\r\n        if(this.end_callback){\r\n            this.end_callback();\r\n        }\r\n        //GameManager.getInstance().sound_manager.playSound(SoundIndex.boom2);\r\n        this.node.zIndex=2;\r\n        this.is_arrive=true;\r\n        let miaozhun=GameEffectsManager.getInstance().createGameEffectForParent(GameEffectId.paoshou_dazhao_xinhaodan_miaozhun,this.node.getPosition(),this.node.parent);\r\n        miaozhun.getComponent(sp.Skeleton).setAnimation(0,'Skill_MiaoZhun',false);\r\n        miaozhun.zIndex=0;\r\n        let end=GameEffectsManager.getInstance().createGameEffectForParent(GameEffectId.paoshou_dazhao_weiyan_end,this.node.getPosition(),this.node.parent);\r\n        end.zIndex=1;\r\n        end.opacity=255;\r\n        end.getComponent(sp.Skeleton).setAnimation(0,'Skill_WeiYan',false);\r\n        cc.tween(end).to(1.3,{opacity:88}).start();\r\n        cc.tween(this.node).to(1.3,{opacity:168}).call(()=>{\r\n            GameEffectsManager.getInstance().destroyGameEffectById(this.game_effect_id,this.node);\r\n            GameEffectsManager.getInstance().destroyGameEffectById(GameEffectId.paoshou_dazhao_xinhaodan_miaozhun,miaozhun);\r\n            GameEffectsManager.getInstance().destroyGameEffectById(GameEffectId.paoshou_dazhao_weiyan_end,end);\r\n        }).start();\r\n    }\r\n\r\n    setDirection(dir:number)\r\n    {\r\n        this.move_direction=dir;\r\n        //this.node.angle=180*dir/Math.PI;\r\n    }\r\n\r\n    createSpread(){\r\n        let node=GameEffectsManager.getInstance().createGameEffectForParent(GameEffectId.paoshou_dazhao_weiyan,this.spread_pos[this.getPosIndex()],this.node.parent);\r\n        let anima=node.getComponent(cc.Animation);\r\n        let state=anima.play();\r\n        state.speed=1/GameManager.getInstance().getGameRate();\r\n        anima.on(cc.Animation.EventType.FINISHED,()=>{\r\n            GameEffectsManager.getInstance().destroyGameEffectById(GameEffectId.paoshou_dazhao_weiyan,node);\r\n        },this);\r\n        node.zIndex=3;\r\n        node.angle=Math.random()*360;\r\n        node.scale=Math.random()*0.5+0.8;\r\n    }\r\n\r\n    createEndSpread(){\r\n\r\n    }\r\n\r\n    private getPosIndex():number\r\n    {\r\n        let maxCL=this.spread_pos.length-1;\r\n        let index=Math.floor(this.spread_pos.length/GameManager.getInstance().getGameRate());\r\n        if(index>=maxCL)\r\n        {\r\n            index=maxCL;\r\n        }\r\n        return index;\r\n    }\r\n\r\n    update (dt) {\r\n        if(GameManager.getInstance().cur_game_state!=GameState.Game_Playing)\r\n        return;\r\n        if(this.tuowei!=null){\r\n            let gr=GameManager.getInstance().getGameRate();\r\n            if(gr<1){\r\n                gr=1;\r\n            }\r\n            //添加在子弹前面           \r\n            let pos=this.node.getPosition(); \r\n            let offsetPos=pos.sub(this.prev_pos);\r\n            let distance=offsetPos.mag()*4/gr;\r\n            let dir=Math.atan2(offsetPos.y,offsetPos.x);\r\n            let xx=pos.x+Math.cos(dir)*distance;\r\n            let yy=pos.y+Math.sin(dir)*distance;\r\n            this.tuo_wei.setPosition(cc.v2(xx,yy));\r\n            this.prev_pos=this.node.getPosition();\r\n            this.spread_time-=dt;\r\n            this.update_locus_shadow();\r\n            if(this.spread_time<=0){\r\n                this.spread_time=0.02*GameManager.getInstance().getGameRate();\r\n                if(this.is_arrive==false){\r\n                    this.createSpread();\r\n                }              \r\n            }\r\n        }        \r\n    }\r\n\r\n    update_locus_shadow()\r\n    {\r\n        if(this.is_arrive==false){\r\n            //加入头部\r\n            this.spread_pos.unshift(this.node.getPosition());\r\n            //删除尾部\r\n            this.spread_pos.pop();  \r\n        }\r\n\r\n    }\r\n}\r\n"]}