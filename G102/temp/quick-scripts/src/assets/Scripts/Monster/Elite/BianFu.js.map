{"version":3,"sources":["assets\\Scripts\\Monster\\Elite\\BianFu.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameState } from \"../../Constants\";\r\nimport { GameEffectId, GameEffectsManager } from \"../../Game/GameEffectsManager\";\r\nimport GroundManager from \"../../Game/GroundManager\";\r\nimport GameManager from \"../../GameManager\";\r\nimport { HaloData, HaloId } from \"../../Hero/Game/HeroConfig\";\r\nimport Monster from \"../Monster\";\r\nimport MonsterManager from \"../MonsterManager\";\r\nimport MonsterNewNormal from \"../MonsterNewNormal\";\r\nimport MonsterNormal from \"../MonsterNormal\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class BianFu extends MonsterNewNormal {\r\n\r\n    light:cc.Node=null;\r\n    halo_data:HaloData=null;\r\n    is_loaded:boolean=false;\r\n\r\n    protected onLoad(): void {\r\n        super.onLoad();\r\n        super.addMonsterNormalInited(this.onMonsterNormalInited);\r\n        super.addMonsterNormalDeath(this.onMonsterNormalDeath);\r\n        GameEffectsManager.getInstance().addEffectPoolById(GameEffectId.monster30_bianfu_skill,1,()=>{\r\n            //添加光环特效\r\n            if(!this.light){\r\n                this.light=GroundManager.getInstance().createGameEffectById(GameEffectId.monster30_bianfu_skill,this.node.getPosition());\r\n            }\r\n            this.is_loaded=true;\r\n        });\r\n    }\r\n\r\n    onMonsterNormalInited () {        \r\n        this.halo_data=new HaloData();\r\n        this.halo_data.halo_id=HaloId.Monster30_BianFu_Skill_Halo;\r\n        this.halo_data.halo_value=[0.3];\r\n        this.halo_data.halo_source_uuid=this.uuid;\r\n        if(this.is_loaded){\r\n            if(!this.light){\r\n                this.light=GroundManager.getInstance().createGameEffectById(GameEffectId.monster30_bianfu_skill,this.node.getPosition());\r\n            }\r\n        }\r\n    }\r\n\r\n    onMonsterNormalDeath(){\r\n        //以及删除所有光环数据\r\n        if(this.light){\r\n            GameEffectsManager.getInstance().destroyGameEffectById(GameEffectId.monster30_bianfu_skill,this.light);\r\n            this.light=null;\r\n        }        \r\n        let allMonster=MonsterManager.getInstance().node.children;\r\n        let len=allMonster.length;\r\n        if(len<=0)\r\n        {\r\n            return null;\r\n        }            \r\n        for(let i=0;i<len; i++)\r\n        {\r\n            let monster=allMonster[i];\r\n            let monsterTS=monster.getComponent(Monster);\r\n            if(monsterTS && monsterTS.getIsCanCheck())\r\n            {\r\n                //移除光环效果\r\n                monsterTS.subHalo(HaloId.Monster30_BianFu_Skill_Halo,this.uuid);\r\n            }\r\n        }\r\n    }    \r\n\r\n    update (dt) {\r\n        if((GameManager.getInstance().cur_game_state!=GameState.Game_Playing)||this.getIsDie())\r\n        {\r\n            return;\r\n        }\r\n        super.update(dt);\r\n        this.checkSkill();\r\n        if(this.light){\r\n            this.light.setPosition(this.node.getPosition());\r\n        }\r\n    }\r\n\r\n    checkSkill(){\r\n        let allMonster=MonsterManager.getInstance().node.children;\r\n        let len=allMonster.length;\r\n        if(len<=0)\r\n        {\r\n            return null;\r\n        }            \r\n        for(let i=0;i<len; i++)\r\n        {\r\n            let monster=allMonster[i];\r\n            let monsterTS=monster.getComponent(Monster);\r\n            if(monsterTS && monsterTS.getIsCanCheck())\r\n            {\r\n                let distance=this.getCenterPos().sub(monsterTS.getCenterPos()).mag();\r\n                if(distance<=200)\r\n                {\r\n                    //添加光环效果                    \r\n                    monsterTS.addHalo(this.halo_data);\r\n                }else{\r\n                    //移除光环效果\r\n                    monsterTS.subHalo(HaloId.Monster30_BianFu_Skill_Halo,this.uuid);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}