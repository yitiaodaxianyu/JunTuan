{"version":3,"sources":["assets\\resources\\test\\scripts\\Player.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { SpeedType } from \"./Joystick\";\nconst { ccclass, property } = cc._decorator;\n\nimport { instance } from \"./Joystick\";\n\n@ccclass\nexport default class Player extends cc.Component {\n  @property({\n    displayName: \"刚体模式\",\n    tooltip: \"不会立即停止\",\n  })\n  rigidbody = false;\n\n  // from joystick\n  @property({\n    displayName: \"Move Dir\",\n    tooltip: \"移动方向\",\n  })\n  moveDir = cc.v2(0, 1);\n\n  @property({\n    displayName: \"Speed Type\",\n    tooltip: \"速度级别\",\n  })\n  _speedType: SpeedType = SpeedType.STOP;\n\n  // from self\n  @property({\n    type: cc.Integer,\n    displayName: \"Move Speed\",\n    tooltip: \"移动速度\",\n  })\n  _moveSpeed = 0;\n\n  @property({\n    type: cc.Integer,\n    displayName: \"Stop Speed\",\n    tooltip: \"停止时速度\",\n  })\n  stopSpeed = 0;\n\n  @property({\n    type: cc.Integer,\n    tooltip: \"正常速度\",\n  })\n  normalSpeed = 100;\n\n  @property({\n    type: cc.Integer,\n    tooltip: \"最快速度\",\n  })\n  fastSpeed = 200;\n\n  _body: cc.RigidBody;\n\n  onLoad() {\n    if (this.rigidbody) {\n      cc.director.getPhysicsManager().enabled = true;\n      this._body = this.getComponent(cc.RigidBody);\n    }\n\n    instance.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this);\n    instance.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n    instance.on(cc.Node.EventType.TOUCH_END, this.onTouchEnd, this);\n  }\n\n  onTouchStart() {}\n\n  onTouchMove(event: cc.Event.EventTouch, data) {\n    this._speedType = data.speedType;\n    this.moveDir = data.moveDistance;\n  }\n\n  onTouchEnd(event: cc.Event.EventTouch, data) {\n    this._speedType = data.speedType;\n  }\n\n  /**\n   * 移动\n   */\n  move() {\n    this.node.angle =\n      cc.misc.radiansToDegrees(Math.atan2(this.moveDir.y, this.moveDir.x)) - 90;\n\n    if (this.rigidbody) {\n      this._body.applyForceToCenter(\n        cc.v2(this.moveDir.x * 200, this.moveDir.y * 200),\n        true\n      );\n    } else {\n      const oldPos = cc.v2();\n      this.node.getPosition(oldPos);\n      const newPos = oldPos.add(this.moveDir.mul(this._moveSpeed / 120));\n      this.node.setPosition(newPos);\n    }\n  }\n\n  update(dt) {\n    switch (this._speedType) {\n      case SpeedType.STOP:\n        this._moveSpeed = this.stopSpeed;\n        break;\n      case SpeedType.NORMAL:\n        this._moveSpeed = this.normalSpeed;\n        break;\n      case SpeedType.FAST:\n        this._moveSpeed = this.fastSpeed;\n        break;\n      default:\n        break;\n    }\n    if (this._speedType !== SpeedType.STOP) {\n      this.move();\n    }\n  }\n}\n"]}