{"version":3,"sources":["assets\\Scripts\\GuaJi\\GuaJiJianShi.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import GuaJiManager from \"./GuaJiManager\";\r\nimport GuaJiMonster from \"./GuaJiMonster\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GuaJiJianShi extends cc.Component {\r\n\r\n    jianshi_type:number=1;\r\n    move_speed:number=1600;\r\n    move_direction:number=Math.PI/2;\r\n    jiantou_dis:number=16;\r\n    is_att:boolean=false;\r\n    offset_xx_angle:number=90;\r\n\r\n    collision_monster_callback:Function=null;\r\n    max_move_distance:number=0;\r\n    cur_move_distance:number=0;\r\n    spin_speed:number=0;\r\n    init_finish_callback:Function=null;\r\n    /**加速度 */\r\n    acceleration:number=0;\r\n    /**拖尾*/\r\n    tuowei:cc.Node=null;\r\n\r\n    onLoad()\r\n    {\r\n        this.jiantou_dis=this.node.height/4;        \r\n    }\r\n\r\n    init(dir:number,jianshiType:number,isTuowei:boolean=false): void {\r\n        this.setDirection(dir);\r\n        this.is_att=false;\r\n        this.jianshi_type=jianshiType;\r\n        if(isTuowei){\r\n            this.tuowei=GuaJiManager.getInstance().createTuoWei(this.node.getPosition());\r\n        }\r\n    }\r\n\r\n    getJianTouPos():cc.Vec2\r\n    {\r\n        let xx=this.node.x+Math.cos(this.move_direction)*this.jiantou_dis;\r\n        let yy=this.node.y+Math.sin(this.move_direction)*this.jiantou_dis;\r\n        return cc.v2(xx,yy);\r\n    }\r\n\r\n    update (dt) {\r\n        this.move_speed+=this.acceleration;\r\n        let prevPos=this.node.getPosition();\r\n        let xx=this.move_speed*dt*Math.cos(this.move_direction);\r\n        let yy=this.move_speed*dt*Math.sin(this.move_direction);\r\n        this.node.x+=xx;\r\n        this.node.y+=yy;\r\n        if(this.node.y>cc.winSize.height){\r\n            this.destroySelf();\r\n        }\r\n        if(Math.abs(this.node.x)>cc.winSize.width){\r\n            this.destroySelf();\r\n        }\r\n        if(this.tuowei){\r\n            let pos=this.node.getPosition();\r\n            //添加在子弹前面            \r\n            let offsetPos=pos.sub(prevPos);\r\n            let distance=offsetPos.mag()*4;\r\n            let dir=Math.atan2(offsetPos.y,offsetPos.x);\r\n            let xx=pos.x+Math.cos(dir)*distance;\r\n            let yy=pos.y+Math.sin(dir)*distance;\r\n            this.tuowei.setPosition(cc.v2(xx,yy));\r\n        }\r\n    }\r\n\r\n    destroySelf()\r\n    {        \r\n        if(this.tuowei){            \r\n            let dt=this.tuowei.getComponent(cc.MotionStreak).fadeTime;\r\n            cc.tween(this.tuowei).delay(dt/10).removeSelf().start();\r\n            this.tuowei=null;\r\n        }\r\n        this.node.removeFromParent();\r\n    }\r\n\r\n    setDirection(dir:number)\r\n    {\r\n        this.move_direction=dir;\r\n        this.node.angle=180*dir/Math.PI-this.offset_xx_angle;\r\n    }\r\n    \r\n    ////--------------------------------------碰撞开始----------------------------------------------------\r\n    onCollisionEnter(other:cc.Collider,self:cc.Collider) {\r\n        let group=other.node.group;\r\n        switch(group){\r\n            case 'enemy':{\r\n                switch(this.jianshi_type){\r\n                    case 1:{\r\n                        if(this.is_att==false){\r\n                            let monsterTs=other.node.getComponent(GuaJiMonster);                    \r\n                            if(!monsterTs.getIsDie()){\r\n                                this.is_att=true;\r\n                                monsterTs.changeHp();\r\n                                GuaJiManager.getInstance().createHit(this.getJianTouPos());\r\n                                this.destroySelf();\r\n                            }\r\n                        }\r\n                    }break;\r\n                    case 2:{\r\n                        if(this.is_att==false){\r\n                            let monsterTs=other.node.getComponent(GuaJiMonster);                    \r\n                            if(!monsterTs.getIsDie()){\r\n                                this.is_att=true;\r\n                                monsterTs.changeHp();\r\n                                GuaJiManager.getInstance().createPetHit(this.getJianTouPos());\r\n                                this.destroySelf();\r\n                            }\r\n                        }\r\n                    }break;\r\n                }\r\n                \r\n            }break;\r\n        }\r\n    }\r\n}\r\n"]}