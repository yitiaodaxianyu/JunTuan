{"version":3,"sources":["assets\\Scripts\\Pet\\Ui\\PetExchangeUi.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import GameManager from \"../../GameManager\";\r\nimport { HeroManager } from \"../../Hero/Data/HeroManager\";\r\nimport { Hero_Type } from \"../../Hero/Game/HeroConfig\";\r\nimport LanguageManager from \"../../multiLanguage/LanguageManager\";\r\nimport TextLanguage from \"../../multiLanguage/TextLanguage\";\r\nimport { ItemManager } from \"../../Prop/Data/Item\";\r\nimport { PropAction } from \"../../Prop/PropConfig\";\r\nimport { PropManager } from \"../../Prop/PropManager\";\r\nimport { SoundIndex } from \"../../Sound/AudioConstants\";\r\nimport UIComponent from \"../../UI/UIComponent\";\r\nimport { UiAction } from \"../../UI/UiInterface\";\r\nimport { SpiritAttributeManager } from \"../Data/SpiritAttribute\";\r\nimport { PetMessage } from \"../PetConfig\";\r\nimport { PetManager } from \"../PetManager\";\r\nimport PetDataItem from \"./PetDataItem\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class PetExchangeUi extends UIComponent {\r\n\r\n    @property(cc.Prefab)\r\n    pet_data:cc.Prefab = null;\r\n\r\n    pet_id:number = null;\r\n    current_hero_type:number = Hero_Type.NULL;\r\n\r\n    initData(petId:number,heroType:number){\r\n        this.pet_id = petId;\r\n        this.current_hero_type = heroType;\r\n        this.refreshUi();\r\n    }\r\n\r\n    refreshUi(){\r\n        // let petList = PropManager.getInstance().getPetList();\r\n        let content = this.node.getChildByName(\"scrollView\").getComponent(cc.ScrollView).content;\r\n        let curRoot=this.node.getChildByName('curRoot');\r\n        let noWear=this.node.getChildByName('noWear');\r\n        if(this.pet_id){\r\n            \r\n            curRoot.active=true;\r\n            noWear.active=false;\r\n            this.node.getChildByName(\"bg\").color.a=200\r\n            this.node.getChildByName(\"titleLabel\").getComponent(TextLanguage).setTextId(640024)\r\n            //信息展示        \r\n            //装备Item\r\n            let item=PetManager.getInstance().getPetNodeById(this.pet_id,PropAction.Null,this.current_hero_type);\r\n            if(curRoot.getChildByName('propRoot').children.length>0){\r\n                curRoot.getChildByName('propRoot').children[0].destroy()\r\n            }\r\n            curRoot.getChildByName('propRoot').addChild(item);\r\n            //名称\r\n            let jsonItem=ItemManager.getInstance().getJsonItem(this.pet_id);\r\n            let propName=curRoot.getChildByName('propName');\r\n            propName.getComponent(cc.Label).string=\"[\"+PropManager.getInstance().getPropQualityName(jsonItem.Quality)+\"]\"+LanguageManager.getInstance().getStrByTextId(jsonItem.NameTextId);\r\n            propName.color=PropManager.getInstance().getPropQualityTextColor(jsonItem.Quality);\r\n            let Outlinecolor=[new cc.Color(39, 35, 28),new cc.Color(29, 63, 27),new cc.Color(25, 55, 88),new cc.Color(66, 37, 96),new cc.Color(62, 32, 0),new cc.Color(79, 16, 15)]\r\n            // console.log(\"______\",jsonItem.Quality)\r\n            propName.getComponent(cc.LabelOutline).color=Outlinecolor[(jsonItem.Quality)]\r\n            //战力数\r\n            curRoot.getChildByName('zhanliNum').getComponent(cc.Label).string=PetManager.getInstance().getPetZhanLi(this.pet_id)+\"\";\r\n        }else{\r\n            curRoot.active=false;\r\n            noWear.active=true;\r\n            this.node.getChildByName(\"bg\").color.a=128\r\n            this.node.getChildByName(\"titleLabel\").getComponent(TextLanguage).setTextId(640023)\r\n        }\r\n        // 重新初始化所有\r\n        content.removeAllChildren();\r\n        let petList = PropManager.getInstance().getPetList();\r\n        let petMessage=new PetMessage();\r\n        petMessage.pet_id=this.pet_id;\r\n        petMessage.pet_num=1;\r\n        let temp1=new Array();\r\n        let temp2=new Array();\r\n        for(let i=0; i<petList.length; i++){\r\n            let info=petList[i];\r\n            let heroList=HeroManager.getInstance().getWearPetHeroList(info);\r\n            let remainNum=info.pet_num-heroList.length;\r\n            if(remainNum>0){\r\n                let prop=new PetMessage();\r\n                prop.pet_id=info.pet_id;\r\n                prop.pet_num=remainNum;\r\n                temp1.push({\r\n                    equipInfo:prop,\r\n                    heroType:Hero_Type.NULL\r\n                })\r\n            }\r\n            for(let n=0; n<heroList.length; n++){\r\n                let heroType=heroList[n];\r\n                if(heroType!=this.current_hero_type){\r\n                    let prop=new PetMessage();\r\n                    prop.pet_id=info.pet_id;\r\n                    prop.pet_num=1;\r\n                    temp2.push({\r\n                        equipInfo:prop,\r\n                        heroType:heroType\r\n                    });\r\n                }                \r\n            }            \r\n        }\r\n        temp1.sort(this.sort1);\r\n        temp2.sort(this.sort1);\r\n        let temp = new Array();\r\n        temp = temp.concat(temp1,temp2);\r\n        for(let i=0; i<temp.length; i++){\r\n            let info=temp[i];\r\n            // if(this.equip_info&&info.sequence_id==this.equip_info.sequence_id){\r\n            //     continue;\r\n            // }\r\n            this.scheduleOnce(()=>{\r\n                let item=cc.instantiate(this.pet_data);\r\n                content.addChild(item);\r\n                item.getComponent(PetDataItem).initData(info.equipInfo,petMessage,this.current_hero_type,(id:number)=>{\r\n                    super.onRefresh(id);\r\n                    this.clickBtnClose();\r\n                },info.heroType);\r\n            },0.02*i);\r\n        }\r\n    }\r\n    \r\n    clickBtnClose(){\r\n        let content = this.node.getChildByName(\"scrollView\").getComponent(cc.ScrollView).content;\r\n        content.removeAllChildren();\r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.click);\r\n        super.onClose();\r\n    }\r\n\r\n    sort1(a:any,b:any):number{\r\n        let infoA = SpiritAttributeManager.getInstance().getJsonSpiritAttribute(a.equipInfo.pet_id);\r\n        let infoB = SpiritAttributeManager.getInstance().getJsonSpiritAttribute(b.equipInfo.pet_id);\r\n        if(infoA.Stage != infoB.Stage){\r\n            return infoB.Stage - infoA.Stage;\r\n        }else{\r\n            // return this.sort2(a.equipInfo.pet_id,b.equipInfo.pet_id);\r\n            return PetManager.getInstance().getPetZhanLi(b.equipInfo.pet_id) - PetManager.getInstance().getPetZhanLi(a.equipInfo.pet_id)\r\n        }\r\n    }\r\n\r\n    sort2(a:number,b:number):number{\r\n        return PetManager.getInstance().getPetZhanLi(a) - PetManager.getInstance().getPetZhanLi(b);\r\n    }\r\n\r\n}\r\n"]}