{"version":3,"sources":["assets\\Scripts\\Pet\\Game\\ParabolicBomb.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport GameManager from \"../../GameManager\";\r\nimport { SoundIndex } from \"../../Sound/AudioConstants\";\r\nimport { GameEffectId, GameEffectsManager } from \"../../Game/GameEffectsManager\";\r\nimport GroundManager from \"../../Game/GroundManager\";\r\nimport { GongJiData } from \"../../Hero/Data/HeroData\";\r\nimport { GameState } from \"../../Constants\";\r\nimport MonsterManager from \"../../Monster/MonsterManager\";\r\nimport Monster from \"../../Monster/Monster\";\r\nimport GongJi from \"../../Hero/Game/GongJi\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class ParabolicBomb extends GongJi {\r\n    \r\n    @property({type:cc.Prefab})\r\n    tuowei:cc.Prefab=null;\r\n\r\n    game_effect_id:GameEffectId=GameEffectId.Null;\r\n    move_speed:number=700;\r\n    move_direction:number=Math.PI/2;\r\n\r\n    bomb_size:number=100;\r\n    //目标地点，到达后爆炸\r\n    target_pos:cc.Vec2=null;\r\n\r\n    tuo_wei:cc.Node=null;\r\n    prev_pos:cc.Vec2=cc.v2(0,0);\r\n    /**蔓延特效 */\r\n    spread_time:number=0.2;\r\n    /**蔓延位置 */\r\n    spread_pos:cc.Vec2[]=[];\r\n\r\n    init(id:GameEffectId,speed:number,targetPos:cc.Vec2,gjData:GongJiData,size:number)\r\n    {\r\n        super.initData(gjData);\r\n        this.game_effect_id=id;\r\n        this.move_speed=speed;\r\n        this.target_pos=targetPos;        \r\n\r\n        let offsetPos=targetPos.sub(this.node.getPosition());\r\n        this.move_direction=Math.atan2(offsetPos.y,offsetPos.x);\r\n        //距离\r\n        let distance=offsetPos.mag();\r\n        //let dt=cc.director.getDeltaTime();\r\n        let sp=this.move_speed/GameManager.getInstance().getGameRate();\r\n        this.spread_time=0.02*GameManager.getInstance().getGameRate();\r\n        //帧率比，适配高刷率设备\r\n        //let frameRate=cc.director.getDeltaTime()\r\n        let jtTime=distance/sp/GameManager.getInstance().getGameRate();\r\n        this.node.scale=0.5;\r\n        cc.tween(this.node).then(cc.spawn(cc.sequence(cc.scaleTo(jtTime/4,1.1),cc.scaleTo(jtTime*3/4,0.8)),cc.jumpTo(jtTime,targetPos,distance/2.5,1))).call(this.destroySelf,this).start();\r\n        this.bomb_size=size;\r\n        // let node=GroundManager.getInstance().createGameEffectById(GameEffectId.pet_attackt_hit_2,this.target_pos);\r\n        // node.setContentSize(size);\r\n        // cc.tween(node).delay(jtTime).call(()=>{\r\n        //     GameEffectsManager.getInstance().destroyGameEffectById(GameEffectId.pet_attackt_hit_2,node);\r\n        // }).start();\r\n\r\n        this.tuo_wei=cc.instantiate(this.tuowei)\r\n        this.tuo_wei.parent=this.node.parent;\r\n        this.node.zIndex=1;\r\n        this.prev_pos=this.node.getPosition();\r\n        let ms=this.tuo_wei.getComponent(cc.MotionStreak);\r\n        ms.fadeTime=ms.fadeTime*GameManager.getInstance().getGameRate();\r\n\r\n        this.spread_pos=new Array(4);\r\n        let len=this.spread_pos.length;\r\n        for(let i=0; i<len; i++)\r\n        {\r\n            this.spread_pos[i]=this.node.getPosition();\r\n        }\r\n    }\r\n\r\n    destroySelf()\r\n    {\r\n        if(this.tuo_wei){\r\n            cc.tween(this.tuo_wei).delay(this.tuo_wei.getComponent(cc.MotionStreak).fadeTime/(10*GameManager.getInstance().getGameRate())).removeSelf().start();\r\n        }\r\n        if(this.game_effect_id==GameEffectId.pet_attackt_curve_1){\r\n            this.createBomb1();\r\n        }else if(this.game_effect_id==GameEffectId.pet_attackt_curve_3){\r\n            this.createBomb2();\r\n        }\r\n        \r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.YX_boom2);\r\n        GameEffectsManager.getInstance().destroyGameEffectById(this.game_effect_id,this.node);\r\n        this.tuo_wei=null;\r\n    }\r\n\r\n    setDirection(dir:number)\r\n    {\r\n        this.move_direction=dir;\r\n        //this.node.angle=180*dir/Math.PI;\r\n    }\r\n\r\n    createBomb1(){\r\n        let baozha=GameEffectsManager.getInstance().createGameEffectById(GameEffectId.pet_attackt_hit_1,this.target_pos);\r\n        GroundManager.getInstance().createGameEffectById(GameEffectId.pet_attackt_hit_2,this.target_pos);\r\n        let monsters=MonsterManager.getInstance().getMonstersForCenterPos(-1,this.target_pos,80);\r\n        if(monsters){\r\n            for(let i=0; i<monsters.length; i++){\r\n                let monsterTs=monsters[i].getComponent(Monster);\r\n                monsterTs.beFlashInjured(this.gongji_data);\r\n            }\r\n        }\r\n    }\r\n\r\n    createBomb2(){\r\n        let baozha=GameEffectsManager.getInstance().createGameEffectById(GameEffectId.pet_attackt_hit_3,this.target_pos);\r\n        GroundManager.getInstance().createGameEffectById(GameEffectId.pet_attackt_hit_4,this.target_pos);\r\n        let monsters=MonsterManager.getInstance().getMonstersForCenterPos(-1,this.target_pos,80);\r\n        if(monsters){\r\n            for(let i=0; i<monsters.length; i++){\r\n                let monsterTs=monsters[i].getComponent(Monster);\r\n                monsterTs.beFlashInjured(this.gongji_data);\r\n            }\r\n        }\r\n    }\r\n\r\n    createSpread(){\r\n        let weiyanId=GameEffectId.pet_attackt_tuowei_2;\r\n        if(this.game_effect_id==GameEffectId.pet_attackt_curve_1){\r\n            weiyanId=GameEffectId.pet_attackt_tuowei_2;\r\n        }else if(this.game_effect_id==GameEffectId.pet_attackt_curve_3){\r\n            weiyanId=GameEffectId.pet_attackt_tuowei_3;\r\n        }\r\n        let node=GameEffectsManager.getInstance().createGameEffectById(weiyanId,this.spread_pos[this.getPosIndex()])\r\n        node.angle=Math.random()*360;\r\n        node.scale=Math.random()*0.5+0.8;\r\n    }\r\n    \r\n\r\n    private getPosIndex():number\r\n    {\r\n        let maxCL=this.spread_pos.length-1;\r\n        let index=Math.floor(this.spread_pos.length/GameManager.getInstance().getGameRate());\r\n        if(index>=maxCL)\r\n        {\r\n            index=maxCL;\r\n        }\r\n        return index;\r\n    }\r\n\r\n    update (dt) {\r\n        if(GameManager.getInstance().cur_game_state!=GameState.Game_Playing)\r\n        return;\r\n        if(this.tuo_wei){\r\n            let gr=GameManager.getInstance().getGameRate();\r\n            if(gr<1){\r\n                gr=1;\r\n            }\r\n            let pos=this.node.getPosition();\r\n            //添加在子弹前面            \r\n            let offsetPos=pos.sub(this.prev_pos);\r\n            let distance=offsetPos.mag()*4/gr;\r\n            let dir=Math.atan2(offsetPos.y,offsetPos.x);\r\n            let xx=pos.x+Math.cos(dir)*distance;\r\n            let yy=pos.y+Math.sin(dir)*distance;\r\n            this.tuo_wei.setPosition(cc.v2(xx,yy));\r\n            //this.tuo_wei.setPosition(this.node.position);\r\n            this.prev_pos=this.node.getPosition();\r\n            this.spread_time-=dt;\r\n            this.update_locus_shadow();\r\n            if(this.spread_time<=0){\r\n                this.spread_time=0.02*GameManager.getInstance().getGameRate();\r\n                this.createSpread();\r\n            }\r\n            \r\n        }\r\n    }\r\n\r\n    update_locus_shadow()\r\n    {\r\n        //加入头部\r\n        this.spread_pos.unshift(this.node.getPosition());\r\n        //删除尾部\r\n        this.spread_pos.pop();  \r\n    }\r\n}\r\n"]}