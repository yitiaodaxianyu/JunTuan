---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by hkc.
--- DateTime: 2021/4/9 10:04
---

local GameScene = class("GameScene", cc.Scene)
function GameScene:ctor()
    self:enableNodeEvents()
end

function GameScene:onEnter()
    cc.Director:getInstance():setAnimationInterval(1.0 / 60.0)
    local layer = require("JunTuan.src.views.MainView").new({parent = self})
    self:addChild(layer, 1)

    -- 回退键退出游戏
    local listener = cc.EventListenerKeyboard:create()
    listener:registerScriptHandler(function(keyCode, event)
        if keyCode == cc.KeyCode.KEY_BACK then
            printf("回退键退出游戏")
            confirm("确定退出游戏吗？", function ()
                local platform = DeviceUtil.Platform()
                if platform == "ios" then  -- iOS设备
                    os.exit()
                else
                    cc.Director:getInstance():endToLua()
                end
            end)
        end
    end, cc.Handler.EVENT_KEYBOARD_PRESSED)
    local eventDispatcher = self:getEventDispatcher()
    eventDispatcher:addEventListenerWithSceneGraphPriority(listener, self)
end

function GameScene:onExit()
    local isLoginOut = GameDB.GetNumForKey("isLoginOut", 0)
    UserData.Shared():onExit()
    if isLoginOut == 0 then
        display.removeUnusedSpriteFrames()
    end
end

return GameScene