---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by hkc.
--- DateTime: 2021/6/1 13:40
---

-- 军衔进阶展示
local RoleRankUpView = class("RoleRankUpView", ViewBase)

function RoleRankUpView:ctor(para)
    self:enableNodeEvents()
    self:initData(para)
end

function RoleRankUpView:onEnter()
    self:initView()
    self:addNotify()
end

function RoleRankUpView:initData(para)
    self.roleData = para
end

function RoleRankUpView:initView()
    local para = {
        csb = JunTuanCfg.csbCfg.heroView.hero_rank_show,
        setSize = true
    }
    local ui = ViewBase:createCSB(para)
    self:addChild(ui)

    local panel_blue = ui:getChildByName("Panel_blue")
    local img_bg = panel_blue:getChildByName("img_bg")--:hide()
    img_bg:loadTexture("res/JunTuan/img/bg_pop_set_jtdzz.png", 0)
    img_bg:setScale9Enabled(true)
    img_bg:setCapInsets(cc.rect(10, 10, 553, 562))

    local img_light = panel_blue:getChildByName("img_light")
    img_light:runAction(cc.RepeatForever:create(cc.RotateBy:create(0.1, 20)))

    local panel_gunner = panel_blue:getChildByName("Panel_gunner")
    local panel_detail = panel_blue:getChildByName("Panel_detail")
    self:initPanelGunner(panel_gunner)
    self:initPanelDetail(panel_detail)

    local btn_share = panel_blue:getChildByName("btn_share")
    local btn_close = panel_blue:getChildByName("Panel_close")
    local function btnCall()
        self:destroyAni(panel_blue, function ()
            self:removeFromParent()
        end)
    end
    ExternalTools:addBtnTouchEventListener(btn_share, btnCall)
    ExternalTools:addBtnTouchEventListener(btn_close, btnCall)
end

function RoleRankUpView:initPanelGunner(panel)
    local roleId = self.roleData.roleId
    local roleRank = self.roleData.roleRank
    local jobs = { "弓箭手", "炮手", "狙击手", "喷火兵", "忍者", "荆棘巫女" }
    local s = panel:getContentSize()
    local ani = AnimationMgr:createHeroSpine(roleId, roleRank)
    ani:setPosition(cc.p(s.width / 2, s.height / 2))
    ani:setAnimation(0, "cemian_daiji", true)
    panel:addChild(ani)
    local txt_gunner = panel:getChildByName("Text_gunner")
    txt_gunner:setString(jobs[roleId])
end

function RoleRankUpView:setValueTxt(list, type, value)
    for i , v in pairs(list) do
        if i == type then
            v:setString("+" .. value .. "%")
        else
            v:setString("+0%")
        end
    end
end

function RoleRankUpView:initPanelDetail(panel)
    local roleId = self.roleData.roleId
    local roleRank = self.roleData.roleRank
    local data = GameTool:getRankData(roleId, roleRank)
    local img_level = panel:getChildByName("img_level")
    local name = string.format("img_level%d_hero_jtdzz.png", roleRank)
    img_level:loadTexture(name, 1)

    local txt_rank = panel:getChildByName("Text_rank")              -- 军衔名称
    local txt_tip = panel:getChildByName("Text_tip_2")              -- 技能等级
    local txt_detail_1 = panel:getChildByName("Text_detail_1")      -- 属性1值
    local txt_detail_2 = panel:getChildByName("Text_detail_2")      -- 属性2值
    local txt_detail_3 = panel:getChildByName("Text_detail_3")      -- 属性3值
    local txt_skill_1 = panel:getChildByName("Text_skill_1")        -- 技能描述
    local txt_skill_2 = panel:getChildByName("Text_skill_2")        -- 技能数值

    local list = { [5] = txt_detail_1, [3] = txt_detail_2, [4] = txt_detail_3 }
    self:setValueTxt(list, data.ValueType, data.Value / 100)

    txt_rank:setString(GameTool:getRankString(roleRank))
    txt_tip:setString(string.format("超级技能LV%d", roleRank))
    local v1, v2 = data.value1 / 100, data.value2
    GameTool:setTxtSkillTip(roleId, txt_skill_1, txt_skill_2, v1, v2)
    ExternalTools:txtAutoWidth(txt_skill_2, 340)
end

function RoleRankUpView:addNotify()

end

function RoleRankUpView:removeNotify()

end

function RoleRankUpView:onExit()
    self:removeNotify()
end

return RoleRankUpView