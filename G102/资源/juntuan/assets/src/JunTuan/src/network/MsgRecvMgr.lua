---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by hkc.
--- DateTime: 2021/4/28 15:54
---

-- 消息接收管理器

local cmdCode = require("src.macros.CMD_Game")
local cmdGame = require("src.JunTuan.src.network.CMD_Game")
local MsgHandler = require("src.JunTuan.src.network.MsgHandler"):getInstance()
local MsgRecvMgr = class("MsgRecvMgr")

function MsgRecvMgr.Shared()
    if nil == _G["JunTuanMsgRecvMgr.obj"] then
        _G["JunTuanMsgRecvMgr.obj"] = MsgRecvMgr.new()
    end
    return _G["JunTuanMsgRecvMgr.obj"]
end

function MsgRecvMgr:cacheMsg(mainCMD, subCMD, data)
    print(string.format("recvMsg cacheMsg, mainCMD:%d, subCMD:%d", mainCMD, subCMD))
    local msg = { mainCMD = mainCMD, subCMD = subCMD, data = data }
    table.insert(MsgHandler.earlyMessage, msg)
end

-- 判断哪些消息需要在场景初始化后处理
function MsgRecvMgr:isCacheMsg(mainCMD, subCMD)

end

function MsgRecvMgr:receiveCallFunc(mainCMD, subCMD, data)
    printf("MsgRecvMgr.receiveCallFunc"..mainCMD);
    if mainCMD == cmdGame.MDM_CS_MAIN_LOGIC then
        -- 主逻辑
        self:mainReceive(subCMD, data)
    elseif mainCMD == cmdCode.MDM_GF_FRAME then
        -- 框架消息
        self:frameReceive(subCMD, data)
    elseif mainCMD == cmdCode.MDM_GR_USER then
        -- 用户消息
        self:userReceive(subCMD, data)
    elseif mainCMD == cmdGame.MDM_GF_GAME then
        -- 游戏消息
        self:gameReceive(subCMD, data)
    else
        -- 其他消息
        --self:otherReceive(mainCMD, subCMD, data)
    end
end

function MsgRecvMgr:frameReceive(subCMD, data)
    print("收到框架消息消息, subCMD", subCMD)
    if subCMD == cmdGame.SUB_GF_GAME_SCENE then
        -- 场景消息
        MsgHandler:onGameSceneMsg(data)
    elseif subCMD == cmdCode.SUB_GF_SYSTEM_MESSAGE then
        -- 系统消息
        MsgHandler:onSystemMsg(data)
    end
end

function MsgRecvMgr:mainReceive(subCMD, data)
    -- printf("---------- 收到游戏主逻辑消息 ----------")
    -- printf("subCMD is %d", subCMD)
    -- printf("---------- 收到游戏主逻辑消息 ----------")
    if subCMD == cmdGame.SUB_G_USER_LOGIN then
        -- 用户登入
    elseif subCMD == cmdGame.SUB_G_USER_DISCONNECTED then
        -- 用户断线
    elseif subCMD == cmdGame.SUB_G_USER_RECONNECT then
        -- 用户重连
    end
end

function MsgRecvMgr:userReceive(subCMD, data)
    if subCMD == cmdCode.SUB_GR_USER_STATUS then
        MsgHandler:onUserStatus(data)
    end
end

function MsgRecvMgr:gameReceive(subCMD, data)
    printf("---------- 收到游戏消息 ----------")
    printf("subCMD is %d", subCMD)
    --printf(data)
    printf("---------- 收到游戏消息 ----------")

    if subCMD == cmdGame.SUB_SC_ROLE_LEVELUP or subCMD == cmdGame.SUB_SC_ROLE_RANKUP then
        -- 升级升阶用的同一个返回
        MsgHandler:onRoleLevelUp(data)
    else
        local handle = MsgHandler:getMessageHandle(subCMD);
        if handle then
            handle(data);
        end
    end
end

function MsgRecvMgr:otherReceive(mainCMD, subCMD, data)
    --printf("---------- 收到其他消息 ----------")
    --printf("mainCMD is %d", mainCMD)
    --printf("subCMD is %d", subCMD)
    --printf("---------- 收到其他消息 ----------")
end

return MsgRecvMgr
