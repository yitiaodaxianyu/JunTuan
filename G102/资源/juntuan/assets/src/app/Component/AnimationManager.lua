---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by hkc.
--- DateTime: 2020/1/6 17:49
---

local aniMgr = class("AnimationMgr")

local frameCache = cc.SpriteFrameCache:getInstance()

-- 创建spine动画对象
function aniMgr:createSpine(name, scale)
    if name then
        scale = scale or 1
        return sp.SkeletonAnimation:create(name .. ".json", name .. ".atlas", scale)
        --local sp = sp.SkeletonAnimation:createFromCache(name)
        --sp:setScale(scale)
        --return sp
    end
    return nil
end

-- 创建帧动画对象
function aniMgr:createAnimate(nameAry, dt)
    local animation = cc.Animation:create()
    for i = 1, #nameAry do
        local spriteFrame = frameCache:getSpriteFrame(nameAry[i])
        if spriteFrame then
            animation:addSpriteFrame(spriteFrame)
        else
            print("createAnimate error not find", nameAry[i])
        end
    end
    animation:setDelayPerUnit(dt)
    animation:setRestoreOriginalFrame(true)
    return cc.Animate:create(animation)
end

-- 加动画缓存，file:frame前缀名, aniName:动画名, frameNum:动画帧数, time:动画时间, format:方便加载不同的命名格式
function aniMgr:addAniToCache(file, aniName, frameNum, time, format, startFrame)
    local frames = {}
    local actionTime = time
    startFrame = startFrame or 1
    for i = startFrame, frameNum do
        local frameName
        if format == 1 then
            frameName = string.format(file .. "%d.png", i - 1)
        elseif format == 2 then
            frameName = string.format(file .. "%02d.png", i - 1)
        elseif format == 3 then
            frameName = string.format(file .. "%d.png", i)
        elseif format == 4 then
            frameName = string.format(file .. "%02d.png", i)
        end
        local frame = cc.SpriteFrameCache:getInstance():getSpriteFrame(frameName)
        frames[i] = frame
    end

    local animation = cc.Animation:createWithSpriteFrames(frames, actionTime)
    cc.AnimationCache:getInstance():addAnimation(animation, aniName)
end

function aniMgr:createHeroSpine(heroType, heroRank)
    local info = {
        file = string.format("res/JunTuan/spine/player/0%d_01", heroType)
    }
    local animation = self:createSpine(info.file, 1)
    animation:setSkin("stage" .. heroRank + 1)
    animation:setAnimation(0, "zhengmian_daiji", true)
    return animation
end

function aniMgr:createEnemySpine(enemyID)
    local info = {
        file = string.format("res/JunTuan/spine/enemy/guai_%02d", enemyID)
    }
    local animation = self:createSpine(info.file, 1)
    if enemyID == 21 then
        animation:setAnimation(0, "daiji", true)
    else
        animation:setAnimation(0, "animation", true)
    end
    return animation
end

return aniMgr