{"version":3,"sources":["assets\\Scripts\\Level\\LevelManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { IsDebug } from \"../Constants\";\r\nimport { HeroBaseInfoManager } from \"../Hero/Data/HeroBaseInfo\";\r\nimport { StorageKey } from \"../Storage/StorageConfig\";\r\nimport { TheStorageManager } from \"../Storage/StorageManager\";\r\nimport TutorailsManager from \"../Tutorials/TutorailsManager\";\r\nimport { FirstCompleteRewardManager } from \"./FirstCompleteReward\";\r\nimport { MissionLevelManager } from \"./MissionLevel\";\r\nimport { OfflineRevenueShowManager } from \"./OfflineRevenueShow\";\r\nimport { TutorialLevelManager } from \"./TutorialLevel\";\r\n\r\nexport class LevelManager {\r\n\r\n    private static _instance: LevelManager = null;\r\n\r\n    private best_level:number=0;\r\n\r\n    item_nums:number[]=[];\r\n    is_need_strengthen:boolean=false;\r\n    public maininterfacemap:Map<string,cc.SpriteFrame>=null;\r\n\r\n    get finish_level():number\r\n    {        \r\n        return this.best_level;\r\n    }\r\n\r\n    set finish_level(level)\r\n    {\r\n        this.saveFinishLevel(level);\r\n    }\r\n\r\n    private game_start_level:number=0;\r\n\r\n    get start_level():number\r\n    {\r\n        let level=0;\r\n        level=this.game_start_level;\r\n        return level;\r\n    }\r\n\r\n    set start_level(level)\r\n    {\r\n        this.saveStartLevel(level);\r\n    }\r\n    \r\n    public static getInstance():LevelManager {\r\n        if(this._instance==null) {\r\n            this._instance=new LevelManager();\r\n            this._instance.init();\r\n        }\r\n        return this._instance;\r\n    }\r\n    //初始化游戏数据\r\n    private init () {\r\n        // console.log(\"______________________\")\r\n        FirstCompleteRewardManager.getInstance();\r\n        MissionLevelManager.getInstance();\r\n        OfflineRevenueShowManager.getInstance();\r\n        this.loadSpmaininterfacemap()\r\n        this.loadFinishLevel();\r\n        this.loadStartLevel();\r\n        if(!TutorailsManager.getInstance().is_finish_game){            \r\n            TutorialLevelManager.getInstance();\r\n        }\r\n    }\r\n    //-----------------------资源的读取-----------------------------\r\n    \r\n\r\n    //-----------------------数据保存与读取-----------------------------\r\n    \r\n    private loadFinishLevel()\r\n    {\r\n        let level=cc.sys.localStorage.getItem('finish_level');\r\n        if(level===\"\" || level===null)\r\n        {\r\n            level=0;\r\n            this.saveFinishLevel(level);\r\n        }else\r\n        {\r\n            if(level>=1){\r\n                if(TutorailsManager.getInstance().is_finish_game==false){\r\n                    TutorailsManager.getInstance().saveFinishFromGame();\r\n                }\r\n            }\r\n        }\r\n        this.best_level=parseInt(level);     \r\n    }\r\n\r\n    private saveFinishLevel(level)\r\n    {\r\n        if(level>this.best_level && level<=MissionLevelManager.getMaxLevel())\r\n        {\r\n            this.best_level=level;\r\n            cc.sys.localStorage.setItem('finish_level',this.best_level);            \r\n        }\r\n    }\r\n    //\r\n    loadStartLevel()\r\n    {\r\n        let level=cc.sys.localStorage.getItem('start_level');\r\n        if(level===\"\" || level===null)\r\n        {\r\n            level=1;\r\n            this.saveStartLevel(level);\r\n        }else\r\n        {\r\n\r\n        }\r\n        this.game_start_level=parseInt(level);     \r\n    }\r\n\r\n    saveStartLevel(level)\r\n    {\r\n        if(level<=1)\r\n        {\r\n            level=1;\r\n        }else\r\n        if(level>MissionLevelManager.getMaxLevel())\r\n        {\r\n            level=MissionLevelManager.getMaxLevel();\r\n        }\r\n        this.game_start_level=level;\r\n        cc.sys.localStorage.setItem('start_level',this.game_start_level);              \r\n    }\r\n\r\n    saveLevelWave(level:number,wave:number)\r\n    {\r\n        let waveNum=this.getLevelWave(level);\r\n        if(wave>waveNum)\r\n        {\r\n            cc.sys.localStorage.setItem('level_wave_'+level,wave); \r\n        }        \r\n    }\r\n\r\n    getLevelWave(level:number):number\r\n    {\r\n        let wave=cc.sys.localStorage.getItem('level_wave_'+level);\r\n        if(wave===\"\" || wave===null)\r\n        {\r\n            wave=0;\r\n        }else\r\n        {\r\n            wave=parseInt(wave);\r\n        }\r\n        return wave;\r\n    }\r\n\r\n    getPassNum(level:number):number\r\n    {\r\n        let num=cc.sys.localStorage.getItem('pass_level_'+level);\r\n        if(num!=\"\"&&num!=null)\r\n        {\r\n            num=parseInt(num);\r\n        }else\r\n        {\r\n            num=0;\r\n        }\r\n        return num;\r\n    }\r\n\r\n    setNotFirstPassLevel(level:number,wave:number)\r\n    {\r\n        cc.sys.localStorage.setItem('pass_level_'+level+'wave_'+wave,1);\r\n    }\r\n\r\n    /** 根据关卡获得一个关卡名称*/\r\n    static getLevelName(level:number):string\r\n    {                \r\n        return MissionLevelManager.getInstance().getLevelName(level);\r\n    }\r\n    \r\n    public getFinishChapter():number{\r\n        let level=this.finish_level+1;\r\n        level=level>MissionLevelManager.getMaxLevel()?MissionLevelManager.getMaxLevel():level;\r\n        return MissionLevelManager.getInstance().getChapter(level);\r\n    }\r\n\r\n    /**获得level关卡的所有星级，返回数组，1：第一个任务，2：第二个任务，3：第三个任务 */\r\n    getAllLevelStars(level:number):boolean[]{\r\n        let stars=[false,false,false];\r\n        let levelStars=TheStorageManager.getInstance().getJson(StorageKey.LevelStar+level,stars);\r\n        for(let i=0; i<stars.length; i++){\r\n            stars[i]=levelStars[i]>0;\r\n        }\r\n        return stars;\r\n    }\r\n    /**获得level关卡的starIndex的星级，返回是否有星星，1：第一个任务，2：第二个任务，3：第三个任务 */\r\n    getALevelStar(level:number,starIndex:number):boolean{        \r\n        let stars=[false,false,false];\r\n        // console.log(\"_____\",level,starIndex)\r\n        let levelStars=TheStorageManager.getInstance().getJson(StorageKey.LevelStar+level,stars);\r\n        return levelStars[starIndex-1]>0;\r\n    }\r\n    /**保存level的星级数组 */\r\n    saveAllLevelStars(level:number,newStars:boolean[]){\r\n        let stars=[false,false,false];\r\n        let levelStars=TheStorageManager.getInstance().getJson(StorageKey.LevelStar+level,stars);\r\n        for(let i=0; i<stars.length; i++){\r\n            if(levelStars[i]<=0){\r\n                levelStars[i]=newStars[i]?1:0;\r\n            }            \r\n        }\r\n        TheStorageManager.getInstance().setItem(StorageKey.LevelStar+level,JSON.stringify(levelStars));\r\n    }\r\n    /**保存level的starIndex是否有星级 */\r\n    saveALevelStar(level:number,starIndex:number,isHave:boolean=true){\r\n        let stars=[false,false,false];\r\n        let levelStars=TheStorageManager.getInstance().getJson(StorageKey.LevelStar+level,stars);\r\n        if(levelStars[starIndex-1]<=0){\r\n            levelStars[starIndex-1]=isHave?1:0;\r\n            TheStorageManager.getInstance().setItem(StorageKey.LevelStar+level,JSON.stringify(levelStars));\r\n        }\r\n    }\r\n\r\n            \r\n    private loadSpmaininterfacemap(){\r\n        if(this.maininterfacemap){\r\n            return;\r\n        }\r\n        this.maininterfacemap=new Map<string,cc.SpriteFrame>();\r\n        cc.resources.loadDir('map/maininterfacemap',cc.SpriteFrame,(error: Error, assets:cc.SpriteFrame[])=>{\r\n            if(error)\r\n            {\r\n                console.log(error);\r\n                return;\r\n            }\r\n            let len=assets.length;\r\n            for(let i=0; i<len; i++)\r\n            {\r\n\r\n                let sp=assets[i];\r\n                let name=sp.name;\r\n                this.maininterfacemap.set(name,sp);\r\n            }\r\n        })   \r\n    }\r\n\r\n}\r\n"]}