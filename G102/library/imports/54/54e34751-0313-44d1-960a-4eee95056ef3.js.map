{"version":3,"sources":["assets\\Scripts\\Hero\\TrackBullect.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameState } from \"../Constants\";\r\nimport GameManager from \"../GameManager\";\r\nimport { GongJiData } from \"./Data/HeroData\";\r\nimport Monster from \"../Monster/Monster\";\r\nimport { GameEffectId, GameEffectsManager } from \"../Game/GameEffectsManager\";\r\nimport GongJi from \"./Game/GongJi\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class TrackBullect extends GongJi {\r\n\r\n    //目标\r\n    target_node:cc.Node=null;\r\n    //目标位置\r\n    target_pos:cc.Vec2=cc.v2(0,0);\r\n    //移动速度\r\n    move_speed:number=300;\r\n    //移动方向\r\n    move_direction:number=Math.PI/2;\r\n    follow_callback:Function=null;\r\n    offset_xx_angle:number=90;\r\n    game_effect_id:number=0;    \r\n\r\n    init (gameEffectId:GameEffectId,targetNode:cc.Node,speed:number,gjData:GongJiData,offsetAngle:number=90) {\r\n        super.initData(gjData);\r\n        this.game_effect_id=gameEffectId;\r\n        this.target_node=targetNode;\r\n        this.target_pos=targetNode.getComponent(Monster).getJuJiPos();\r\n        let pi2=Math.PI*2;\r\n        let offsetPos=this.target_pos.sub(this.node.getPosition());\r\n        let dir=(Math.atan2(offsetPos.y,offsetPos.x)+pi2)%pi2;\r\n        this.node.scale=1;\r\n        this.setDirection(dir);\r\n        this.move_speed=speed;\r\n        this.offset_xx_angle=offsetAngle;\r\n        this.node.stopAllActions();\r\n    }\r\n\r\n    addArriveListen(callback:Function){\r\n        this.follow_callback=callback;\r\n    }\r\n\r\n    update(dt)\r\n    {\r\n        if(GameManager.getInstance().cur_game_state!=GameState.Game_Playing)\r\n        {\r\n            return;\r\n        }\r\n        //跟踪目标\r\n        let sp=this.move_speed*dt;\r\n        let disX=this.node.x;\r\n        let disY=this.node.y;\r\n        if(this.target_node)\r\n        {\r\n            let monsterTs=this.target_node.getComponent(Monster);\r\n            this.target_pos=monsterTs.getJuJiPos();\r\n            let offsetPos=this.target_pos.sub(this.node.getPosition());\r\n            if(offsetPos.mag()<sp)\r\n            {\r\n                //中了\r\n                if(this.follow_callback)\r\n                {\r\n                    this.follow_callback(monsterTs);\r\n                }\r\n            }else\r\n            {\r\n                let pi2=Math.PI*2;\r\n                let dir=(Math.atan2(offsetPos.y,offsetPos.x)+pi2)%pi2;\r\n                this.setDirection(dir);\r\n                disX+=sp*Math.cos(this.move_direction);\r\n                disY+=sp*Math.sin(this.move_direction);\r\n            }                \r\n        }else\r\n        {\r\n            disX+=sp*Math.cos(this.move_direction);\r\n            disY+=sp*Math.sin(this.move_direction);\r\n            let offsetPos=this.target_pos.sub(this.node.getPosition());\r\n            if(offsetPos.mag()<sp)\r\n            {\r\n                //消失\r\n                this.destroySelf();\r\n            }\r\n        }            \r\n        this.node.x=disX;\r\n        this.node.y=disY;\r\n    }\r\n\r\n    setDirection(dir:number)\r\n    {\r\n        this.move_direction=dir;\r\n        this.node.angle=180*dir/Math.PI-this.offset_xx_angle;\r\n    }\r\n\r\n    destroySelf()\r\n    {\r\n        GameEffectsManager.getInstance().destroyGameEffectById(this.game_effect_id,this.node);\r\n    }\r\n\r\n}\r\n"]}