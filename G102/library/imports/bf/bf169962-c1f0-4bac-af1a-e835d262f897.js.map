{"version":3,"sources":["assets\\Scripts\\Hero\\Game\\ZhenDe\\ZhenDe.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\nimport { GameState, IsDebug, JiaSu } from \"../../../Constants\";\r\nimport FightingManager from \"../../../Game/FightingManager\";\r\nimport { GameEffectId, GameEffectsManager } from \"../../../Game/GameEffectsManager\";\r\nimport SkillManager from \"../../../Game/SkillManager\";\r\nimport SkyManager from \"../../../Game/SkyManager\";\r\nimport GameManager from \"../../../GameManager\";\r\nimport Monster from \"../../../Monster/Monster\";\r\nimport { KeyFrameData } from \"../../../Monster/MonsterData\";\r\nimport { SoundIndex } from \"../../../Sound/AudioConstants\";\r\nimport MyTool from \"../../../Tools/MyTool\";\r\nimport WallManager from \"../../../Wall/WallManager\";\r\nimport { GongJiData } from \"../../Data/HeroData\";\r\nimport { HeroManager } from \"../../Data/HeroManager\";\r\nimport { BuffData } from \"../BuffData\";\r\nimport Hero from \"../Hero\";\r\nimport { BuffId, BuffType, DamageType, GongJi_FangXiang, Hero_State, Hero_Type, ShieldType, SkillType } from \"../HeroConfig\";\r\nimport ZhenDeDan from \"./ZhenDeDan\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class ZhenDe extends Hero {\r\n    /**治疗计数 */\r\n    zhiliao_jishu:number=0;\r\n    zhiliao_time:number=0;\r\n    cur_release_skill:SkillType=SkillType.Null; \r\n\r\n    onLoad()\r\n    {\r\n        super.onLoad();\r\n        //加载技能指示器\r\n        super.addLoadByGameEffectId(GameEffectId.zhen_de_attack,1);\r\n        super.addLoadByGameEffectId(GameEffectId.zhen_de_attack_hit,1);\r\n        super.addLoadByGameEffectId(GameEffectId.zhen_de_beidong_skill,1);\r\n        super.addLoadByGameEffectId(GameEffectId.zhen_de_beidong_skill_wall,1);\r\n        super.addLoadByGameEffectId(GameEffectId.zhen_de_active_skill_1,1);\r\n        super.addLoadByGameEffectId(GameEffectId.zhen_de_active_skill_2,2);\r\n        super.addLoadByGameEffectId(GameEffectId.zhen_de_active_skill_3,2);\r\n        super.addLoadByGameEffectId(GameEffectId.monster_zhiliao_halo_hit,2);\r\n        this.is_LoadLoad=true;\r\n        this.addSkillListen(this.useSkill);\r\n        this.addAttackListen(this.normalAttack);\r\n        this.addXuanYunListen(this.onXuanYunResult);\r\n        this.addGameWinListen(this.resetSkill);\r\n    }\r\n\r\n    start()\r\n    {        \r\n        super.start();\r\n        this.is_need_check_distance=false;\r\n        super.setSkillTipSize(1680,600);\r\n        this.zhiliao_time=this.hero_data.getSkillValue1(SkillType.Passive_1);\r\n    }\r\n\r\n    resetSkill(){\r\n        this.zhiliao_jishu=0;\r\n    }\r\n    \r\n    onXuanYunResult(isXuanYun:boolean){\r\n        if(isXuanYun){\r\n            this.unscheduleAllCallbacks();            \r\n        }else{\r\n            if(this.skill_queue.length>0){\r\n                this.startSkill(this.skill_queue.shift());\r\n            }else{\r\n                //根据上个状态判断需要做什么\r\n            this.setHeroState(Hero_State.idle,GongJi_FangXiang.zhong);\r\n            }            \r\n        }\r\n    }\r\n\r\n    //---------------------------------------------攻击----------------------------------------------\r\n    \r\n\r\n    createZhenDeDan(id:GameEffectId,jianshiPos:cc.Vec2,speed:number,dir:number,gjData:GongJiData){\r\n        let node=FightingManager.getInstance().createGameEffectById(id,jianshiPos);\r\n        node.getComponent(ZhenDeDan).init(id,speed,dir,gjData);\r\n    }   \r\n\r\n\r\n    normalAttack(monster:cc.Node)\r\n    {\r\n        if(GameManager.getInstance().cur_game_state!=GameState.Game_Playing)\r\n        return;\r\n        this.is_can_gongji=false;\r\n        this.startAttack(monster);\r\n    }\r\n\r\n    startAttack(enemyNode:cc.Node)\r\n    {\r\n        let enemyPos=enemyNode.getComponent(Monster).getSheShouPos();\r\n        let fangxiang=this.getFangXiangByPos(enemyPos);        \r\n        let data=new KeyFrameData();\r\n        data.name=\"Attack\";\r\n        data.callback=()=>{\r\n            GameManager.getInstance().sound_manager.playSound(SoundIndex.YX_ZDAttack);\r\n            let jianshiPos=this.getCreateBulletPos();\r\n            let offsetPos=enemyPos.sub(jianshiPos);\r\n            let jianshiDir=Math.atan2(offsetPos.y,offsetPos.x);\r\n            let gjData=super.getGongJiData(DamageType.Normal,true,SkillType.Null);\r\n            this.createZhenDeDan(GameEffectId.zhen_de_attack,jianshiPos,this.bullet_speed,jianshiDir,gjData);\r\n            if(this.is_double_attack){\r\n                this.resetNormalAttack();\r\n            }else{\r\n                this.gongji_jishu=0;\r\n            }        \r\n        }\r\n        super.setHeroState(Hero_State.attack,fangxiang,[data],()=>{\r\n            this.setHeroState(Hero_State.idle,this.cur_fangxiang);\r\n            /**概率 */\r\n            this.checkSkill2();\r\n        });\r\n    }\r\n\r\n    checkSkill2(){\r\n        if(this.hero_data.getIsUnlock(SkillType.Passive_2)){\r\n            let rate=this.hero_data.getSkillValue1(SkillType.Passive_2);\r\n            if(rate&&Math.random()<rate){\r\n                this.startSkill2();\r\n            }\r\n        }\r\n        \r\n    }\r\n    \r\n    startSkill1(){        \r\n        if(super.getHeroState()==Hero_State.idle&&super.isHaveDeBuff(BuffId.Monster_XuanYun)==false){\r\n            this.cur_release_skill=SkillType.Passive_1;\r\n            let data=new KeyFrameData();\r\n            data.name=\"Passive1\";\r\n            data.callback=()=>{\r\n                this.cur_release_skill=SkillType.Null;\r\n                this.gongji_jishu=0;\r\n                let buffData=new BuffData();\r\n                buffData.buff_id=BuffId.Hero_ZhenDe_JiaXueJianShang;\r\n                buffData.buff_type=BuffType.Gain;\r\n                buffData.buff_value=[this.hero_data.getSkillValue2(SkillType.Passive_1)*WallManager.getInstance().getMainWall().getMaxHp(),this.hero_data.getSkillValue3(SkillType.Passive_1)];\r\n                buffData.remain_time=5;\r\n                // buffData.game_effect_id=GameEffectId.chang_mao_shou_skill_active_1;\r\n                buffData.recovery_jiange_time=1;\r\n                WallManager.getInstance().getMainWall().addBuff(buffData)\r\n            }\r\n            super.setHeroStateAndAnimation(Hero_State.skill,\"Passive1\",false,[data],()=>{\r\n                this.setHeroState(Hero_State.idle,this.cur_fangxiang);\r\n                if(this.skill_queue.length>0){\r\n                    this.startSkill(this.skill_queue.shift());\r\n                }\r\n            });\r\n        }else{\r\n            this.skill_queue.push(SkillType.Passive_1);\r\n        }\r\n    }\r\n\r\n    startSkill2(){\r\n        // if(super.getHeroState()==Hero_State.idle&&super.isHaveDeBuff(BuffId.Monster_XuanYun)==false){\r\n        //     this.cur_release_skill=SkillType.Passive_2;      \r\n        //     let data=new KeyFrameData();\r\n        //     data.name=\"Passive1\";\r\n        //     data.callback=()=>{\r\n        //         this.cur_release_skill=SkillType.Null;\r\n        //         this.gongji_jishu=0;\r\n        //         let heroId=HeroManager.getInstance().getRandHeroId(GameManager.getInstance().cur_game_mode,this.hero_type,GameManager.getInstance().cur_team_list);\r\n        //         if(heroId!=Hero_Type.NULL){\r\n        //             let buffData=new BuffData();\r\n        //             buffData.buff_id=BuffId.Hero_ZhenDe_BaoJiMingZhongLv;\r\n        //             buffData.buff_type=BuffType.Gain;\r\n        //             buffData.buff_value=[this.hero_data.getSkillValue2(SkillType.Passive_2)];\r\n        //             buffData.remain_time=5;\r\n        //             buffData.game_effect_id=GameEffectId.Null;                \r\n        //             GameManager.getInstance().all_hero.get(heroId).addBuff(buffData);\r\n        //             //特效\r\n        //             SkyManager.getInstance().createGameEffectById(GameEffectId.zhen_de_beidong_skill,GameManager.getInstance().all_hero.get(heroId).node.getPosition());\r\n        //         }\r\n        //     }\r\n        //     super.setHeroStateAndAnimation(Hero_State.skill,\"Passive1\",false,[data],()=>{\r\n        //         this.setHeroState(Hero_State.idle,this.cur_fangxiang);\r\n        //         if(this.skill_queue.length>0){\r\n        //             this.startSkill(this.skill_queue.shift());\r\n        //         }\r\n        //     });\r\n        // }else{\r\n        //     this.skill_queue.push(SkillType.Passive_2);\r\n        // }\r\n\r\n        WallManager.getInstance().getMainWall().changeHp(WallManager.getInstance().getMainWall().getMaxHp()*(0.01+this.hero_lvl*0.002));\r\n        WallManager.getInstance().getMainWall().addHpBuff();\r\n        \r\n    }\r\n\r\n    startSkill(skillType:SkillType){\r\n        switch(skillType){            \r\n            case SkillType.Passive_1:{\r\n                this.startSkill1();\r\n            }break;\r\n            case SkillType.Passive_2:{\r\n                this.startSkill2();\r\n            }break;\r\n        }\r\n    }\r\n\r\n    //---------------------------------------------技能----------------------------------------------    \r\n    useSkill(pos:cc.Vec2):number\r\n    {\r\n        /**如果有控制技能 */\r\n        this.removeAllDeBuff();\r\n        SkillManager.getInstance().releaseSkill(()=>{\r\n            this.startSelfXuLi(pos);\r\n        },this.node);\r\n        if(this.cur_release_skill!=SkillType.Null){\r\n            this.skill_queue.push(this.cur_release_skill);\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    startSelfXuLi(pos:cc.Vec2){\r\n        //蓄力帧监听\r\n        let heroRoot=cc.find('Canvas/Hero_Root');\r\n        //发射帧监听\r\n        let fasheData=new KeyFrameData();\r\n        fasheData.name=\"FaShe\";\r\n        fasheData.callback=()=>{\r\n            //可以发射\r\n            SkillManager.getInstance().setTimeStop(false);\r\n            this.node.parent=heroRoot;\r\n            this.node.zIndex=2;\r\n            this.startLaunch(pos);\r\n        }\r\n        //英雄动作播放\r\n        this.setHeroState(Hero_State.skill,GongJi_FangXiang.zhong,[fasheData],()=>{\r\n            //动作完毕后状态还是技能状态，动画要播放待机的\r\n            this.resetGongJiJiShu();\r\n            this.setHeroState(Hero_State.idle,GongJi_FangXiang.zhong);\r\n            if(this.skill_queue.length>0){\r\n                this.startSkill(this.skill_queue.shift());\r\n            }\r\n        });\r\n        this.spine.timeScale=JiaSu;\r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.YX_ZDSkill);\r\n    }\r\n    /**在目标区域的左右两边各召唤一阵藤蔓冲击波，藤蔓冲击波会向屏幕另一端滚动，途中速度会逐渐加快，对触碰到的敌人造成{参数1}%伤害，并造成{参数2}秒眩晕效果 */\r\n    startLaunch(pos:cc.Vec2){\r\n        super.setAttSpineScale();\r\n        //专武\r\n        let ex1=this.hero_data.ExclusiveWeaponSkillValue_1;\r\n        let cdT=0;\r\n        if(ex1&&ex1>0){\r\n            cdT=ex1;\r\n        }\r\n        //光速下来\r\n        let light=SkyManager.getInstance().createGameEffectById(GameEffectId.zhen_de_active_skill_1,cc.v2(this.node.x,this.node.y+640));\r\n        cc.tween(light).to(0.1*GameManager.getInstance().getGameRate(),{y:this.node.y+this.xuanyun_pos.y}).call(()=>{\r\n            GameEffectsManager.getInstance().destroyGameEffectById(GameEffectId.zhen_de_active_skill_1,light);\r\n            GameEffectsManager.getInstance().createGameEffectById(GameEffectId.zhen_de_active_skill_2,light.getPosition());\r\n            // //左右两边的英雄加特效\r\n            // //如果是射手相邻的英雄，不包括自己\r\n            // let teamList=GameManager.getInstance().cur_team_list;\r\n            // let sheshouIndex=teamList.indexOf(this.hero_type);\r\n            // let buffValue=this.hero_data.getSkillValue1(SkillType.Active);\r\n            // let remainTime=this.hero_data.getSkillValue2(SkillType.Active);\r\n            // MyTool.randomSceneShakeSmall();\r\n            // WallManager.getInstance().getMainWall().removeAllDeBuff();\r\n            // GameManager.getInstance().all_hero.forEach((v,k)=>{\r\n            //     //特效\r\n            //     v.removeAllDeBuff();\r\n            //     let heroIndex=teamList.indexOf(k);\r\n            //     if(sheshouIndex!=heroIndex && Math.abs(sheshouIndex-heroIndex)<=1){\r\n            //         let buffData=new BuffData();\r\n            //         buffData.buff_id=BuffId.Hero_ZhenDe_Gongsu;\r\n            //         buffData.buff_type=BuffType.Gain;\r\n            //         buffData.game_effect_id=GameEffectId.zhen_de_active_skill_3;\r\n            //         buffData.buff_value=[buffValue];\r\n            //         buffData.remain_time=remainTime;\r\n            //         v.addBuff(buffData);\r\n            //     }\r\n            //     //减少除自己之外的cd\r\n            //     if(cdT>0&&v.hero_type!=this.hero_type){                    \r\n            //         v.changeCD(-cdT);\r\n            //     }\r\n            // })\r\n            //战车加护盾\r\n            WallManager.getInstance().getMainWall().addShield(this.hero_type,ShieldType.All,5,0.1*this.hero_data.total_hp,GameEffectId.zhen_de_beidong_skill_wall);\r\n            \r\n\r\n            // WallManager.getInstance().getMainWall().addShield(this.hero_type,ShieldType.All,this.hero_data.getSkillValue3(SkillType.Active),this.hero_data.getSkillValue3(SkillType.Active)*this.hero_data.total_hp);\r\n        }).start();\r\n        SkillManager.getInstance().setIsSkillState(false);\r\n    }\r\n\r\n    update(dt: number): void {\r\n        if(GameManager.getInstance().cur_game_state!=GameState.Game_Playing){\r\n            return;\r\n        }\r\n        super.update(dt);\r\n        this.zhiliao_jishu+=dt;\r\n        if(this.zhiliao_jishu>=this.zhiliao_time){\r\n            this.zhiliao_jishu=0;\r\n            //this.startSkill1();\r\n        }\r\n    }\r\n}\r\n"]}