{"version":3,"sources":["assets\\Scripts\\Pet\\PetManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { CombatEffectivenessManager } from \"../Hero/Data/CombatEffectiveness\";\r\nimport { HeroManager } from \"../Hero/Data/HeroManager\";\r\nimport { Hero_Type } from \"../Hero/Game/HeroConfig\";\r\nimport { PropAction, PropId } from \"../Prop/PropConfig\";\r\nimport { PropManager } from \"../Prop/PropManager\";\r\nimport { SpiritAttributeManager } from \"./Data/SpiritAttribute\";\r\nimport { SpiritCultivateManager } from \"./Data/SpiritCultivate\";\r\nimport { SpiritMessageManager } from \"./Data/SpiritMessage\";\r\nimport { SpiritSkillManager } from \"./Data/SpiritSkill\";\r\nimport { PetMessage } from \"./PetConfig\";\r\nimport PetItem from \"./Ui/PetItem\";\r\n\r\nexport enum SpiritType{\r\n    /**力量 */\r\n    strength=1,\r\n    /**敏捷 */\r\n    agility=2,\r\n    /**智力 */\r\n    intelligence=3,\r\n}\r\n\r\n\r\nexport class PetManager {\r\n\r\n    private static _instance: PetManager = null;\r\n\r\n    public static getInstance():PetManager {\r\n        if(this._instance==null) {\r\n            this._instance=new PetManager();\r\n            this._instance.init();\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    private item_pet:cc.Prefab=null;\r\n\r\n    //初始化游戏数据\r\n    private init () {\r\n        SpiritAttributeManager.getInstance();\r\n        SpiritCultivateManager.getInstance();\r\n        SpiritMessageManager.getInstance();\r\n        SpiritSkillManager.getInstance();\r\n        this.loadPrefab();\r\n    }\r\n\r\n    public loadPrefab(){\r\n        cc.resources.load('pet/ui/petItem',cc.Prefab,(error: Error, assets:cc.Prefab)=>{\r\n            if(error)\r\n            {\r\n                console.log(error);\r\n                return;\r\n            }\r\n            console.log('加载prefab_equip成功');\r\n            assets.addRef();\r\n            this.item_pet=assets;\r\n            //cc.resources.release(\"equipment/equipItem\",cc.Prefab);\r\n        });\r\n    }\r\n\r\n    getPetNodeByInfo(petMessage:PetMessage,pAc:PropAction=PropAction.Look,heroType:Hero_Type=Hero_Type.NULL):cc.Node{\r\n        let item=cc.instantiate(this.item_pet);\r\n        item.getComponent(PetItem).init(heroType,petMessage,pAc);\r\n        return item;\r\n    }\r\n\r\n    /**根据装备ID获得一个装备节点 */\r\n    public getPetNodeById(petId:number,pAc:PropAction=PropAction.Look,heroType:Hero_Type=Hero_Type.NULL):cc.Node{\r\n        let item=cc.instantiate(this.item_pet);\r\n        let petMessage=new PetMessage();\r\n        petMessage.pet_id=petId;\r\n        petMessage.pet_num=1;\r\n        item.getComponent(PetItem).init(heroType,petMessage,pAc);\r\n        // console.log(\"+++\",item)\r\n        return item;\r\n    }\r\n\r\n    // 获取单个宠物战力\r\n    getPetZhanLi(petId:number): number {\r\n        let zhanli=0;\r\n        let petInfo = SpiritAttributeManager.getInstance().getJsonSpiritAttribute(petId);\r\n        zhanli = \r\n        petInfo.Health * CombatEffectivenessManager.getInstance().getConversionFactor(1) \r\n        +  petInfo.Attack * CombatEffectivenessManager.getInstance().getConversionFactor(2)\r\n        +  petInfo.Defense * CombatEffectivenessManager.getInstance().getConversionFactor(3)\r\n        +  petInfo.Hit * CombatEffectivenessManager.getInstance().getConversionFactor(4)\r\n        +  petInfo.Miss * CombatEffectivenessManager.getInstance().getConversionFactor(5)\r\n        + ( petInfo.Critical) * CombatEffectivenessManager.getInstance().getConversionFactor(6)\r\n        +  petInfo.AntiCritical * CombatEffectivenessManager.getInstance().getConversionFactor(7)\r\n        + ( petInfo.ExtraCritical) * CombatEffectivenessManager.getInstance().getConversionFactor(8)\r\n        +  petInfo.AntiExtraCritical * CombatEffectivenessManager.getInstance().getConversionFactor(9)\r\n        zhanli=Math.round(zhanli);\r\n        return zhanli;\r\n    }\r\n\r\n\r\n    public getPetQualityTextColor(quality:number):cc.Color{\r\n        let color=cc.color();\r\n        switch(quality){\r\n            case 1:{\r\n                color=cc.color(113, 229, 132);\r\n            }break;\r\n            case 2:\r\n            case 3:\r\n            {\r\n                color=cc.color(105, 183, 255);\r\n            }break;\r\n            case 4:\r\n            case 5:\r\n            {\r\n                color=cc.color(226, 126, 255);\r\n            }break;\r\n            case 6:\r\n            case 7:\r\n            {\r\n                color=cc.color(255, 193, 74);\r\n            }break;\r\n            case 8:\r\n            case 9:\r\n            {\r\n                color=cc.color(255, 74, 74);\r\n            }break;\r\n            default:{\r\n                color=cc.color(255, 255, 255);\r\n            }break;\r\n        }\r\n        return color;\r\n    }\r\n\r\n    /**检测是否有红点提示 */\r\n    checkRedTip(heroType:Hero_Type):boolean{\r\n        let petId=HeroManager.getInstance().getHeroInfo(heroType).pet_id;\r\n        let petList=PropManager.getInstance().getPetList();\r\n        if(petId==0){\r\n            //检测是否有空余的宠物\r\n            for(let i=0; i<petList.length; i++){\r\n                let info=petList[i];\r\n                let heroList=HeroManager.getInstance().getWearPetHeroList(info);\r\n                let remainNum=info.pet_num-heroList.length;\r\n                if(remainNum>0){\r\n                    return true;\r\n                }                \r\n            }\r\n        }else{\r\n            let petInfo = SpiritAttributeManager.getInstance().getJsonSpiritAttribute(petId);\r\n            let petMessage = SpiritMessageManager.getInstance().getJsonSpiritMessage(petInfo.SpiritType);\r\n            if(petInfo.Stage >= petMessage.StageLimit){\r\n                return false;\r\n            }\r\n            //是否可以升星\r\n            let costInfo = SpiritCultivateManager.getInstance().getJsonSpiritCultivate(petInfo.Stage);\r\n            if(costInfo.CoinSpirit == 0){\r\n                return (PropManager.getInstance().getPropNum(PropId.AnimalFood) >= costInfo.FoodCost && \r\n                PropManager.getInstance().getPropNum(PropId.Coin) >= costInfo.CoinCost)                                        \r\n            }else{\r\n                let firstStageInfo = SpiritAttributeManager.getInstance().getTypeFirstJsonData(petInfo.SpiritType);               \r\n                return (PropManager.getInstance().getPropNum(firstStageInfo.SpiritItem) >= costInfo.CoinSpirit &&\r\n                PropManager.getInstance().getPropNum(PropId.Gem) >= costInfo.DiamondCost)\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n}\r\n"]}