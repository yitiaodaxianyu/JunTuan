{"version":3,"sources":["assets\\Scripts\\Payment\\PayAccumulateChargeUi.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import GameManager from \"../GameManager\";\r\nimport TextLanguage from \"../multiLanguage/TextLanguage\";\r\nimport { PropAction } from \"../Prop/PropConfig\";\r\nimport { PropManager } from \"../Prop/PropManager\";\r\nimport { SoundIndex } from \"../Sound/AudioConstants\";\r\nimport { PayUiIndex } from \"../thirdParty/ThirdParty\";\r\nimport { EventManager, RedEventString, RedEventType } from \"../Tools/EventManager\";\r\nimport { CumulativeRechargeManager, JsonCumulativeRecharge } from \"./Data/CumulativeRecharge\";\r\nimport PayAccumulateChargeItem from \"./PayAccumulateChargeItem\";\r\nimport { PayManager } from \"./PayManager\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class PayAccumulateChargeUi extends cc.Component {\r\n\r\n    @property(cc.Prefab)\r\n    item:cc.Prefab = null;\r\n    @property(cc.SpriteAtlas)\r\n    common_ui:cc.SpriteAtlas = null;\r\n\r\n    protected onEnable(): void {\r\n        this.refreshUi();\r\n    }\r\n\r\n    protected start(): void {\r\n        PayManager.getInstance().addTodayShow(PayUiIndex.Total);\r\n        //EventManager.postRedEvent(RedEventString.RED_CHECK,RedEventType.Btn_Main_Shop_Total);\r\n        this.adaptation();\r\n    }\r\n\r\n    private adaptation()\r\n    {        \r\n        let bottomNode=this.node.parent.getChildByName('bottom');\r\n        let bottomHeight=bottomNode.height;\r\n        let bottomY=bottomNode.y;        \r\n        let topNode=this.node.parent.getChildByName('top')\r\n        let topHeight=topNode.height;\r\n        let topY=topNode.y;\r\n        let height=((topY-topHeight)-(bottomY+bottomHeight));\r\n        let centerY=(topY-topHeight-height/2);\r\n        let scrollView=this.node.getChildByName('itemScroll');\r\n        scrollView.height=height - this.node.getChildByName(\"Recharge_Bg_1\").height;\r\n        scrollView.y=centerY - 120;\r\n        let tempPos = this.node.getChildByName(\"Recharge_Bg_1\").y - this.node.getChildByName(\"tipLab\").y;\r\n        scrollView.getChildByName('view').height=height - this.node.getChildByName(\"Recharge_Bg_1\").height;\r\n        this.node.getChildByName(\"Recharge_Bg_1\").y = topNode.y - (topNode.height + this.node.getChildByName(\"Recharge_Bg_1\").height/2);\r\n        this.node.getChildByName(\"tipLab\").y = this.node.getChildByName(\"Recharge_Bg_1\").y - tempPos;\r\n    }\r\n\r\n    refreshUi(){\r\n        let data:Map<number,JsonCumulativeRecharge> = CumulativeRechargeManager.getInstance().getData();\r\n        let content = this.node.getChildByName(\"itemScroll\").getComponent(cc.ScrollView).content;\r\n        content.removeAllChildren();\r\n        data.forEach((v,k) => {\r\n            let state = PayManager.getInstance().getTotalLongJingGetState(v.CumulativeRechargeID);\r\n            // if(state == 0){\r\n            //     if(PayManager.getInstance().getTotalLongJingNum() > v.CumulativeRechargePrice){\r\n            //         PayManager.getInstance().setTotalLongJingGetState(v.CumulativeRechargeID,1);\r\n            //     }\r\n            // }\r\n            let item = cc.instantiate(this.item);\r\n            item.getComponent(PayAccumulateChargeItem).initData(v);\r\n            if(state == 2){\r\n                let Itemcontent = item.getChildByName(\"rewardScroll\").getComponent(cc.ScrollView).content;\r\n                Itemcontent.children.forEach((v,k) =>{\r\n                    let gou = new cc.Node();\r\n                    gou.addComponent(cc.Sprite).spriteFrame = this.common_ui.getSpriteFrame(\"Common_Checkmark\")\r\n                    let mask = new cc.Node();\r\n                    mask.addComponent(cc.Sprite).spriteFrame = this.common_ui.getSpriteFrame(\"Item_frame_ZheZhao\")\r\n                    mask.opacity = 150;\r\n                    mask.setParent(v);\r\n                    gou.setParent(v);\r\n                });\r\n            }\r\n            content.addChild(item);\r\n            item.setSiblingIndex(0);\r\n        });\r\n        let maxData = CumulativeRechargeManager.getInstance().getJsonCumulativeRecharge(CumulativeRechargeManager.getMaxCumulativeRechargeID());\r\n        this.node.getChildByName(\"Recharge_Bg_1\").removeAllChildren();\r\n        this.node.getChildByName(\"tipLab\").getComponent(TextLanguage).setReplaceValue('~',maxData.CumulativeRechargePrice + '');\r\n        // let reward = PropManager.getInstance().createPropItem(70021,1);\r\n        // reward.setParent(this.node.getChildByName(\"Recharge_Bg_1\"));\r\n        // reward.y = 30;\r\n        if(PayManager.getInstance().getTotalLongJingNum() >= maxData.CumulativeRechargePrice){\r\n            if(cc.sys.localStorage.getItem(\"pay_accumulate_charge_final\") == null){\r\n                let reward = PropManager.getInstance().createPropItem(70021,1,PropAction.Null);\r\n                reward.setParent(this.node.getChildByName(\"Recharge_Bg_1\"));\r\n                reward.y = 30;\r\n                let btn=reward.getComponent(cc.Button);\r\n                btn.interactable=true;\r\n                let clickEvent=new cc.Component.EventHandler();\r\n                clickEvent.target=this.node;\r\n                clickEvent.component='PayAccumulateChargeUi';\r\n                clickEvent.handler='onClickReward';\r\n                // clickEvent.customEventData=enemyType+'';\r\n                btn.clickEvents.push(clickEvent);\r\n            }else{\r\n                let reward = PropManager.getInstance().createPropItem(70021,1,PropAction.Null);\r\n                reward.setParent(this.node.getChildByName(\"Recharge_Bg_1\"));\r\n                let gou = new cc.Node();\r\n                gou.addComponent(cc.Sprite).spriteFrame = this.common_ui.getSpriteFrame(\"Common_Checkmark\")\r\n                let mask = new cc.Node();\r\n                mask.addComponent(cc.Sprite).spriteFrame = this.common_ui.getSpriteFrame(\"Item_frame_ZheZhao\")\r\n                mask.setParent(reward);\r\n                mask.opacity = 150;\r\n                gou.setParent(reward);\r\n                reward.y = 30;\r\n            }\r\n        }else{\r\n            let reward = PropManager.getInstance().createPropItem(70021,1);\r\n            reward.setParent(this.node.getChildByName(\"Recharge_Bg_1\"));\r\n            reward.y = 30;\r\n        }\r\n    }\r\n\r\n    onClickReward(){\r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.click);\r\n        let reward = PropManager.getInstance().createPropItem(70021,1);\r\n        PropManager.getInstance().changePropNum(70021,1);\r\n        cc.sys.localStorage.setItem(\"pay_accumulate_charge_final\",1);\r\n        GameManager.getInstance().showGetTip(reward,(() => {\r\n            this.refreshUi();\r\n        }).bind(this));\r\n    }\r\n\r\n}\r\n"]}