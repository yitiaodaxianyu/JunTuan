{"version":3,"sources":["assets\\Scripts\\UI\\FuHuo.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import WXManagerEX from \"../../startscene/WXManagerEX\";\r\nimport AdManager from \"../Ads/AdManager\";\r\nimport { VipManager } from \"../Ads/VipManager\";\r\nimport { VIDEO_TYPE } from \"../Constants\";\r\nimport GameManager from \"../GameManager\";\r\nimport { LanguageIndex } from \"../multiLanguage/LanguageConstants\";\r\nimport LanguageManager from \"../multiLanguage/LanguageManager\";\r\nimport { SoundIndex } from \"../Sound/AudioConstants\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class FuHuo extends cc.Component {\r\n\r\n    remain_time:number=20;\r\n\r\n    onLoad()\r\n    {\r\n        this.remain_time=21;\r\n        this.showRemain();\r\n        this.schedule(this.showRemain,2);\r\n        if(VipManager.getIsVip()==true){\r\n            this.node.getChildByName('ads').active=false;\r\n        }\r\n    }\r\n\r\n    showRemain()\r\n    {\r\n        this.remain_time--;\r\n        let remainLabel=this.node.getChildByName('btnFuHuo').getChildByName('remainLabel');\r\n        remainLabel.getComponent(cc.Label).string=this.remain_time+'s';\r\n        if(this.remain_time<=0)\r\n        {            \r\n            this.showGameLose();\r\n        }\r\n    }\r\n\r\n    showGameLose()\r\n    {\r\n        GameManager.getInstance().showGameLose();\r\n        this.destroySelf();\r\n    }\r\n\r\n   clickBtnFangQi()\r\n   {\r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.click);\r\n        this.showGameLose();\r\n   }\r\n\r\n   clickBtnFuhuo()\r\n   {\r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.click);\r\n        if (cc.sys.platform === cc.sys.WECHAT_GAME) {\r\n            if(VipManager.getIsVip()==true)\r\n            {\r\n                GameManager.getInstance().onFuhuo();\r\n                this.destroySelf();\r\n                return;\r\n            }\r\n            this.unschedule(this.showRemain);\r\n            \r\n            WXManagerEX.getInstance().fuhuoShipin = wx.createRewardedVideoAd({\r\n                adUnitId: 'adunit-81a1f1f3d7c367bb'\r\n            });\r\n            WXManagerEX.getInstance().fuhuoShipin.offError();\r\n            WXManagerEX.getInstance().fuhuoShipin.onError(err => {\r\n                console.log(err)\r\n                this.schedule(this.showRemain,1);\r\n            });\r\n            WXManagerEX.getInstance().fuhuoShipin.offClose();\r\n            WXManagerEX.getInstance().fuhuoShipin.show().catch(() => {\r\n                // 失败重试\r\n                WXManagerEX.getInstance().fuhuoShipin.load()\r\n                    .then(() => WXManagerEX.getInstance().fuhuoShipin.show())\r\n                    .catch(err => {\r\n                        GameManager.getInstance().showMessage(\"广告拉取失败\");\r\n                        this.schedule(this.showRemain,1);\r\n                    })\r\n            })\r\n            WXManagerEX.getInstance().fuhuoShipin.onClose(res => {\r\n                // 用户点击了【关闭广告】按钮\r\n                // 小于 2.1.0 的基础库版本，res 是一个 undefined\r\n                if (res && res.isEnded || res === undefined) {\r\n                    // 正常播放结束，可以下发游戏奖励\r\n                    this.onShipinComp();\r\n                }\r\n                else {\r\n                    // 播放中途退出，不下发游戏奖励\r\n                    this.schedule(this.showRemain,1);\r\n                }\r\n            })\r\n        }else{\r\n            this.onShipinComp();\r\n        }\r\n       \r\n        \r\n   }\r\n    //视频观看完成\r\n    private onShipinComp(): void {\r\n        \r\n        GameManager.getInstance().onFuhuo();\r\n        this.destroySelf();\r\n    }\r\n   destroySelf()\r\n   {\r\n       cc.director.resume();\r\n       this.node.removeFromParent();\r\n   }\r\n}\r\n"]}