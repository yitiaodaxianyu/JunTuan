{"version":3,"sources":["assets\\Scripts\\Pet\\Game\\RayPet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\r\n\r\nimport { GameState } from \"../../Constants\";\r\nimport { GameEffectId, GameEffectsManager } from \"../../Game/GameEffectsManager\";\r\nimport GameManager from \"../../GameManager\";\r\nimport { BuffData } from \"../../Hero/Game/BuffData\";\r\nimport { DamageType, SkillType, BuffId, BuffType } from \"../../Hero/Game/HeroConfig\";\r\nimport ChainLightning from \"../../Hero/Game/LeiShen/ChainLightning\";\r\nimport Monster from \"../../Monster/Monster\";\r\nimport MonsterManager from \"../../Monster/MonsterManager\";\r\nimport { PetSkillType } from \"../PetConfig\";\r\nimport Pet from \"./Pet\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class RayPet extends Pet {\r\n\r\n    /**被闪电过的怪的uuid */\r\n    shandian_monster:string[]=[];\r\n\r\n    onLoad(): void {\r\n        super.onLoad();\r\n        this.addAttackListen(this.onAttack);\r\n        this.addInitedListen(this.onPetInited);        \r\n    }\r\n\r\n    onPetInited(){\r\n        this.cd_time=0;\r\n    }\r\n\r\n    /**普攻对敌人释放一道闪电，可以连续弹射N次*/\r\n    onAttack(monster:cc.Node){\r\n        if(Math.random()<this.pet_data.getSkillValue1(PetSkillType.Active)){\r\n            this.shandian_monster=new Array();\r\n            this.createShanDian(null,monster.getComponent(Monster));\r\n            this.cd_time=0;\r\n        }        \r\n    }\r\n    \r\n    createShanDian(firstMonster:Monster,endMonster:Monster){        \r\n        this.shandian_monster.push(endMonster.uuid);\r\n        let shandian=GameEffectsManager.getInstance().createGameEffectById(GameEffectId.pet4_skill,this.node.getPosition());\r\n        shandian.getComponent(ChainLightning).init(GameEffectId.pet4_skill,firstMonster,endMonster,this.onEndMonster.bind(this));\r\n        let gjData=this.getGongJiData(false,this.pet_data.getSkillValue3(PetSkillType.Active))\r\n        let data=endMonster.beFlashInjured(gjData);\r\n    }\r\n\r\n    onEndMonster(endMonster:Monster){\r\n        let tansheNum=this.pet_data.getSkillValue2(PetSkillType.Active);\r\n        if(this.shandian_monster.length<tansheNum){\r\n            let nextMonster=this.getMonster(endMonster.getCenterPos());\r\n            if(nextMonster){\r\n                this.createShanDian(endMonster,nextMonster);\r\n            }\r\n        }\r\n    }\r\n\r\n    getIsTanShe(uuid:string):boolean{\r\n        return this.shandian_monster.indexOf(uuid)>=0;\r\n    }\r\n\r\n    getMonster(pos:cc.Vec2):Monster\r\n    {\r\n        let em=MonsterManager.getInstance();        \r\n        if(em.node.childrenCount<=0)\r\n        {\r\n            return null;\r\n        }\r\n        //1.先检测在攻击范围内符合攻击单位的敌人\r\n        let attMonsters:Monster[]=new Array();\r\n        for(let enemy of em.node.children)\r\n        {\r\n            let enemyTS=enemy.getComponent(Monster);\r\n            if(enemyTS && enemyTS.getIsCanCheck()==true)\r\n            {\r\n                let distance=pos.sub(enemyTS.getCenterPos()).mag();\r\n                if(this.getIsTanShe(enemyTS.uuid)==false && distance<=500)\r\n                {\r\n                    attMonsters.push(enemyTS);\r\n                }\r\n            }\r\n        }\r\n        if(attMonsters.length<=0)\r\n        {\r\n            return null;\r\n        }\r\n        if(1==attMonsters.length)\r\n        {\r\n            return attMonsters[0];\r\n        }\r\n        //2.1优先攻击跟目标位置最近的单位\r\n        attMonsters.sort((a:Monster,b:Monster)=>{\r\n            return a.getCenterPos().sub(pos).mag()-b.getCenterPos().sub(pos).mag();\r\n        });\r\n        return attMonsters[0];\r\n    }\r\n\r\n    // update(dt:number){\r\n    //     if(GameManager.getInstance().cur_game_state!=GameState.Game_Playing)\r\n    //     {\r\n    //         return;\r\n    //     }\r\n    //     this.checkSkill(dt);\r\n    // }\r\n\r\n    // checkSkill(dt:number){\r\n    //     this.cd_time-=dt;\r\n    //     if(this.cd_time<0){\r\n    //         this.cd_time=0;\r\n    //     }\r\n    // }\r\n}\r\n"]}