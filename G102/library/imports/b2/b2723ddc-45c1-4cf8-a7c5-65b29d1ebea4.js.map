{"version":3,"sources":["assets\\Scripts\\Hero\\Game\\ShouWang\\Bear.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameState } from \"../../../Constants\";\r\nimport GameManager from \"../../../GameManager\";\r\nimport Monster from \"../../../Monster/Monster\";\r\nimport { KeyFrameData } from \"../../../Monster/MonsterData\";\r\nimport MonsterManager from \"../../../Monster/MonsterManager\";\r\nimport { SoundIndex } from \"../../../Sound/AudioConstants\";\r\nimport { GongJiData } from \"../../Data/HeroData\";\r\nimport GongJi from \"../GongJi\";\r\nimport { BearAnimaName, BearAttackDistance, BearAttackSpeed, BearMoveSpeed, BearState } from \"./BearConfig\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Bear extends GongJi {\r\n    @property(sp.Skeleton)\r\n    private spine: sp.Skeleton=null;\r\n    /**熊的状态 */\r\n    private cur_state:BearState=BearState.born;\r\n    /**当前的移动速度 */\r\n    private cur_move_speed: number=80;\r\n    /**当前的移动目标地点，可能会由玩家点击屏幕而设置 */\r\n    private move_target_pos: cc.Vec2=null;\r\n    /**当前的攻击目标 */\r\n    private att_target: cc.Node=null;\r\n    /**当前的移动方向 */\r\n    private move_direction:number=Math.PI*3/2;\r\n    /** 攻击计数*/\r\n    private gongji_jishu:number=0;\r\n    /** 攻击间隔*/\r\n    private gongji_jiange:number=1;\r\n    /** 基础间隔 */\r\n    private base_jiange:number=0;\r\n    /**攻击距离 */\r\n    private gongji_juli:number=100;\r\n    /**攻击坐标 */\r\n    private gongji_pos:cc.Vec2=cc.v2(0,0);\r\n    /**寻敌范围 */\r\n    private find_monster_fanwei:number=1000;\r\n    /**指定缩放 */\r\n    private setup_scale:number=1;\r\n    /**当前的左右面向 */\r\n    private cur_is_left:boolean=false;\r\n    /**城墙的Y */\r\n    wall_yy:number=0;\r\n    /**熊剩余的时间 */\r\n    remain_num:number=1;   \r\n\r\n    destory_callback:Function=null;\r\n    bear_id:number=0;\r\n    aoe_fanwei:number=0;\r\n\r\n    onLoad(){\r\n        let gongjiNode=this.node.getChildByName('gongji');\r\n        this.gongji_pos=gongjiNode.getPosition();\r\n\r\n        gongjiNode.removeFromParent();\r\n    }\r\n\r\n    init(gjData:GongJiData,dt:number,bearId:number,aoe:number=0){\r\n        if(!this.spine){\r\n            this.spine=this.node.getComponent(sp.Skeleton);\r\n        }\r\n        this.initData(gjData);\r\n        this.bear_id=bearId;\r\n        this.gongji_jiange=this.base_jiange=1/BearAttackSpeed;\r\n        this.cur_move_speed=BearMoveSpeed;\r\n        this.gongji_juli=BearAttackDistance;\r\n        this.find_monster_fanwei=gjData.hero_data.gongji_fanwei;\r\n        this.aoe_fanwei=aoe;\r\n        this.setBearState(BearState.born,false,false,null,this.checkIdle.bind(this));\r\n        this.wall_yy=GameManager.getInstance().enemy_att_y;\r\n        this.node.scale=this.setup_scale;\r\n        this.remain_num=dt;\r\n        this.node.zIndex=(Math.round(8000-this.node.y*10));\r\n        \r\n        //this.gongji_jiange/=1.5;\r\n    }\r\n\r\n    addDestoryListen(callBack:Function){\r\n        this.destory_callback=callBack;\r\n    }\r\n\r\n    setBearState(state:BearState,isLeft:boolean=true,isLoop:boolean=false,data?:KeyFrameData[],endCallback?:Function){\r\n        this.cur_state=state;\r\n        this.cur_is_left=isLeft;\r\n        this.node.scaleX=this.cur_is_left?-this.setup_scale:this.setup_scale;        \r\n        this.playSpineAnimation(this.getAnimaName(),isLoop,data,endCallback);\r\n    }\r\n\r\n    getGongJiPos():cc.Vec2{\r\n        return cc.v2(this.node.x+this.gongji_pos.x*this.node.scaleX,this.node.y+this.gongji_pos.y*this.node.scaleY);\r\n    }\r\n\r\n    getAnimaName():string{\r\n        let name=BearAnimaName.Idle;\r\n        switch(this.cur_state){\r\n            case BearState.born:{\r\n                name=BearAnimaName.Start;\r\n            }break;\r\n            case BearState.idle:{\r\n                name=BearAnimaName.Idle;\r\n            }break;\r\n            case BearState.move:{\r\n                if(this.att_target){\r\n                    //判断距离\r\n                    let distance=(this.att_target.getPosition().sub(this.getGongJiPos()).mag());\r\n                    if(distance>=this.cur_move_speed){\r\n                        name=BearAnimaName.Run;\r\n                    }else{\r\n                        name=BearAnimaName.Walk;\r\n                    }\r\n                }else{\r\n                    name=BearAnimaName.Walk;\r\n                }\r\n                \r\n            }break;\r\n            case BearState.attack:{\r\n                name=BearAnimaName.Attack;\r\n            }break;\r\n        }\r\n        return name;\r\n    }\r\n\r\n    /**\r\n     * 播放一个骨骼动画\r\n     * @param name 骨骼动画名称\r\n     * @param isLoop 是否循环\r\n     * @param data 是否监听关键帧，关键帧数据包含关键帧名称，监听到关键帧后的回调\r\n     * @param endCallback 播放结束后的回调\r\n     */\r\n     playSpineAnimation(name:string,isLoop:boolean=false,data?:KeyFrameData[],endCallback?:Function){     \r\n        if(isLoop&&name==this.spine.animation){\r\n            return;\r\n        }\r\n        let anima=this.spine.setAnimation(0,name,isLoop);\r\n        // if(data){\r\n        //     this.spine.setTrackEventListener(anima,(entry: sp.spine.TrackEntry, event) =>{\r\n        //         for(let i=0; i<data.length; i++){\r\n        //             if(event.data.name==data[i].name){\r\n        //                 data[i].callback();\r\n        //             }\r\n        //         }\r\n        //     })\r\n        // }\r\n        // if(endCallback){\r\n        //     this.spine.setTrackCompleteListener(anima,(entry: sp.spine.TrackEntry, event) =>{\r\n        //         anima.listener=null;                \r\n        //         endCallback();\r\n        //     })\r\n        // }\r\n\r\n        if(endCallback){\r\n          \r\n\r\n            this.spine.setCompleteListener((trackEntry, loopCount) => {\r\n                let nameTemp = trackEntry.animation ? trackEntry.animation.name : '';\r\n                if (nameTemp === name && endCallback) {\r\n                   \r\n                    if(data&&data[0].callback){\r\n                        data[0].callback();\r\n                    }\r\n                    endCallback();\r\n                }\r\n                this.spine.setCompleteListener(null);\r\n            });\r\n        }\r\n    }\r\n\r\n    startAttack(){\r\n        this.gongji_jishu=0;\r\n        //算出熊的面向\r\n        let isLeft=this.att_target.x<this.node.x;\r\n        let data=new KeyFrameData();\r\n        data.name=\"Attack\";\r\n        data.callback=()=>{\r\n            this.gongji_jishu=0;\r\n            //造成伤害\r\n            if(this.att_target){\r\n                GameManager.getInstance().sound_manager.playSound(SoundIndex.YX_ShouWangSkill2);\r\n                let monsterTs=this.att_target.getComponent(Monster);\r\n                if(monsterTs){\r\n                    let damageData=monsterTs.beFlashInjured(this.gongji_data);\r\n                    if(damageData.getDamageNum()>0){\r\n                        //专武范围伤害\r\n                        if(this.aoe_fanwei>0){\r\n                            let monsters=MonsterManager.getInstance().getMonstersForCenterPos(-1,monsterTs.getCenterPos(),this.aoe_fanwei);\r\n                            //如果范围内有怪物\r\n                            if(monsters){\r\n                                for(let i=0; i<monsters.length; i++){\r\n                                    let monsterTTS=monsters[i].getComponent(Monster);\r\n                                    if(monsterTTS.uuid!=this.uuid){\r\n                                        monsterTTS.beFlashInjured(this.gongji_data);\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.setBearState(BearState.attack,isLeft,false,[data],()=>{            \r\n            this.checkIdle();\r\n        })\r\n    }\r\n\r\n    startMove(dt:number){\r\n        let disX=this.node.x;\r\n        let disY=this.node.y;\r\n        let speed=this.cur_move_speed*dt;\r\n        disX+=speed*Math.cos(this.move_direction);\r\n        disY+=speed*Math.sin(this.move_direction);\r\n        this.node.x=disX;\r\n        this.node.y=disY;\r\n        if(this.node.x>360)\r\n        {\r\n            this.node.x=360;\r\n            this.move_direction=(Math.PI-this.move_direction);\r\n        }\r\n        if(this.node.x<-360)\r\n        {\r\n            this.node.x=-360;\r\n            this.move_direction=(Math.PI-this.move_direction);\r\n        }\r\n        //不能穿过城墙\r\n        if(this.node.y<this.wall_yy){\r\n            this.node.y=this.wall_yy;\r\n        }\r\n        let isLeft=this.move_direction>Math.PI/2&&this.move_direction<Math.PI*3/2;\r\n        this.setBearState(BearState.move,isLeft,true);\r\n        this.node.zIndex=(Math.round(8000-this.node.y*10));\r\n    }\r\n\r\n    startDestory(){\r\n        this.setBearState(BearState.destory);\r\n        cc.tween(this.node).delay(0.5).to(1,{opacity:0}).removeSelf().start();\r\n        if(this.destory_callback){\r\n            this.destory_callback();\r\n        }\r\n    }\r\n\r\n    update(dt:number)\r\n    {\r\n        if(GameManager.getInstance().cur_game_state!=GameState.Game_Playing)\r\n            return;\r\n        if(this.cur_state==BearState.born||this.cur_state==BearState.destory){\r\n            return;\r\n        }\r\n        this.remain_num-=dt;\r\n        if(this.remain_num>0){\r\n            this.checkAttack(dt);  \r\n        }else{\r\n            this.startDestory();\r\n        }\r\n    }\r\n\r\n    private checkAttack(dt:number)\r\n    {\r\n        this.gongji_jishu+=dt;\r\n        if(this.cur_state!=BearState.attack){\r\n            let monsters=MonsterManager.getInstance().getMonstersForCenterPos(1,this.getGongJiPos(),this.find_monster_fanwei);\r\n            //如果范围内有怪物\r\n            if(monsters){\r\n                this.att_target=monsters[0];\r\n                //判断距离\r\n                let distance=(this.att_target.getPosition().sub(this.getGongJiPos()).mag());\r\n                if(distance<this.gongji_juli){\r\n                    if(this.gongji_jishu>=this.gongji_jiange)\r\n                    {\r\n                        this.spine.timeScale=this.base_jiange/this.gongji_jiange;\r\n                        this.startAttack();\r\n                    }else{\r\n                        this.checkIdle();\r\n                    }\r\n                }else{\r\n                    this.checkMove(dt);\r\n                }            \r\n            }else{\r\n                this.att_target=null;\r\n                this.checkIdle();\r\n            }\r\n        }                \r\n    }\r\n\r\n    private checkIdle(){\r\n        if(this.cur_state==BearState.idle){\r\n            return;\r\n        }\r\n        this.setBearState(BearState.idle,this.cur_is_left,true);\r\n    }\r\n\r\n    private checkMove(dt:number){\r\n        let speed=this.cur_move_speed*dt;\r\n        /**如果有命令，则执行命令 */\r\n        if(this.move_target_pos){\r\n            let offsetPos=this.move_target_pos.sub(this.getGongJiPos());\r\n            if(offsetPos.mag()<speed)\r\n            {\r\n                this.move_target_pos=null;\r\n                this.checkIdle();\r\n            }else\r\n            {\r\n                let pi2=Math.PI*2;\r\n                this.move_direction=(Math.atan2(offsetPos.y,offsetPos.x)+pi2)%pi2;\r\n                this.startMove(dt);\r\n            }\r\n        }else{\r\n            let pi2=Math.PI*2;\r\n            let offsetPos=this.att_target.getPosition().sub(this.getGongJiPos());\r\n            this.move_direction=(Math.atan2(offsetPos.y,offsetPos.x)+pi2)%pi2;\r\n            this.startMove(dt);\r\n        }\r\n    }\r\n}\r\n"]}