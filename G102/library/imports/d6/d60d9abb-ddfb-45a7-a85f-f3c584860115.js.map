{"version":3,"sources":["assets\\Scripts\\Pet\\Game\\Pet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameState } from \"../../Constants\";\r\nimport { GameEffectId, GameEffectsManager } from \"../../Game/GameEffectsManager\";\r\nimport GroundManager from \"../../Game/GroundManager\";\r\nimport GameManager from \"../../GameManager\";\r\nimport { GongJiData, HeroData } from \"../../Hero/Data/HeroData\";\r\nimport { Hero_Type, DamageType } from \"../../Hero/Game/HeroConfig\";\r\nimport { KeyFrameData, MonsterActionName, MonsterFaceName, MonsterSkinType } from \"../../Monster/MonsterData\";\r\nimport MonsterManager from \"../../Monster/MonsterManager\";\r\nimport { SoundIndex } from \"../../Sound/AudioConstants\";\r\nimport { PetData } from \"../Data/PetData\";\r\nimport { SpiritAttributeManager } from \"../Data/SpiritAttribute\";\r\nimport { SpiritSkillManager } from \"../Data/SpiritSkill\";\r\nimport { PetInfo, PetSkillType } from \"../PetConfig\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Pet extends cc.Component {\r\n    /**所有的英雄及其所需资源是否加载完毕 */\r\n    public static max_load_num:number=0;\r\n    public static cur_loaded_num:number=0;\r\n    /**所需的动画加载是否ok */\r\n    is_load_ok:boolean=false;\r\n    cur_load_num:number=0;\r\n    need_load_num:number=0;\r\n    protected spine: sp.Skeleton=null;\r\n    /**绑定的英雄 */\r\n    hero_type:Hero_Type=Hero_Type.NULL;\r\n    /**英雄数据 */\r\n    hero_data:HeroData=null;\r\n    /**自身的宠物类型 */\r\n    pet_type:number=0;\r\n    /**自身的宠物id */\r\n    pet_id:number=0;\r\n    /**宠物的品质 */\r\n    pet_quality:number=0;\r\n    /**技能数据 */\r\n    protected pet_data:PetData=null;\r\n    /**技能冷却时间 */\r\n    cd_time:number=0;\r\n\r\n    attack_callback:Function=null;\r\n    inited_callback:Function=null;\r\n\r\n    onLoad(){\r\n        this.spine=this.node.getComponent(sp.Skeleton);\r\n        this.spine.setAnimation(0,\"Idle\",true);\r\n    }\r\n\r\n    preLoadRes(){\r\n        switch(this.pet_type){\r\n            case 1:{\r\n                this.addLoadByGameEffectId(GameEffectId.pet1_attack);\r\n                this.addLoadByGameEffectId(GameEffectId.pet1_attack_hit);\r\n            }break;\r\n            case 2:{\r\n                this.addLoadByGameEffectId(GameEffectId.pet2_attack);\r\n                this.addLoadByGameEffectId(GameEffectId.pet2_attack_hit);\r\n                this.addLoadByGameEffectId(GameEffectId.pet2_skill);\r\n            }break;\r\n            case 3:{\r\n                this.addLoadByGameEffectId(GameEffectId.pet3_skill_back);\r\n                this.addLoadByGameEffectId(GameEffectId.pet3_skill_front);\r\n            }break;\r\n            case 4:{\r\n                this.addLoadByGameEffectId(GameEffectId.pet4_skill);\r\n            }break;\r\n        }\r\n    }\r\n\r\n    protected addAttackListen(callBack:Function){\r\n        this.attack_callback=callBack;\r\n    }\r\n    \r\n    protected addInitedListen(callBack:Function){\r\n        this.inited_callback=callBack;\r\n    }\r\n\r\n    addLoadByGameEffectId(id:GameEffectId,initCount:number=1){              \r\n        if(GameEffectsManager.getInstance().addEffectPoolById(id,initCount,()=>{\r\n            this.cur_load_num++;\r\n            if(this.cur_load_num>=this.need_load_num){\r\n                this.is_load_ok=true;\r\n                Pet.cur_loaded_num++;\r\n            }\r\n        })==true){\r\n            this.need_load_num++;            \r\n        }\r\n    }\r\n\r\n    init(petId:number,heroType:Hero_Type,pos:cc.Vec2){\r\n        this.pet_id=petId;\r\n        this.pet_type=SpiritAttributeManager.getInstance().getSpiritType(this.pet_id);\r\n        this.pet_quality=SpiritAttributeManager.getInstance().getQuality(this.pet_id);\r\n        this.hero_type=heroType;\r\n        this.node.setPosition(pos);\r\n        this.preLoadRes();\r\n        this.initData();\r\n        if(this.inited_callback){\r\n            this.inited_callback();\r\n        }\r\n    }\r\n\r\n    setHeroData(heroData:HeroData){\r\n        this.hero_data=heroData;\r\n    }\r\n    \r\n    /**初始化数据 */\r\n    private initData(){\r\n        this.pet_data=new PetData();\r\n        this.pet_data.SkillValue_x=new Map<number,number>();\r\n        this.pet_data.SkillValue_y=new Map<number,number>();\r\n        this.pet_data.SkillValue_z=new Map<number,number>();\r\n        this.pet_data.ColdDown=new Map<number,number>();\r\n        for(let s=1; s<=1; s++){\r\n            let skillId=SpiritSkillManager.getInstance().getSkillId(this.pet_type,this.pet_quality-2);\r\n            let jsonData=SpiritSkillManager.getInstance().getJsonSpiritSkill(skillId);\r\n            if(jsonData == null) continue;\r\n            this.pet_data.SkillValue_x.set(s,jsonData.SkillParameter_1);\r\n            this.pet_data.SkillValue_y.set(s,jsonData.SkillParameter_2);\r\n            this.pet_data.SkillValue_z.set(s,jsonData.SkillParameter_3);\r\n            this.pet_data.ColdDown.set(s,jsonData.CoolDown);\r\n        }\r\n        this.cd_time=this.pet_data.getSkillColdDown(PetSkillType.Active);\r\n    }\r\n\r\n    getGongJiData(isBullet:boolean,skillRate:number):GongJiData{\r\n        let gjData=new GongJiData();\r\n        gjData.hero_type=this.hero_type;\r\n        gjData.hero_data=cc.instantiate(this.hero_data);\r\n        gjData.skill_damage_rate=skillRate;\r\n        gjData.damage_type=DamageType.Skill;\r\n        gjData.is_bullet=isBullet;\r\n        return gjData;\r\n    }\r\n\r\n    /**\r\n     * 播放一个骨骼动画\r\n     * @param name 骨骼动画名称\r\n     * @param isLoop 是否循环\r\n     * @param data 是否监听关键帧，关键帧数据包含关键帧名称，监听到关键帧后的回调\r\n     * @param endCallback 播放结束后的回调\r\n     */\r\n     playSpinAnimaton(name:string,isLoop:boolean=false,data?:KeyFrameData,endCallback?:Function){        \r\n        let anima=this.spine.setAnimation(0,name,isLoop);\r\n        if(data){\r\n            this.spine.setTrackEventListener(anima,(entry: sp.spine.TrackEntry, event) =>{\r\n                if(event.data.name==data.name){\r\n                    data.callback();\r\n                }\r\n            })\r\n        }\r\n        if(endCallback){\r\n            this.spine.setTrackCompleteListener(anima,(entry: sp.spine.TrackEntry, event) =>{\r\n                anima.listener=null;\r\n                endCallback();\r\n            })\r\n        }\r\n    }\r\n\r\n    /**设置打击目标 */\r\n    setAttTarget(target:cc.Node){\r\n\r\n    }\r\n\r\n    onHeroHitMonster(monster:cc.Node){\r\n        \r\n    }\r\n\r\n    startReleaseSkill(monster:cc.Node){\r\n        if(this.cd_time<=0){\r\n            this.cd_time=this.pet_data.getSkillColdDown(PetSkillType.Active);\r\n            this.attack_callback(monster);\r\n        }\r\n    }\r\n\r\n    \r\n}\r\n"]}