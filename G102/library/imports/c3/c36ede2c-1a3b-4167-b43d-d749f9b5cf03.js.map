{"version":3,"sources":["assets\\Scripts\\Sound\\Sound.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import WXManagerEX from \"../../startscene/WXManagerEX\";\r\nimport GameManager from \"../GameManager\";\r\nimport { SoundIndex } from \"./AudioConstants\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Sound extends cc.Component {\r\n\r\n    private cur_play_audio:cc.AudioClip=null;\r\n    //private all_audio:cc.AudioClip[]=[];\r\n    private map_audio:Map<string,cc.AudioClip>=new Map();\r\n    public volume:number=0;\r\n    public mute:boolean=false;\r\n\r\n    onLoad () {\r\n        GameManager.getInstance().sound_manager=this;\r\n        this.loadVolume();\r\n        this.loadMute();\r\n        this.loadAllAudioAsset();\r\n    }\r\n    onDestroy()\r\n    {\r\n        GameManager.getInstance().sound_manager=null;\r\n    }\r\n    loadAllAudioAsset()\r\n    {\r\n        //根据游戏场景加载对应的音效资源        \r\n        WXManagerEX.getInstance().resourcesBundle.loadDir('sounds/'+GameManager.getInstance().cur_game_scene,cc.AudioClip,(error: Error, assets:cc.AudioClip[])=>{\r\n            if(error)\r\n            {\r\n                console.log(error);\r\n                return;\r\n            }\r\n            //this.all_audio=assets;\r\n            //将数组内容存在map\r\n            let len=assets.length;\r\n            for(let i=0; i<len; i++)\r\n            {\r\n                let audio=assets[i];\r\n                this.map_audio.set(audio.name,audio);\r\n            }\r\n        });\r\n    }\r\n\r\n    /*-----------------------------------声音的逻辑处理--------------------------------------------------*/\r\n\r\n    loadVolume()\r\n    {\r\n        let vol=cc.sys.localStorage.getItem('sound_volume');\r\n        if(vol===null||vol==='')\r\n        {\r\n            vol=1;\r\n        }\r\n        this.saveSoundVolume(parseFloat(vol));        \r\n    }\r\n\r\n    saveSoundVolume(vol?:number)\r\n    {\r\n        if(vol!=undefined)\r\n        {\r\n            this.volume=vol;\r\n        }        \r\n        cc.sys.localStorage.setItem('sound_volume',this.volume);\r\n    }\r\n\r\n    loadMute()\r\n    {\r\n        let mute=cc.sys.localStorage.getItem('sound_mute');\r\n        if(mute===null||mute==='')\r\n        {\r\n            mute=false;\r\n        }else\r\n        {\r\n            if(mute==='false')\r\n            {\r\n                mute=false;\r\n            }else if(mute==='true')\r\n            {\r\n                mute=true;\r\n            }\r\n        }\r\n        this.saveSoundMute(mute);\r\n    }\r\n\r\n    saveSoundMute(mute?:boolean)\r\n    {\r\n        if(mute!=undefined)\r\n        {\r\n            this.mute=mute;\r\n        }\r\n        cc.sys.localStorage.setItem('sound_mute',this.mute);\r\n    }\r\n\r\n    playSound(soundIndex:SoundIndex):number\r\n    {\r\n        let audioIndex=0;\r\n        if(this.mute==false && this.volume>0)\r\n        {\r\n            //查找音效\r\n            //let len=this.all_audio.length;\r\n            let playAudio=this.map_audio.get(soundIndex);\r\n            // for(let i=0; i<len; i++)\r\n            // {\r\n            //     let audio=this.all_audio[i];\r\n            //     if(soundIndex==audio.name)\r\n            //     {\r\n            //         playAudio=audio;\r\n            //         break;\r\n            //     }\r\n            // }\r\n            if(playAudio)\r\n            {\r\n                if(this.cur_play_audio!=playAudio)\r\n                {\r\n                    this.cur_play_audio=playAudio;\r\n                    audioIndex=cc.audioEngine.play(this.cur_play_audio,false,this.volume);\r\n                }\r\n            }else\r\n            {\r\n                WXManagerEX.getInstance().resourcesBundle.load('sounds/'+GameManager.getInstance().cur_game_scene+'/'+soundIndex,cc.AudioClip,(error: Error, assets:cc.AudioClip)=>{\r\n                    if(error)\r\n                    {\r\n                        console.log(error);\r\n                        return;\r\n                    }\r\n                    this.cur_play_audio=assets;\r\n                    audioIndex=cc.audioEngine.play(this.cur_play_audio,false,this.volume);\r\n                });\r\n            }\r\n        }\r\n        return audioIndex;\r\n    }\r\n\r\n    // playSoundByAudioClip(clip: cc.AudioClip, loop: boolean=false):number\r\n    // {\r\n    //     return cc.audioEngine.playEffect(clip,loop);\r\n    // }\r\n    \r\n    \r\n\r\n    lateUpdate()\r\n    {\r\n        //防止每一帧同时播放多个相同的音效\r\n        this.cur_play_audio=null;\r\n    }           \r\n}\r\n"]}