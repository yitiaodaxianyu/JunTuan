{"version":3,"sources":["assets\\Scripts\\Boss\\BossBullet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameState, JiaSu } from \"../Constants\";\r\nimport { GameEffectId, GameEffectsManager } from \"../Game/GameEffectsManager\";\r\nimport GameManager from \"../GameManager\";\r\nimport { MonsterAttData } from \"../Monster/MonsterData\";\r\nimport Wall from \"../Wall/Wall\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class BossBullet extends cc.Component {\r\n\r\n    @property({type:cc.Prefab})\r\n    prefab_tuowei:cc.Prefab=null;\r\n    @property()\r\n    acc_num:number=0;\r\n    @property(cc.SpriteFrame)\r\n    sp_fly:cc.SpriteFrame=null;\r\n    @property(cc.SpriteFrame)\r\n    sp_create:cc.SpriteFrame=null;\r\n    /**拖尾节点 */\r\n    tuowei_node:cc.Node=null;\r\n\r\n    game_effect_id:number=0;\r\n    move_speed:number=700;\r\n    move_direction:number=Math.PI/2;\r\n    offset_xx_angle:number=90;\r\n    is_att:boolean=true;\r\n    monster_att_data:MonsterAttData=null;\r\n    cur_acc_num:number=0;\r\n\r\n    collision_target_callback:Function=null;\r\n    is_can_move:boolean=true;\r\n    boss_yy:number=0;\r\n    /**碰撞器 */\r\n    collider:cc.Collider=null;\r\n\r\n    init(monsterAttData:MonsterAttData,gameEffectId:GameEffectId,speed:number,dir:number,bossY:number,angle:number=90)\r\n    {\r\n        this.monster_att_data=monsterAttData;\r\n        this.game_effect_id=gameEffectId;\r\n        this.move_speed=speed;\r\n        this.offset_xx_angle=angle;\r\n        this.is_att=false;\r\n        this.cur_acc_num=this.acc_num;\r\n        this.boss_yy=bossY;\r\n        this.setDirection(dir);\r\n        if(this.prefab_tuowei){\r\n            this.tuowei_node=cc.instantiate(this.prefab_tuowei);\r\n            this.tuowei_node.parent=this.node.parent;\r\n            this.node.zIndex=1;\r\n        }\r\n        if(this.sp_create){\r\n            this.node.getComponent(cc.Sprite).spriteFrame=this.sp_create;\r\n        }\r\n        this.collider=this.getComponent(cc.Collider);\r\n    }\r\n\r\n    startFly(){\r\n        this.is_can_move=true;\r\n        this.node.getComponent(cc.Sprite).spriteFrame=this.sp_fly;\r\n    }\r\n\r\n    update (dt) {\r\n        if(GameManager.getInstance().cur_game_state!=GameState.Game_Playing)\r\n        return;\r\n        if(!this.is_can_move){\r\n            if(this.tuowei_node){\r\n                this.tuowei_node.opacity=0;\r\n                this.tuowei_node.active=false;\r\n                let pos=this.node.getPosition();                \r\n                this.tuowei_node.setPosition(pos);\r\n            }\r\n            return;\r\n        }\r\n        let prevPos=this.node.getPosition();\r\n        if(this.acc_num>0){            \r\n            this.cur_acc_num+=this.acc_num*dt;            \r\n        }\r\n        this.move_speed+=this.cur_acc_num;\r\n        if(this.move_speed>=10000){\r\n            this.move_speed=10000;\r\n        }\r\n        let xx=this.move_speed*dt*Math.cos(this.move_direction);\r\n        let yy=this.move_speed*dt*Math.sin(this.move_direction);\r\n        this.node.x+=xx;\r\n        this.node.y+=yy;\r\n        this.collider.enabled=this.node.y<=this.boss_yy;\r\n        if(this.node.y>cc.winSize.height){\r\n            this.destroySelf();\r\n        }\r\n        if(Math.abs(this.node.x)>cc.winSize.width){\r\n            this.destroySelf();\r\n        }\r\n        if(this.tuowei_node){\r\n            this.tuowei_node.opacity=255;\r\n            this.tuowei_node.active=true;\r\n            let gr=GameManager.getInstance().getGameRate();\r\n            if(gr<1){\r\n                gr=1;\r\n            }\r\n            let pos=this.node.getPosition();\r\n            //添加在子弹前面            \r\n            let offsetPos=pos.sub(prevPos);\r\n            let distance=offsetPos.mag()*2/gr;\r\n            let dir=Math.atan2(offsetPos.y,offsetPos.x);\r\n            let xx=pos.x+Math.cos(dir)*distance;\r\n            let yy=pos.y+Math.sin(dir)*distance;\r\n            this.tuowei_node.setPosition(cc.v2(xx,yy));\r\n        }\r\n    }\r\n\r\n    destroySelf()\r\n    {\r\n        if(this.tuowei_node){\r\n            cc.tween(this.tuowei_node).delay(this.tuowei_node.getComponent(cc.MotionStreak).fadeTime/5).removeSelf().start();\r\n            this.tuowei_node=null;\r\n        }\r\n        GameEffectsManager.getInstance().destroyGameEffectById(this.game_effect_id,this.node);\r\n    }\r\n\r\n    setDirection(dir:number)\r\n    {\r\n        this.move_direction=dir;\r\n        this.node.angle=180*dir/Math.PI-this.offset_xx_angle;\r\n    }\r\n    /**添加城墙碰撞的监听,指玩家召唤的城墙 */\r\n    addCollisionWallListen(callback:Function){\r\n        this.collision_target_callback=callback;\r\n    }\r\n\r\n    ////--------------------------------------碰撞开始----------------------------------------------------\r\n    onCollisionEnter(other:cc.Collider,self:cc.Collider) {\r\n        let gm=GameManager.getInstance();        \r\n        if(gm.cur_game_state==GameState.Game_Lose || this.is_att==true)\r\n            return;\r\n        let group=other.node.group;\r\n        switch(group){\r\n            case 'wall':{\r\n                if(this.collision_target_callback){                    \r\n                    this.is_att=true;\r\n                    this.collision_target_callback(other.node.getComponent(Wall));\r\n                }\r\n            }break;\r\n            // case 'wall':{                \r\n            //     this.collisionToWall(other.node.name);\r\n            // }break;\r\n        }\r\n    }\r\n}\r\n"]}