{"version":3,"sources":["assets\\Scripts\\Game\\SkillManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameEffectId, GameEffectsManager } from \"./GameEffectsManager\";\r\nimport MapNodePool from \"./MapNodePool\";\r\nimport GameManager from \"../GameManager\";\r\nimport { UIManager } from \"../UI/UIManager\";\r\nimport { JiaSu, SkillSpeedRate } from \"../Constants\";\r\nimport { SoundIndex } from \"../Sound/AudioConstants\";\r\nimport DamageRecord from \"../Hero/Game/DamageRecord\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class SkillManager extends MapNodePool {\r\n\r\n    private static _instance: SkillManager = null;\r\n    /**是否处于释放技能的状态，用于自动战斗判断 */\r\n    private is_skill_state:boolean=false;\r\n    private damage_record:Map<number,DamageRecord>=null;\r\n    private record_root:cc.Node=null;\r\n    private skill_range:cc.Node=null;\r\n    private de_lu_yi_ex:number=0;\r\n    public static getInstance():SkillManager\r\n    {\r\n        return this._instance;\r\n    }\r\n\r\n    onLoad () {\r\n        SkillManager._instance=this;\r\n        this.damage_record=new Map<number,DamageRecord>();        \r\n        this.record_root=this.node.getChildByName('record_root');\r\n        this.skill_range=this.node.getChildByName('skill_range');\r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n        this.damage_record.clear();\r\n        SkillManager._instance=null;        \r\n    }\r\n\r\n    /**根据id创建一个特效*/\r\n    public createGameEffectById(id:GameEffectId,pos:cc.Vec2):cc.Node\r\n    {\r\n        let node=GameEffectsManager.getInstance().createGameEffectForParent(id,pos,this.node);        \r\n        return node;\r\n    }\r\n\r\n    releaseSkill(completeCallback:Function,heroNode:cc.Node){                 \r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.YX_Xuli);\r\n        this.setTimeStop(true);\r\n        let commonAnima=this.createGameEffectById(GameEffectId.hero_skill_common,heroNode.getPosition().add(cc.v2(0,100))).getComponent(cc.Animation);\r\n        commonAnima.node.zIndex=3;\r\n        let commonState=commonAnima.play();\r\n        commonState.speed=JiaSu;\r\n        commonAnima.on(cc.Animation.EventType.FINISHED,()=>{\r\n            commonAnima.off(cc.Animation.EventType.FINISHED);\r\n            GameEffectsManager.getInstance().destroyGameEffectById(GameEffectId.hero_skill_common,commonAnima.node);\r\n            completeCallback()\r\n        });\r\n        let uiTouch=UIManager.getInstance().node.getChildByName('ui_touch');\r\n        if(uiTouch){\r\n            let uiAnima=uiTouch.getComponent(cc.Animation).getAnimationState('ui_touch');\r\n            if(uiAnima){\r\n                uiAnima.speed=JiaSu;\r\n            }\r\n        }\r\n        heroNode.setParent(this.node);\r\n        heroNode.zIndex=2;\r\n    }\r\n\r\n    startBaiPing(){\r\n        let bai=this.node.getChildByName('bai');\r\n        bai.active=true;\r\n        bai.opacity=255;\r\n        cc.tween(bai).to(0.2*GameManager.getInstance().getGameRate(),{opacity:0}).start();\r\n    }\r\n    /**设置时停效果 */\r\n    setTimeStop(isShow:boolean){\r\n        this.node.getChildByName('bg').active=isShow;\r\n        if(isShow){\r\n            //1.添加蒙版,播放前奏动画,全部时停,放慢10000倍        \r\n            GameManager.getInstance().setFightingRate(1/JiaSu);\r\n            let bai=this.node.getChildByName('bai');\r\n            bai.opacity=0;\r\n            this.setIsSkillState(true);\r\n        }else{\r\n            GameManager.getInstance().setFightingRate(1);\r\n        }\r\n    }\r\n\r\n    setIsSkillState(isSkill:boolean){\r\n        this.is_skill_state=isSkill;\r\n    }\r\n\r\n    getIsSkillState():boolean{\r\n        return this.is_skill_state;\r\n    }\r\n\r\n    /**3.0版本,设置技能状态 */\r\n    releaseSkillResult(isCompelete:boolean){\r\n        this.node.getChildByName('bg').active=!isCompelete;\r\n        GameManager.getInstance().setFightingRate(isCompelete?1:1/SkillSpeedRate);\r\n    }\r\n\r\n    /**记录技能伤害 */\r\n    recordDamage(id:number,value:number){\r\n        if(this.damage_record.has(id)){\r\n            this.damage_record.get(id).refreshValue(value);\r\n        }else{\r\n            let recorder=GameEffectsManager.getInstance().createGameEffectForParent(GameEffectId.skill_damage_record,cc.v2(0,-320),this.record_root);\r\n            let damageRecord=recorder.getComponent(DamageRecord);\r\n            damageRecord.init(GameEffectId.skill_damage_record,id,value,(id:number)=>{\r\n                this.damage_record.delete(id);\r\n            });\r\n            this.damage_record.set(id,damageRecord);\r\n            cc.tween(recorder).to(0.2,{x:0}).start();\r\n        }\r\n    }\r\n\r\n    showSkillRange(posY:number,distance:number){\r\n        this.skill_range.stopAllActions();\r\n        this.skill_range.y=posY;\r\n        this.skill_range.height=distance;\r\n        this.skill_range.opacity=255;\r\n        this.setSkillRange(true);\r\n        //cc.tween(this.skill_range).to(0.2*GameManager.getInstance().getGameRate(),{opacity:255}).start();\r\n    }\r\n\r\n    setSkillRange(isCan:boolean){\r\n        this.skill_range.color=isCan?cc.Color.WHITE:cc.Color.RED;\r\n    }\r\n\r\n    hideSkillRange(){\r\n        this.skill_range.stopAllActions();\r\n        this.skill_range.opacity=0;\r\n        //cc.tween(this.skill_range).to(0.1*GameManager.getInstance().getGameRate(),{opacity:0}).start();\r\n    }\r\n\r\n    /**德鲁伊专武，伤害比率 */\r\n    setDeLuYiEx(num:number){\r\n        this.de_lu_yi_ex=num;\r\n    }\r\n\r\n    /**德鲁伊专武，伤害比率 */\r\n    getDeLuYiEx():number{\r\n        return this.de_lu_yi_ex;\r\n    }\r\n}\r\n"]}