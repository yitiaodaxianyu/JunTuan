{"version":3,"sources":["assets\\Scripts\\Hero\\Game\\RenZhe\\RenZhe.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AACA,gDAAsD;AACtD,iEAA4D;AAG5D,2DAAsD;AACtD,oDAA+C;AAC/C,oDAA+C;AAC/C,4DAA4D;AAC5D,kEAA6D;AAC7D,gEAA2D;AAC3D,yDAAoD;AAGpD,gCAA2B;AAC3B,4CAA6H;AAC7H,2CAAsC;AACtC,+BAA0B;AAC1B,6CAAwC;AACxC,qCAAgC;AAE1B,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAAoC,0BAAI;IAAxC;QAAA,qEAmKC;QAjKG,iBAAiB;QACjB,iBAAW,GAAW,EAAE,CAAC;QACzB,mBAAa,GAAQ,CAAC,CAAC;;IA+J3B,CAAC;IA9JD,+FAA+F;IAC3F,uBAAM,GAAN;QAEI,iBAAM,MAAM,WAAE,CAAC;QACf,kEAAkE;QAClE,kEAAkE;QAClE,0EAA0E;QAC1E,sEAAsE;QACtE,+EAA+E;QAC/E,+EAA+E;QAC/E,+EAA+E;QAC/E,iFAAiF;QACjF,gFAAgF;QAChF,wFAAwF;QACxF,sEAAsE;QACtE,iFAAiF;QACjF,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACnC,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACxC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QAC5C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QACrC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;IAC3C,CAAC;IAED,6BAAY,GAAZ;QACI,IAAI,GAAG,GAAC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;QAChC,4BAA4B;QAC5B,uHAAuH;QACvH,IAAI;IAER,CAAC;IAED,gCAAe,GAAf,UAAgB,SAAiB;QAC7B,IAAG,SAAS,EAAC;YACT,IAAI,CAAC,sBAAsB,EAAE,CAAC;SACjC;aAAI;YACD,eAAe;YACf,IAAI,CAAC,YAAY,CAAC,uBAAU,CAAC,IAAI,EAAC,6BAAgB,CAAC,KAAK,CAAC,CAAC;SAC7D;IACL,CAAC;IAED,kGAAkG;IAClG,6BAAY,GAAZ,UAAa,UAAqB,EAAC,MAAc,EAAC,OAAe;QAC7D,IAAG,MAAM,IAAE,UAAU,IAAE,uBAAU,CAAC,MAAM,EAAC;YACrC,IAAG,CAAC,wBAAc,CAAC,WAAW,EAAE,CAAC,gBAAgB,CAAC,GAAG,CAAC,EAAC;gBACnD,IAAI,IAAI,GAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,sBAAS,CAAC,SAAS,CAAC,CAAC;gBAC5D,IAAG,IAAI,IAAE,IAAI,CAAC,MAAM,EAAE,GAAC,IAAI,EAAC;oBACxB,qBAAW,CAAC,WAAW,EAAE,CAAC,WAAW,EAAE,CAAC,iBAAiB,CAAC,qBAAQ,CAAC,aAAa,EAAC,uBAAU,CAAC,KAAK,EAAC,CAAC,EAAC,CAAC,CAAC,CAAC;oBACvG,yDAAyD;oBACzD,iEAAiE;oBACjE,qBAAqB;oBACrB,sBAAsB;oBACtB,iCAAiC;oBACjC,uBAAuB;oBACvB,KAAK;iBAER;aACJ;SAEJ;IACL,CAAC;IAED,6BAAY,GAAZ,UAAa,OAAe;QAExB,IAAG,qBAAW,CAAC,WAAW,EAAE,CAAC,cAAc,IAAE,qBAAS,CAAC,YAAY;YACnE,OAAO;QACP,MAAM;QACN,IAAI,CAAC,aAAa,GAAC,KAAK,CAAC;QACzB,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;IAC9B,CAAC;IAED,4BAAW,GAAX,UAAY,SAAiB;QAA7B,iBAkDC;QAhDG,IAAI,QAAQ,GAAC,SAAS,CAAC,YAAY,CAAC,iBAAO,CAAC,CAAC,aAAa,EAAE,CAAC;QAC7D,IAAI,SAAS,GAAC,IAAI,CAAC,iBAAiB,CAAC,QAAQ,CAAC,CAAC;QAC/C,IAAI,IAAI,GAAC,IAAI,0BAAY,EAAE,CAAC;QAC5B,IAAI,CAAC,IAAI,GAAC,QAAQ,CAAC;QACnB,IAAI,CAAC,QAAQ,GAAC;YACV,IAAI,UAAU,GAAC,KAAI,CAAC,kBAAkB,EAAE,CAAC;YACzC,IAAI,SAAS,GAAC,QAAQ,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;YACvC,IAAI,UAAU,GAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,EAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YACnD,IAAI,MAAM,GAAC,iBAAM,aAAa,aAAC,uBAAU,CAAC,MAAM,EAAC,IAAI,EAAC,sBAAS,CAAC,IAAI,CAAC,CAAC;YACtE,gBAAgB;YAChB,IAAG,CAAC,wBAAc,CAAC,WAAW,EAAE,CAAC,gBAAgB,CAAC,GAAG,CAAC,EAAC;gBACnD,MAAM;gBACN,MAAM,CAAC,SAAS,CAAC,GAAG,IAAE,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,sBAAS,CAAC,SAAS,CAAC,CAAC;aAC9E;YACD,YAAY;YACZ,IAAG,KAAI,CAAC,WAAW,CAAC,MAAM,GAAC,CAAC,EAAC;gBACzB,QAAQ;gBACR,IAAI,IAAI,GAAC,KAAI,CAAC,WAAW,CAAC,GAAG,EAAE,CAAC;gBAChC,oGAAoG;gBACpG,yHAAyH;gBACzH,IAAI,GAAG,GAAC,KAAI,CAAC,WAAW,CAAC,MAAM,CAAC;gBAChC,IAAI,KAAK,GAAC,GAAG,GAAC,CAAC,CAAA,CAAC,CAAA,GAAG,GAAC,GAAG,CAAA,CAAC,CAAA,CAAC,CAAC;gBAC1B,KAAI,IAAI,CAAC,GAAC,CAAC,EAAE,CAAC,GAAC,GAAG,EAAE,CAAC,EAAE,EAAC;oBACpB,KAAI,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,qBAAW,CAAC,CAAC,YAAY,CAAC,CAAC,GAAC,KAAK,CAAC,CAAC;iBACvE;aACJ;iBAAI;gBACD,IAAI,IAAI,GAAC,KAAI,CAAC,SAAS,CAAC,cAAc,CAAC,sBAAS,CAAC,SAAS,CAAC,CAAC;gBAC5D,IAAI,SAAS,GAAC,CAAC,CAAC;gBAChB,IAAG,KAAI,CAAC,SAAS,CAAC,2BAA2B,GAAC,CAAC,IAAI,KAAI,CAAC,aAAa,IAAE,KAAI,CAAC,SAAS,CAAC,2BAA2B,EACjH;oBACI,IAAI,GAAC,CAAC,CAAC;oBACP,iDAAiD;iBACpD;gBACD,IAAG,IAAI,IAAE,IAAI,CAAC,MAAM,EAAE,GAAC,IAAI,EAAC;oBACxB,KAAI,CAAC,aAAa,CAAC,SAAS,EAAC,UAAU,EAAC,KAAI,CAAC,YAAY,EAAC,SAAS,EAAC,MAAM,CAAC,CAAC;oBAC5E,KAAI,CAAC,aAAa,GAAC,CAAC,CAAC;iBAExB;qBAAI;oBACD,kGAAkG;oBAClG,KAAI,CAAC,aAAa,EAAE,CAAC;iBAExB;aACJ;QAEL,CAAC,CAAA;QACD,iBAAM,YAAY,YAAC,uBAAU,CAAC,MAAM,EAAC,SAAS,EAAC,CAAC,IAAI,CAAC,EAAC;YAClD,KAAI,CAAC,YAAY,CAAC,uBAAU,CAAC,IAAI,EAAC,KAAI,CAAC,aAAa,CAAC,CAAC;QAC1D,CAAC,CAAC,CAAC;IACP,CAAC;IAED,2BAAU,GAAV,UAAW,EAAe,EAAC,UAAkB,EAAC,KAAY,EAAC,GAAU,EAAC,MAAiB;QACnF,IAAI,IAAI,GAAC,yBAAe,CAAC,WAAW,EAAE,CAAC,oBAAoB,CAAC,EAAE,EAAC,UAAU,CAAC,CAAC;QAC3E,IAAI,CAAC,YAAY,CAAC,cAAI,CAAC,CAAC,IAAI,CAAC,EAAE,EAAC,KAAK,EAAC,GAAG,EAAC,MAAM,CAAC,CAAC;QAClD,qBAAW,CAAC,WAAW,EAAE,CAAC,aAAa,CAAC,SAAS,CAAC,2BAAU,CAAC,eAAe,CAAC,CAAC;IAClF,CAAC;IAED,iCAAgB,GAAhB,UAAiB,EAAe,EAAC,UAAkB,EAAC,KAAY,EAAC,GAAU,EAAC,MAAiB;QACzF,IAAI,IAAI,GAAC,yBAAe,CAAC,WAAW,EAAE,CAAC,oBAAoB,CAAC,EAAE,EAAC,UAAU,CAAC,CAAC;QAC3E,IAAI,CAAC,YAAY,CAAC,oBAAU,CAAC,CAAC,IAAI,CAAC,EAAE,EAAC,KAAK,EAAC,GAAG,EAAC,MAAM,CAAC,CAAC;IAC5D,CAAC;IAED,8BAAa,GAAb,UAAc,EAAe,EAAC,GAAW,EAAC,KAAY,EAAC,MAAc,EAAC,MAAiB;QACnF,IAAI,IAAI,GAAC,yBAAe,CAAC,WAAW,EAAE,CAAC,oBAAoB,CAAC,EAAE,EAAC,GAAG,CAAC,CAAC;QACpE,IAAI,CAAC,YAAY,CAAC,iBAAO,CAAC,CAAC,IAAI,CAAC,EAAE,EAAC,MAAM,EAAC,KAAK,EAAC,MAAM,EAAC,CAAC,CAAC,CAAC;QAC1D,qBAAW,CAAC,WAAW,EAAE,CAAC,aAAa,CAAC,SAAS,CAAC,2BAAU,CAAC,eAAe,CAAC,CAAC;IAClF,CAAC;IAED,sGAAsG;IAEtG,yBAAQ,GAAR,UAAS,GAAW;QAApB,iBAMC;QAJG,sBAAY,CAAC,WAAW,EAAE,CAAC,YAAY,CAAC;YACpC,KAAI,CAAC,aAAa,EAAE,CAAC;QACzB,CAAC,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACb,OAAO,CAAC,CAAC;IACb,CAAC;IAED,8BAAa,GAAb;QACI,eAAe;QACf,IAAI;IAER,CAAC;IAED,4BAAW,GAAX,UAAY,UAAkB,EAAC,SAAiB,EAAC,OAAe;QAC5D,GAAG;IACP,CAAC;IAlKgB,MAAM;QAD1B,OAAO;OACa,MAAM,CAmK1B;IAAD,aAAC;CAnKD,AAmKC,CAnKmC,cAAI,GAmKvC;kBAnKoB,MAAM","file":"","sourceRoot":"/","sourcesContent":["\r\nimport { GameState, JiaSu } from \"../../../Constants\";\r\nimport FightingManager from \"../../../Game/FightingManager\";\r\nimport { GameEffectId, GameEffectsManager } from \"../../../Game/GameEffectsManager\";\r\nimport GroundManager from \"../../../Game/GroundManager\";\r\nimport SkillManager from \"../../../Game/SkillManager\";\r\nimport GameManager from \"../../../GameManager\";\r\nimport Monster from \"../../../Monster/Monster\";\r\nimport { KeyFrameData } from \"../../../Monster/MonsterData\";\r\nimport MonsterManager from \"../../../Monster/MonsterManager\";\r\nimport { SoundIndex } from \"../../../Sound/AudioConstants\";\r\nimport WallManager from \"../../../Wall/WallManager\";\r\nimport { GongJiData } from \"../../Data/HeroData\";\r\nimport { BuffData } from \"../BuffData\";\r\nimport Hero from \"../Hero\";\r\nimport { BuffId, BuffType, DamageType, GongJi_FangXiang, Hero_State, ShieldId, ShieldType,  SkillType } from \"../HeroConfig\";\r\nimport ActiveDart from \"./ActiveDart\";\r\nimport Dart from \"./Dart\";\r\nimport EllipseMove from \"./EllipseMove\";\r\nimport FeiBiao from \"./FeiBiao\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class RenZhe extends Hero {\r\n\r\n    /**当前存在的被动飞镖节点 */\r\n    cur_feibiao:cc.Node[]=[];    \r\n    no_paopao_num:number=0;\r\n//---------------------------------------------加载----------------------------------------------\r\n    onLoad()\r\n    {\r\n        super.onLoad();        \r\n        // super.addLoadByGameEffectId(GameEffectId.renzhe_feibiao_att,4);\r\n        // super.addLoadByGameEffectId(GameEffectId.renzhe_feibiao_hit,4);\r\n        // super.addLoadByGameEffectId(GameEffectId.renzhe_feibiao_skill_hudun,1);\r\n        // super.addLoadByGameEffectId(GameEffectId.renzhe_feibiao_skill_1,4);\r\n        // super.addLoadByGameEffectId(GameEffectId.renzhe_feibiao_skill_ex,4);        \r\n        // super.addLoadByGameEffectId(GameEffectId.renzhe_feibiao_active_light_hit,2);\r\n        // super.addLoadByGameEffectId(GameEffectId.renzhe_feibiao_active_light_end,2);\r\n        // super.addLoadByGameEffectId(GameEffectId.renzhe_feibiao_active_ground_move,2);\r\n        // super.addLoadByGameEffectId(GameEffectId.renzhe_feibiao_active_ground_end,2);\r\n        // super.addLoadByGameEffectId(GameEffectId.renzhe_feibiao_active_light_move,2);        \r\n        // super.addLoadByGameEffectId(GameEffectId.renzhe_feibiao_huanrao,4);\r\n        // super.addLoadByGameEffectId(GameEffectId.renzhe_feibiao_active_ground_move,1);\r\n        this.addSkillListen(this.useSkill);\r\n        this.addAttackListen(this.normalAttack);\r\n        this.addXuanYunListen(this.onXuanYunResult);\r\n        this.addHitListen(this.onHitMonster);\r\n        this.addResetListen(this.onResetState);\r\n    }\r\n\r\n    onResetState(){\r\n        let num=this.cur_feibiao.length;\r\n        // for(let i=0; i<num; i++){\r\n        //     GameEffectsManager.getInstance().destroyGameEffectById(GameEffectId.renzhe_feibiao_huanrao,this.cur_feibiao[i]);\r\n        // }\r\n        \r\n    }\r\n\r\n    onXuanYunResult(isXuanYun:boolean){\r\n        if(isXuanYun){\r\n            this.unscheduleAllCallbacks();\r\n        }else{\r\n            //根据上个状态判断需要做什么\r\n            this.setHeroState(Hero_State.idle,GongJi_FangXiang.zhong);\r\n        }\r\n    }\r\n\r\n    //---------------------------------------------攻击-------------------------------------------------\r\n    onHitMonster(damageType:DamageType,isCrit:boolean,monster:cc.Node){\r\n        if(isCrit&&damageType==DamageType.Normal){\r\n            if(!MonsterManager.getInstance().checkWallMonster(300)){\r\n                let rate=this.hero_data.getSkillValue2(SkillType.Passive_2);\r\n                if(rate&&Math.random()<rate){\r\n                    WallManager.getInstance().getMainWall().addImmunityShield(ShieldId.RenZhe_Skill2,ShieldType.Skill,5,5);\r\n                    // super.addBuff(Hero_Buff.renzhe_skill_2immunity_skill,{\r\n                    //     remain_time: 5+this.hero_data.ExclusiveWeaponSkillValue_4,\r\n                    //     damage_num: 0,\r\n                    //     jiange_time: 1,\r\n                    //     hero_type: this.hero_type,\r\n                    //     other_value_1:1,\r\n                    // })\r\n                    \r\n                }                \r\n            }\r\n            \r\n        }\r\n    }\r\n\r\n    normalAttack(monster:cc.Node)\r\n    {\r\n        if(GameManager.getInstance().cur_game_state!=GameState.Game_Playing)\r\n        return;\r\n        //求出方向\r\n        this.is_can_gongji=false;\r\n        this.startAttack(monster);\r\n    }\r\n\r\n    startAttack(enemyNode:cc.Node)\r\n    {\r\n        let enemyPos=enemyNode.getComponent(Monster).getSheShouPos();\r\n        let fangxiang=this.getFangXiangByPos(enemyPos);        \r\n        let data=new KeyFrameData();\r\n        data.name=\"Attack\";\r\n        data.callback=()=>{\r\n            let jianshiPos=this.getCreateBulletPos();\r\n            let offsetPos=enemyPos.sub(jianshiPos);\r\n            let jianshiDir=Math.atan2(offsetPos.y,offsetPos.x);\r\n            let gjData=super.getGongJiData(DamageType.Normal,true,SkillType.Null);\r\n            //判断是否有敌军在300范围内\r\n            if(!MonsterManager.getInstance().checkWallMonster(300)){\r\n                //test\r\n                gjData.hero_data.Hit+=gjData.hero_data.getSkillValue1(SkillType.Passive_2);\r\n            }\r\n            //先判断有没有被动飞镖\r\n            if(this.cur_feibiao.length>0){\r\n                //减少一个飞镖\r\n                let node=this.cur_feibiao.pop();\r\n                // GameEffectsManager.getInstance().destroyGameEffectById(GameEffectId.renzhe_feibiao_huanrao,node);\r\n                // this.createFeiBiao(GameEffectId.renzhe_feibiao_skill_1,jianshiPos,this.bullet_speed,enemyNode,gjData);                \r\n                let num=this.cur_feibiao.length;\r\n                let angle=num>0?360/num:0;\r\n                for(let i=0; i<num; i++){\r\n                    this.cur_feibiao[i].getComponent(EllipseMove).refreshAngle(i*angle);\r\n                }\r\n            }else{\r\n                let rate=this.hero_data.getSkillValue1(SkillType.Passive_1);\r\n                let feibiaoId=0;\r\n                if(this.hero_data.ExclusiveWeaponSkillValue_1>0 && this.no_paopao_num>=this.hero_data.ExclusiveWeaponSkillValue_1)\r\n                {\r\n                    rate=1;\r\n                    //feibiaoId=GameEffectId.renzhe_feibiao_skill_ex;\r\n                }\r\n                if(rate&&Math.random()<rate){\r\n                    this.createFeiBiao(feibiaoId,jianshiPos,this.bullet_speed,enemyNode,gjData);\r\n                    this.no_paopao_num=0;\r\n                    \r\n                }else{\r\n                    //this.createDart(GameEffectId.renzhe_feibiao_att,jianshiPos,this.bullet_speed,jianshiDir,gjData);\r\n                    this.no_paopao_num++;\r\n                    \r\n                }\r\n            }\r\n            \r\n        }\r\n        super.setHeroState(Hero_State.attack,fangxiang,[data],()=>{\r\n            this.setHeroState(Hero_State.idle,this.cur_fangxiang);\r\n        });\r\n    }\r\n\r\n    createDart(id:GameEffectId,jianshiPos:cc.Vec2,speed:number,dir:number,gjData:GongJiData){\r\n        let node=FightingManager.getInstance().createGameEffectById(id,jianshiPos);\r\n        node.getComponent(Dart).init(id,speed,dir,gjData);\r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.YX_RenzheAttack);\r\n    }\r\n\r\n    createActiveDart(id:GameEffectId,jianshiPos:cc.Vec2,speed:number,dir:number,gjData:GongJiData){\r\n        let node=FightingManager.getInstance().createGameEffectById(id,jianshiPos);\r\n        node.getComponent(ActiveDart).init(id,speed,dir,gjData);\r\n    }\r\n\r\n    createFeiBiao(id:GameEffectId,pos:cc.Vec2,speed:number,target:cc.Node,gjData:GongJiData){\r\n        let node=FightingManager.getInstance().createGameEffectById(id,pos);\r\n        node.getComponent(FeiBiao).init(id,gjData,speed,target,5);\r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.YX_RenzheAttack);       \r\n    }\r\n\r\n    //---------------------------------------------技能-----------------------------------------------------\r\n\r\n    useSkill(pos:cc.Vec2):number\r\n    {        \r\n        SkillManager.getInstance().releaseSkill(()=>{\r\n            this.startSelfXuLi();\r\n        },this.node);\r\n        return 0;\r\n    }\r\n\r\n    startSelfXuLi(){\r\n        //蓄力帧监听        \r\n        //怪物\r\n        \r\n    }\r\n\r\n    startLaunch(groundMove:cc.Node,lightMove:cc.Node,monster:cc.Node){\r\n        // \r\n    }\r\n}\r\n"]}