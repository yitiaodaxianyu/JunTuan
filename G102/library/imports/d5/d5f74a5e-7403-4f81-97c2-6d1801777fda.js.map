{"version":3,"sources":["assets\\Scripts\\Monster\\MonsterBullet.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameState } from \"../Constants\";\r\nimport { GameEffectId, GameEffectsManager } from \"../Game/GameEffectsManager\";\r\nimport GameManager from \"../GameManager\";\r\nimport Wall from \"../Wall/Wall\";\r\nimport { MonsterAttData } from \"./MonsterData\";\r\n\r\n\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class MonsterBullet extends cc.Component {\r\n\r\n    game_effect_id:number=0;\r\n    game_effect_id_hit:number=0;\r\n    move_speed:number=700;\r\n    move_direction:number=Math.PI/2;\r\n    offset_xx_angle:number=90;\r\n    is_att:boolean=true;\r\n    monster_att_data:MonsterAttData=null;\r\n\r\n    collision_target_callback:Function=null;    \r\n    /**碰撞器 */\r\n    collider:cc.Collider=null;\r\n    /**加速度 */\r\n    acceleration:number=0;\r\n    /***************拖尾***************** */\r\n    @property({type:cc.Prefab})\r\n    prefab_tuowei:cc.Prefab=null;\r\n    /**拖尾节点 */\r\n    tuowei_node:cc.Node=null;\r\n    /**拖尾身位 */\r\n    tuowei_space:number=0.25;\r\n    tuowei_time:number=0.5;\r\n    /**拖尾归1（原点位置）的身位数 */\r\n    tuowei_guiyi:number=0;\r\n\r\n    init(monsterAttData:MonsterAttData,gameEffectId:GameEffectId,hitGameEffectId:number,speed:number,dir:number,angle:number=90)\r\n    {\r\n        this.monster_att_data=monsterAttData;\r\n        this.game_effect_id=gameEffectId;\r\n        this.game_effect_id_hit=hitGameEffectId;\r\n        this.move_speed=speed;\r\n        this.offset_xx_angle=angle;\r\n        this.is_att=false;\r\n        this.setDirection(dir);\r\n        this.collider=this.getComponent(cc.Collider);\r\n        if(this.prefab_tuowei){\r\n            this.tuowei_node=cc.instantiate(this.prefab_tuowei);\r\n            this.tuowei_node.parent=this.node.parent;\r\n            this.node.zIndex=1;\r\n            this.tuowei_time=this.tuowei_node.getComponent(cc.MotionStreak).fadeTime;\r\n            this.tuowei_guiyi=1/this.tuowei_time;\r\n        }\r\n    }\r\n\r\n    /**获取下一帧位置 */\r\n    getNextPos(dt:number):cc.Vec2\r\n    {\r\n        let gr=GameManager.getInstance().getGameRate();\r\n        if(gr<1){\r\n            gr=1;\r\n        }\r\n        let distance=this.tuowei_space*this.tuowei_guiyi*this.move_speed*dt/gr;\r\n        let xx=this.node.x+Math.cos(this.move_direction)*distance;\r\n        let yy=this.node.y+Math.sin(this.move_direction)*distance;\r\n        return cc.v2(xx,yy);\r\n    }\r\n\r\n    getHeadPos():cc.Vec2{\r\n        let distance=this.move_speed*cc.director.getDeltaTime();\r\n        let xx=this.node.x+Math.cos(this.move_direction)*distance;\r\n        let yy=this.node.y+Math.sin(this.move_direction)*distance;\r\n        return cc.v2(xx,yy);\r\n    }\r\n\r\n    getAPos(offsetDistance:number):cc.Vec2{\r\n        let distance=this.move_speed*cc.director.getDeltaTime()-offsetDistance;\r\n        let xx=this.node.x+Math.cos(this.move_direction)*distance;\r\n        let yy=this.node.y+Math.sin(this.move_direction)*distance;\r\n        return cc.v2(xx,yy);\r\n    }\r\n\r\n    update (dt) {\r\n        if(GameManager.getInstance().cur_game_state!=GameState.Game_Playing)\r\n        return;\r\n        let xx=this.move_speed*dt*Math.cos(this.move_direction);\r\n        let yy=this.move_speed*dt*Math.sin(this.move_direction);\r\n        this.node.x+=xx;\r\n        this.node.y+=yy;\r\n        if(this.node.y>cc.winSize.height){\r\n            this.destroySelf();\r\n        }\r\n        if(Math.abs(this.node.x)>cc.winSize.width){\r\n            this.destroySelf();\r\n        }\r\n        if(this.tuowei_node){\r\n            this.tuowei_node.setPosition(this.getNextPos(dt));\r\n        }\r\n    }\r\n\r\n    destroySelf()\r\n    {\r\n        GameEffectsManager.getInstance().destroyGameEffectById(this.game_effect_id,this.node);\r\n    }\r\n\r\n    setDirection(dir:number)\r\n    {\r\n        this.move_direction=dir;\r\n        this.node.angle=180*dir/Math.PI-this.offset_xx_angle;\r\n    }\r\n    /**添加城墙碰撞的监听,指玩家召唤的城墙 */\r\n    addCollisionWallListen(callback:Function){\r\n        this.collision_target_callback=callback;\r\n    }\r\n\r\n    ////--------------------------------------碰撞开始----------------------------------------------------\r\n    onCollisionEnter(other:cc.Collider,self:cc.Collider) {\r\n        let gm=GameManager.getInstance();        \r\n        if(gm.cur_game_state==GameState.Game_Lose || this.is_att==true)\r\n            return;\r\n        let group=other.node.group;\r\n        switch(group){\r\n            case 'wall':{\r\n                let wall=other.node.getComponent(Wall);\r\n                if(this.collision_target_callback){\r\n                    //有回调就处理回调\r\n                    if(this.collision_target_callback(wall))\r\n                    {\r\n                        return;\r\n                    }\r\n                }          \r\n                let aData=wall.beInjured(this.monster_att_data);\r\n                if(aData.getDamageNum()>0){\r\n                    if(this.game_effect_id_hit>0){\r\n                        let hit=GameEffectsManager.getInstance().createGameEffectById(this.game_effect_id_hit,this.node.getPosition());\r\n                        let animation=hit.getComponent(cc.Animation);\r\n                        animation.play();\r\n                        animation.on(cc.Animation.EventType.FINISHED,()=>{                    \r\n                            animation.off(cc.Animation.EventType.FINISHED);\r\n                            GameEffectsManager.getInstance().destroyGameEffectById(this.game_effect_id_hit,this.node)                        \r\n                        })\r\n                    }                    \r\n                }\r\n                this.destroySelf();\r\n            }break;\r\n        }\r\n    }\r\n}\r\n"]}