{"version":3,"sources":["assets\\Scripts\\GuaJi\\GuaJiManager.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,+CAA0C;AAC1C,+CAA0C;AAC1C,uCAAkC;AAG5B,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAA0C,gCAAY;IAAtD;QAAA,qEAgQC;QA7PG,2BAAqB,GAAa,EAAE,CAAC;QAGrC,oBAAc,GAAW,IAAI,CAAC;QAG9B,mBAAa,GAAW,IAAI,CAAC;QAG7B,gBAAU,GAAW,IAAI,CAAC;QAG1B,oBAAc,GAAW,IAAI,CAAC;QAG9B,mBAAa,GAAW,IAAI,CAAC;QAG7B,oBAAc,GAAW,IAAI,CAAC;QAG9B,gBAAU,GAAW,IAAI,CAAC;QAE1B,8BAA8B;QAC9B,8BAA8B;QAE9B,kBAAY,GAAS,IAAI,CAAC;QAC1B,gBAAU,GAAS,IAAI,CAAC;QACxB,iBAAW,GAAS,IAAI,CAAC;QACzB,cAAQ,GAAS,IAAI,CAAC;QACtB,iBAAW,GAAS,IAAI,CAAC;QACzB,cAAQ,GAAS,IAAI,CAAC;QACtB,UAAU;QACV,gBAAU,GAAQ,EAAE,CAAC;QAErB,aAAO,GAAS,EAAE,CAAC,EAAE,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC;;IA0N/B,CAAC;qBAhQoB,YAAY;IA2Cf,wBAAW,GAAzB;QAEI,IAAG,IAAI,CAAC,SAAS,IAAE,IAAI,EACvB;YACI,IAAI,IAAI,GAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;YACvB,EAAE,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;YAC/D,IAAI,CAAC,SAAS,GAAC,IAAI,CAAC,YAAY,CAAC,cAAY,CAAC,CAAC;SAClD;QACD,OAAO,IAAI,CAAC,SAAS,CAAC;IAC1B,CAAC;IAED,6BAAM,GAAN;QACI,cAAY,CAAC,SAAS,GAAC,IAAI,CAAC;QAC5B,IAAI,CAAC,YAAY,GAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC;QAC3D,IAAI,CAAC,UAAU,GAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,CAAC;QACvD,IAAI,CAAC,WAAW,GAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;QACzD,IAAI,CAAC,QAAQ,GAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;QACnD,IAAI,CAAC,WAAW,GAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;QACzD,IAAI,CAAC,QAAQ,GAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;QACnD,EAAE,CAAC,QAAQ,CAAC,mBAAmB,EAAE,CAAC,OAAO,GAAC,IAAI,CAAC;QAC/C,IAAI,CAAC,OAAO,GAAC,EAAE,CAAC,IAAI,CAAC,+BAA+B,CAAC,CAAC,WAAW,EAAE,CAAC;IACxE,CAAC;IAES,4BAAK,GAAf;QACI,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,EAAC,CAAC,CAAC,CAAC;QACnC,IAAI,CAAC,YAAY,EAAE,CAAC;IACxB,CAAC;IAED,mCAAY,GAAZ;QACI,IAAI,OAAO,GAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC,WAAW,EAAE,CAAC;QAC3D,IAAI,CAAC,kBAAkB,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,GAAC,IAAI,CAAC,MAAM,EAAE,GAAC,GAAG,GAAC,GAAG,EAAC,OAAO,CAAC,CAAC,GAAC,GAAG,GAAC,IAAI,CAAC,MAAM,EAAE,GAAC,EAAE,GAAC,EAAE,CAAC,CAAC,CAAA;QAC3F,IAAI,CAAC,kBAAkB,CAAC,EAAE,CAAC,EAAE,CAAC,GAAG,GAAC,IAAI,CAAC,MAAM,EAAE,GAAC,GAAG,GAAC,GAAG,EAAC,OAAO,CAAC,CAAC,GAAC,GAAG,GAAC,IAAI,CAAC,MAAM,EAAE,GAAC,EAAE,GAAC,EAAE,CAAC,CAAC,CAAA;IAC/F,CAAC;IAED,gCAAS,GAAT;QAEI,cAAY,CAAC,SAAS,GAAC,IAAI,CAAC;IAChC,CAAC;IAED,yCAAkB,GAAlB,UAAmB,GAAW;QAC1B,IAAI;QACJ,IAAI,SAAS,GAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAC,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,CAAC;QAC1E,IAAI,IAAI,GAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,qBAAqB,CAAC,SAAS,CAAC,CAAC,CAAC;QAC/D,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAC/B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QACtB,IAAI,CAAC,YAAY,CAAC,sBAAY,CAAC,CAAC,IAAI,EAAE,CAAC;QACvC,IAAI,CAAC,MAAM,GAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QACnB,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,mCAAY,GAAZ,UAAa,GAAW;QACpB,IAAI,IAAI,GAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC5C,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAChC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QACtB,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,oCAAa,GAAb,UAAc,GAAW,EAAC,GAAU;QAChC,IAAI,IAAI,GAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAC7C,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QACjC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QACtB,IAAI,CAAC,YAAY,CAAC,sBAAY,CAAC,CAAC,IAAI,CAAC,GAAG,EAAC,CAAC,CAAC,CAAC;QAC5C,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,uCAAgB,GAAhB,UAAiB,GAAW,EAAC,GAAU;QACnC,IAAI,IAAI,GAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAC7C,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QACjC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QACtB,IAAI,CAAC,YAAY,CAAC,sBAAY,CAAC,CAAC,IAAI,CAAC,GAAG,EAAC,CAAC,EAAC,IAAI,CAAC,CAAC;QACjD,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,gCAAS,GAAT,UAAU,GAAW;QACjB,IAAI,IAAI,GAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACzC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAC7B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QACtB,IAAI,KAAK,GAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;QAC1C,KAAK,CAAC,IAAI,EAAE,CAAC;QACb,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC,SAAS,CAAC,SAAS,CAAC,QAAQ,EAAC;YACrC,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC5B,CAAC,CAAC,CAAA;QACF,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,mCAAY,GAAZ,UAAa,GAAW;QACpB,IAAI,IAAI,GAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAC7C,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAC7B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QACtB,IAAI,KAAK,GAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC;QAC1C,KAAK,CAAC,IAAI,EAAE,CAAC;QACb,KAAK,CAAC,EAAE,CAAC,EAAE,CAAC,SAAS,CAAC,SAAS,CAAC,QAAQ,EAAC;YACrC,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC5B,CAAC,CAAC,CAAA;QACF,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,mCAAY,GAAZ,UAAa,GAAW;QACpB,IAAI,IAAI,GAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QAC5C,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAChC,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QACtB,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,gCAAS,GAAT,UAAU,MAAa,EAAC,GAAW;QAC/B,IAAI,IAAI,GAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACzC,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;QAC7B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;QACtB,IAAI,CAAC,YAAY,CAAC,kBAAQ,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACzC,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,iFAAiF;IACjF;;;;;;OAMG;IACH,4CAAqB,GAArB,UAAsB,QAAe,EAAC,SAAiB,EAAC,MAAa;QAEjE,IAAG,QAAQ,IAAE,CAAC,EACd;YACI,OAAO,IAAI,CAAC;SACf;QACD,IAAI,GAAG,GAAC,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC;QACtC,IAAG,GAAG,IAAE,CAAC,EACT;YACI,OAAO,IAAI,CAAC;SACf;QACD,sBAAsB;QACtB,IAAI,WAAW,GAAW,EAAE,CAAC;QAC7B,KAAI,IAAI,CAAC,GAAC,CAAC,EAAC,CAAC,GAAC,GAAG,EAAE,CAAC,EAAE,EACtB;YACI,IAAI,OAAO,GAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;YACxC,IAAG,OAAO,CAAC,YAAY,CAAC,sBAAY,CAAC,CAAC,aAAa,EAAE,EAAC;gBAClD,IAAI,QAAQ,GAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC;gBACxD,IAAG,QAAQ,IAAE,MAAM,EACnB;oBACI,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;iBAC7B;aACJ;SACJ;QACD,IAAG,WAAW,CAAC,MAAM,IAAE,CAAC,EACxB;YACI,OAAO,IAAI,CAAC;SACf;QACD,IAAG,QAAQ,IAAE,WAAW,CAAC,MAAM,EAC/B;YACI,OAAO,WAAW,CAAC;SACtB;QACD,uCAAuC;QACvC,iBAAiB;QACjB,WAAW,CAAC,IAAI,CAAC,UAAC,CAAS,EAAC,CAAS;YACjC,OAAO,CAAC,CAAC,CAAC,GAAC,CAAC,CAAC,CAAC,CAAC;QACnB,CAAC,CAAC,CAAC;QACH,WAAW,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QAC7B,OAAO,WAAW,CAAC;IACvB,CAAC;IAED;;;;;;OAMG;IACH,0CAAmB,GAAnB,UAAoB,QAAe,EAAC,SAAiB,EAAC,MAAa;QAC/D,IAAG,QAAQ,IAAE,CAAC,EACd;YACI,OAAO,IAAI,CAAC;SACf;QACD,IAAI,GAAG,GAAC,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC;QACtC,IAAG,GAAG,IAAE,CAAC,EACT;YACI,OAAO,IAAI,CAAC;SACf;QACD,sBAAsB;QACtB,IAAI,WAAW,GAAW,EAAE,CAAC;QAC7B,KAAI,IAAI,CAAC,GAAC,CAAC,EAAC,CAAC,GAAC,GAAG,EAAE,CAAC,EAAE,EACtB;YACI,IAAI,OAAO,GAAC,IAAI,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;YACxC,IAAG,OAAO,CAAC,YAAY,CAAC,sBAAY,CAAC,CAAC,aAAa,EAAE,EAAC;gBAClD,IAAI,QAAQ,GAAC,SAAS,CAAC,GAAG,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC;gBACxD,IAAG,QAAQ,IAAE,MAAM,EACnB;oBACI,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;iBAC7B;aACJ;SAEJ;QACD,IAAG,WAAW,CAAC,MAAM,IAAE,CAAC,EACxB;YACI,OAAO,IAAI,CAAC;SACf;QACD,WAAW;QACX,IAAG,QAAQ,GAAC,CAAC,EACb;YACI,OAAO,WAAW,CAAC;SACtB;QACD,2BAA2B;QAC3B,IAAG,QAAQ,IAAE,WAAW,CAAC,MAAM,EAC/B;YACI,OAAO,WAAW,CAAC;SACtB;QACD,wCAAwC;QACxC,WAAW,CAAC,IAAI,CAAC,UAAC,CAAS,EAAC,CAAS;YACjC,OAAO,CAAC,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,GAAG,EAAE,GAAC,CAAC,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,GAAG,EAAE,CAAC;QACrF,CAAC,CAAC,CAAC;QACH,WAAW,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;QAC7B,OAAO,WAAW,CAAC;IACvB,CAAC;;IAvNc,sBAAS,GAAiB,IAAI,CAAC;IArC9C;QADC,QAAQ,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;+DACe;IAGrC;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;wDACU;IAG9B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;uDACS;IAG7B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;oDACM;IAG1B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;wDACU;IAG9B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;uDACS;IAG7B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;wDACU;IAG9B;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;oDACM;IAxBT,YAAY;QADhC,OAAO;OACa,YAAY,CAgQhC;IAAD,mBAAC;CAhQD,AAgQC,CAhQyC,EAAE,CAAC,SAAS,GAgQrD;kBAhQoB,YAAY","file":"","sourceRoot":"/","sourcesContent":["import GuaJiJianShi from \"./GuaJiJianShi\";\r\nimport GuaJiMonster from \"./GuaJiMonster\";\r\nimport GuaJiRes from \"./GuaJiRes\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GuaJiManager extends cc.Component {\r\n\r\n    @property([cc.Prefab])\r\n    prefabs_guaji_monster:cc.Prefab[]=[];\r\n\r\n    @property(cc.Prefab)\r\n    prefab_jianshi:cc.Prefab=null;\r\n\r\n    @property(cc.Prefab)\r\n    prefab_shadow:cc.Prefab=null;\r\n\r\n    @property(cc.Prefab)\r\n    prefab_hit:cc.Prefab=null;\r\n\r\n    @property(cc.Prefab)\r\n    prefab_pet_hit:cc.Prefab=null;\r\n    \r\n    @property(cc.Prefab)\r\n    prefab_tuowei:cc.Prefab=null;\r\n\r\n    @property(cc.Prefab)\r\n    prefab_bullect:cc.Prefab=null;\r\n\r\n    @property(cc.Prefab)\r\n    prefab_res:cc.Prefab=null;\r\n\r\n    // @property([cc.SpriteFrame])\r\n    // sp_res:cc.SpriteFrame[]=[];\r\n\r\n    jianshi_root:cc.Node=null;\r\n    guawi_root:cc.Node=null;\r\n    shadow_root:cc.Node=null;\r\n    hit_root:cc.Node=null;\r\n    tuowei_root:cc.Node=null;\r\n    res_root:cc.Node=null;\r\n    /**背景移速 */\r\n    bg_speed_x:number=40;\r\n\r\n    box_pos:cc.Vec2=cc.v2(0,0);\r\n\r\n    private static _instance: GuaJiManager = null;\r\n\r\n\r\n    public static getInstance():GuaJiManager\r\n    {\r\n        if(this._instance==null)\r\n        {\r\n            let node=new cc.Node();\r\n            cc.director.getScene().getChildByName(\"Canvas\").addChild(node);\r\n            this._instance=node.addComponent(GuaJiManager);\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    onLoad () {\r\n        GuaJiManager._instance=this;\r\n        this.jianshi_root=this.node.getChildByName('jianshi_root');\r\n        this.guawi_root=this.node.getChildByName('guawi_root');\r\n        this.shadow_root=this.node.getChildByName('shadow_root');\r\n        this.hit_root=this.node.getChildByName('hit_root');\r\n        this.tuowei_root=this.node.getChildByName('tuowei_root');\r\n        this.res_root=this.node.getChildByName('res_root');        \r\n        cc.director.getCollisionManager().enabled=true;        \r\n        this.box_pos=cc.find('Canvas/main_ui/Main_Icon_Idle').getPosition();        \r\n    }\r\n\r\n    protected start(): void {\r\n        this.schedule(this.startMonster,3);\r\n        this.startMonster();\r\n    }\r\n\r\n    startMonster(){\r\n        let heroPos=this.node.getChildByName('hero').getPosition();\r\n        this.createGuaJiMonster(cc.v2(480+Math.random()*200-100,heroPos.y-100+Math.random()*80-80))\r\n        this.createGuaJiMonster(cc.v2(480+Math.random()*200+100,heroPos.y-100+Math.random()*80-80))\r\n    }\r\n\r\n    onDestroy()\r\n    {        \r\n        GuaJiManager._instance=null;\r\n    }\r\n\r\n    createGuaJiMonster(pos:cc.Vec2):cc.Node{\r\n        //随机\r\n        let randIndex=Math.floor(Math.random()*this.prefabs_guaji_monster.length);\r\n        let node=cc.instantiate(this.prefabs_guaji_monster[randIndex]);\r\n        this.guawi_root.addChild(node);\r\n        node.setPosition(pos);\r\n        node.getComponent(GuaJiMonster).init();\r\n        node.zIndex=-pos.y;\r\n        return node;\r\n    }\r\n\r\n    createShadow(pos:cc.Vec2):cc.Node{\r\n        let node=cc.instantiate(this.prefab_shadow);\r\n        this.shadow_root.addChild(node);\r\n        node.setPosition(pos);\r\n        return node;\r\n    }\r\n\r\n    createJianShi(pos:cc.Vec2,dir:number):cc.Node{\r\n        let node=cc.instantiate(this.prefab_jianshi);\r\n        this.jianshi_root.addChild(node);\r\n        node.setPosition(pos);\r\n        node.getComponent(GuaJiJianShi).init(dir,1);\r\n        return node;\r\n    }\r\n\r\n    createPetBullect(pos:cc.Vec2,dir:number):cc.Node{\r\n        let node=cc.instantiate(this.prefab_bullect);\r\n        this.jianshi_root.addChild(node);\r\n        node.setPosition(pos);\r\n        node.getComponent(GuaJiJianShi).init(dir,2,true);\r\n        return node;\r\n    }\r\n\r\n    createHit(pos:cc.Vec2):cc.Node{\r\n        let node=cc.instantiate(this.prefab_hit);\r\n        this.hit_root.addChild(node);\r\n        node.setPosition(pos);\r\n        let anima=node.getComponent(cc.Animation);\r\n        anima.play();\r\n        anima.on(cc.Animation.EventType.FINISHED,()=>{\r\n            node.removeFromParent();\r\n        })\r\n        return node;\r\n    }\r\n\r\n    createPetHit(pos:cc.Vec2):cc.Node{\r\n        let node=cc.instantiate(this.prefab_pet_hit);\r\n        this.hit_root.addChild(node);\r\n        node.setPosition(pos);\r\n        let anima=node.getComponent(cc.Animation);\r\n        anima.play();\r\n        anima.on(cc.Animation.EventType.FINISHED,()=>{\r\n            node.removeFromParent();\r\n        })\r\n        return node;\r\n    }\r\n\r\n    createTuoWei(pos:cc.Vec2):cc.Node{\r\n        let node=cc.instantiate(this.prefab_tuowei);\r\n        this.tuowei_root.addChild(node);\r\n        node.setPosition(pos);\r\n        return node;\r\n    }\r\n\r\n    createRes(propId:number,pos:cc.Vec2){\r\n        let node=cc.instantiate(this.prefab_res);\r\n        this.res_root.addChild(node);\r\n        node.setPosition(pos);\r\n        node.getComponent(GuaJiRes).init(propId);\r\n        return node;\r\n    }\r\n\r\n    //--------------------------GET--------------------------------------------------\r\n    /**\r\n     * 获取指定位置targetPos的指定范围fanwei内靠近城墙最近的cheakNum个敌人\r\n     * @param cheakNum 检测数量\r\n     * @param targetPos 指定的位置，一般是自身位置\r\n     * @param fanwei 指定的检测范围，一般是攻击距离\r\n     * @returns 所有满足条件的敌人\r\n     */\r\n    getMonstersForNearest(cheakNum:number,targetPos:cc.Vec2,fanwei:number):cc.Node[]\r\n    {\r\n        if(cheakNum==0)\r\n        {\r\n            return null;\r\n        }\r\n        let len=this.guawi_root.childrenCount;\r\n        if(len<=0)\r\n        {\r\n            return null;\r\n        }\r\n        //1.先检测在攻击范围内符合攻击单位的敌人\r\n        let attMonsters:cc.Node[]=[];        \r\n        for(let i=0;i<len; i++)\r\n        {\r\n            let monster=this.guawi_root.children[i];\r\n            if(monster.getComponent(GuaJiMonster).getIsCanCheak()){\r\n                let distance=targetPos.sub(monster.getPosition()).mag();\r\n                if(distance<=fanwei)\r\n                {\r\n                    attMonsters.push(monster);\r\n                }\r\n            }            \r\n        }\r\n        if(attMonsters.length<=0)\r\n        {\r\n            return null;\r\n        }\r\n        if(cheakNum>=attMonsters.length)\r\n        {\r\n            return attMonsters;\r\n        }\r\n        //2.对可以攻击的敌人进行优先级判断,选出cheakNum个目标作为打击单位\r\n        //2.1优先攻击跟城墙最近的单位\r\n        attMonsters.sort((a:cc.Node,b:cc.Node)=>{\r\n            return a.x-b.x;\r\n        });        \r\n        attMonsters.splice(cheakNum);        \r\n        return attMonsters;\r\n    }\r\n\r\n    /**\r\n     * //获取指定位置targetPos的指定范围fanwei内cheakNum个敌人\r\n     * @param cheakNum 检测数量，小于0表示所有，如-1\r\n     * @param targetPos 目标位置\r\n     * @param fanwei 范围\r\n     * @returns 所有符合条件的敌人\r\n     */    \r\n    getCollisionMonster(cheakNum:number,targetPos:cc.Vec2,fanwei:number){\r\n        if(cheakNum==0)\r\n        {\r\n            return null;\r\n        }\r\n        let len=this.guawi_root.childrenCount;\r\n        if(len<=0)\r\n        {\r\n            return null;\r\n        }\r\n        //1.先检测在攻击范围内符合攻击单位的敌人\r\n        let attMonsters:cc.Node[]=[];        \r\n        for(let i=0;i<len; i++)\r\n        {\r\n            let monster=this.guawi_root.children[i];\r\n            if(monster.getComponent(GuaJiMonster).getIsCanCheak()){\r\n                let distance=targetPos.sub(monster.getPosition()).mag();\r\n                if(distance<=fanwei)\r\n                {\r\n                    attMonsters.push(monster);\r\n                }\r\n            }\r\n            \r\n        }\r\n        if(attMonsters.length<=0)\r\n        {\r\n            return null;\r\n        }\r\n        //小于0，代表要所有\r\n        if(cheakNum<0)\r\n        {\r\n            return attMonsters;\r\n        }\r\n        //如果检测到的数量没有要检测的那么多，直接返回全部.\r\n        if(cheakNum>=attMonsters.length)\r\n        {\r\n            return attMonsters;\r\n        }\r\n        //2.1优先攻击跟目标位置最近的单位，按照与pos的距离大小进行排列，从小到大\r\n        attMonsters.sort((a:cc.Node,b:cc.Node)=>{\r\n            return a.getPosition().sub(targetPos).mag()-b.getPosition().sub(targetPos).mag();\r\n        });\r\n        attMonsters.splice(cheakNum);\r\n        return attMonsters;\r\n    }\r\n}\r\n"]}