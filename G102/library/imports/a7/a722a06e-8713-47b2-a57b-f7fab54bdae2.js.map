{"version":3,"sources":["assets\\Scripts\\Monster\\Elite\\XueGuai.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { GameState } from \"../../Constants\";\r\nimport { GameEffectsManager, GameEffectId } from \"../../Game/GameEffectsManager\";\r\nimport GroundManager from \"../../Game/GroundManager\";\r\nimport GameManager from \"../../GameManager\";\r\nimport { HaloData, HaloId } from \"../../Hero/Game/HeroConfig\";\r\nimport Monster from \"../Monster\";\r\nimport MonsterManager from \"../MonsterManager\";\r\nimport MonsterNewNormal from \"../MonsterNewNormal\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class XueGuai extends MonsterNewNormal {\r\n\r\n    light:cc.Node=null;\r\n    is_loaded:boolean=false;\r\n    load_num:number=0;\r\n\r\n    protected onLoad(): void {\r\n        super.onLoad();\r\n        super.addMonsterNormalInited(this.onMonsterNormalInited);\r\n        super.addMonsterNormalDeath(this.onMonsterNormalDeath);\r\n        GameEffectsManager.getInstance().addEffectPoolById(GameEffectId.monster_zhiliao_halo,1,()=>{\r\n            //添加光环特效\r\n            if(!this.light){\r\n                this.light=GroundManager.getInstance().createGameEffectById(GameEffectId.monster_zhiliao_halo,this.node.getPosition());\r\n            }\r\n            this.load_num++;\r\n            if(this.load_num>=2){\r\n                this.is_loaded=true;\r\n            }\r\n        });\r\n        GameEffectsManager.getInstance().addEffectPoolById(GameEffectId.monster_zhiliao_halo_hit,8,()=>{\r\n            this.load_num++;\r\n            if(this.load_num>=2){\r\n                this.is_loaded=true;\r\n            }\r\n        });\r\n\r\n        \r\n    }\r\n\r\n    onMonsterNormalInited () {\r\n        if(this.is_loaded){\r\n            if(!this.light){\r\n                this.light=GroundManager.getInstance().createGameEffectById(GameEffectId.monster_zhiliao_halo,this.node.getPosition());\r\n            }\r\n        }\r\n        this.skill_cold_down[0]=this.skill_data.getSkillValue1(1);\r\n    }\r\n\r\n    onMonsterNormalDeath(){\r\n        //以及删除所有光环数据\r\n        if(this.light){\r\n            GameEffectsManager.getInstance().destroyGameEffectById(GameEffectId.monster_zhiliao_halo,this.light);\r\n            this.light=null;\r\n        }\r\n    }\r\n\r\n    update (dt) {\r\n        if((GameManager.getInstance().cur_game_state!=GameState.Game_Playing)||this.getIsDie())\r\n        {\r\n            return;\r\n        }\r\n        super.update(dt);\r\n        this.checkSkill(dt);\r\n        if(this.light){\r\n            this.light.setPosition(this.getCenterPos());\r\n        }\r\n    }\r\n\r\n    checkSkill(dt:number){\r\n        if(this.is_loaded==true){\r\n            for(let i=0; i<this.skill_cold_down.length; i++){\r\n                let isCanSkill=false;\r\n                if(this.skill_cold_down[i]>0){\r\n                    this.skill_cold_down[i]-=dt;\r\n                    if(this.skill_cold_down[i]<=0){\r\n                        isCanSkill=true;\r\n                    }\r\n                }else{\r\n                    isCanSkill=true;\r\n                }\r\n                if(isCanSkill){\r\n                    this.skill_cold_down[i]=this.skill_data.getSkillValue1(1);\r\n                    let allMonster=MonsterManager.getInstance().node.children;\r\n                    let len=allMonster.length;\r\n                    if(len<=0)\r\n                    {\r\n                        return null;\r\n                    }            \r\n                    for(let i=0;i<len; i++)\r\n                    {\r\n                        let monster=allMonster[i];\r\n                        let monsterTS=monster.getComponent(Monster);\r\n                        if(monsterTS && monsterTS.getIsCanCheck())\r\n                        {\r\n                            let pos=monsterTS.getCenterPos();\r\n                            let distance=this.getCenterPos().sub(pos).mag();\r\n                            if(distance<=200)\r\n                            {\r\n                                //恢复生命值\r\n                                let isOk=monsterTS.beHeal(this.getMaxHp()*this.skill_data.getSkillValue2(1));\r\n                                if(isOk){\r\n                                    //特效\r\n                                    GameEffectsManager.getInstance().createGameEffectById(GameEffectId.monster_zhiliao_halo_hit,pos);\r\n                                }                                \r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }                \r\n    }\r\n    \r\n}\r\n"]}