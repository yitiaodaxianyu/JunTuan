{"version":3,"sources":["assets\\Scripts\\Payment\\RabateManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { CustomsClearanceRebateManager } from \"../JsonData/CustomsClearanceRebate\";\r\nimport { RewardData } from \"../JsonData/LevelJsonData\";\r\nimport { LevelUpRebateManager } from \"../JsonData/LevelUpRebate\";\r\nimport { LevelManager } from \"../Level/LevelManager\";\r\nimport { MissionLevelManager } from \"../Level/MissionLevel\";\r\nimport { Follow_Type } from \"../multiLanguage/FollowConstants\";\r\nimport FollowManager from \"../multiLanguage/FollowManager\";\r\nimport { PayManager } from \"../Payment/PayManager\";\r\nimport { PropId } from \"../Prop/PropConfig\";\r\nimport {  PayId } from \"../thirdParty/ThirdParty\";\r\nimport UserData from \"../UserData\";\r\n\r\nexport enum RabateType{\r\n    Campaign=0,//征战/通关返利\r\n    Growth,//成长/升级返利\r\n}\r\n\r\nexport class RabateData{   \r\n    /**是否完成 */\r\n    is_complete:boolean=false;\r\n    /**是否已经领取 */\r\n    is_claimed:boolean=false;\r\n    /**是否购买 */\r\n    is_buy:boolean=false;\r\n    /**是否可点击 */\r\n    is_can_click:boolean=false;\r\n    /**需要的条件 */\r\n    need_num:number=0;\r\n    /**当前的条件 */\r\n    cur_num:number=0;\r\n}\r\n\r\nexport class RabateManager {\r\n    private static _instance: RabateManager = null;\r\n   \r\n    public static getInstance():RabateManager {\r\n        if(this._instance==null) {\r\n            this._instance=new RabateManager();PayId.Campaign\r\n            console.log(\"RabateManager null\");\r\n            this._instance.init();\r\n        }\r\n        return this._instance;\r\n    }\r\n    //初始化游戏数据\r\n    private init () {        \r\n       \r\n    }\r\n    /**\r\n     * @param type 返利类型\r\n     * @param id 通关返利:章节数,升级返利:等级数\r\n     * @returns 返回对应的领取状态\r\n     */\r\n    public static getClaimState(type:RabateType,id:number):number\r\n    {        \r\n        let num=cc.sys.localStorage.getItem('rabate_claim_state_'+type+\"_\"+id);\r\n        if(num!=\"\"&&num!=null)\r\n        {\r\n            num=parseInt(num);\r\n        }else\r\n        {\r\n            num=0;\r\n        }\r\n        return num;\r\n    }\r\n    /**\r\n     * \r\n     * @param type 返利类型\r\n     * @param id 通关返利:章节数,升级返利:等级数\r\n     * @param num 领取状态,大于0表示已领取，其他表示未领取\r\n     */\r\n    public static saveClaimState(type:RabateType,id:number,num:number)\r\n    {\r\n        cc.sys.localStorage.setItem('rabate_claim_state_'+type+\"_\"+id,num);\r\n    }\r\n\r\n    public static getRabateData(type:RabateType,id:number):RabateData{\r\n        let rd=new RabateData();\r\n        /**是否购买 */\r\n        rd.is_buy=PayManager.getInstance().getPayNum(\"b401\")>0;\r\n        /**是否领取 */\r\n        rd.is_claimed=this.getClaimState(type,id)>0;\r\n        /**是否完成 */\r\n        switch(type){\r\n            case RabateType.Campaign:{\r\n                let finish=LevelManager.getInstance().finish_level;\r\n                let levelId=MissionLevelManager.getId(finish,1);\r\n                // rd.cur_num=MissionLevelManager.getInstance().getChapter(levelId)-1;\r\n                rd.cur_num=LevelManager.getInstance().getFinishChapter();\r\n                rd.need_num=CustomsClearanceRebateManager.getInstance().getCompleteChapter(id);\r\n                rd.is_complete=rd.cur_num>=rd.need_num;\r\n            }break;\r\n            case RabateType.Growth:{\r\n                rd.cur_num=UserData.getInstance().getUserLevel();\r\n                rd.need_num=LevelUpRebateManager.getInstance().getUnlockUserLevel(id);\r\n                rd.is_complete=rd.cur_num>=rd.need_num;\r\n            }break;\r\n        }\r\n        return rd;\r\n    }\r\n\r\n    public static getIsCanClaim(type:RabateType):boolean{\r\n        let num=0;\r\n        switch(type){\r\n            case RabateType.Campaign:{\r\n                num=CustomsClearanceRebateManager.getMaxRewardID();\r\n            }break;\r\n            case RabateType.Growth:{\r\n                num=LevelUpRebateManager.getMaxRewardID();\r\n            }break;\r\n        }\r\n        for(let i=1; i<=num; i++){\r\n            let rd=this.getRabateData(type,i);\r\n            if(rd.is_buy&&rd.is_complete&&!rd.is_claimed){\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    /**\r\n     * \r\n     * @param type 返利类型\r\n     * @returns 奖励数据\r\n     */\r\n    public static claimAll(type:RabateType):RewardData{\r\n        let num=0;\r\n        let rewardData=new RewardData();\r\n        //钻石\r\n        rewardData.reward_id=2;\r\n        switch(type){\r\n            case RabateType.Campaign:{\r\n                num=CustomsClearanceRebateManager.getMaxRewardID();\r\n            }break;\r\n            case RabateType.Growth:{\r\n                num=LevelUpRebateManager.getMaxRewardID();\r\n            }break;\r\n        }\r\n        for(let i=1; i<=num; i++){\r\n            let rd=this.claimOnce(type,i);;            \r\n            rewardData.reward_num+=rd.reward_num;\r\n        }\r\n        return rewardData;\r\n    }\r\n\r\n    public static claimOnce(type:RabateType,id:number):RewardData{\r\n        let rewardData=new RewardData();\r\n        //钻石\r\n        rewardData.reward_id=PropId.Gem;\r\n        let rd=this.getRabateData(type,id);\r\n        let rewardNum=0;        \r\n        if(rd.is_buy&&rd.is_complete&&!rd.is_claimed){\r\n            this.saveClaimState(type,id,1);\r\n            rewardNum = CustomsClearanceRebateManager.getInstance().getGetGem(id);\r\n            rewardData.reward_num=rewardNum;\r\n        }\r\n        return rewardData;\r\n    }\r\n    \r\n}"]}