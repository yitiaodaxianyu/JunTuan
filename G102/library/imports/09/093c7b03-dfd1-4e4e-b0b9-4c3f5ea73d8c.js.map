{"version":3,"sources":["assets\\Scripts\\GuaJi\\GuaJiPet.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,wEAAwE;AACxE,mBAAmB;AACnB,kFAAkF;AAClF,8BAA8B;AAC9B,kFAAkF;;;;;;;;;;;;;;;;;;;;;AAElF,sDAAqD;AACrD,sDAAsD;AACtD,+CAA0C;AAC1C,+CAA0C;AAIpC,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAAsC,4BAAY;IAAlD;QAAA,qEAsFC;QApFG,MAAM;QACN,WAAK,GAAa,IAAI,CAAC;QACvB,WAAW;QACX,gBAAU,GAAY,uBAAU,CAAC,IAAI,CAAC;QACtC,MAAM;QACN,kBAAY,GAAQ,CAAC,CAAC;QACtB,UAAU;QACV,mBAAa,GAAQ,IAAI,CAAC;QAC1B,aAAa;QACb,gBAAU,GAAS,EAAE,CAAC,EAAE,EAAE,CAAC;QAC3B,mBAAa,GAAS,IAAI,CAAC;;IA0E/B,CAAC;IAxEG,yBAAM,GAAN;QACI,IAAI,CAAC,UAAU,GAAC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC,WAAW,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;QACrH,IAAI,CAAC,KAAK,GAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC;QAC/C,IAAI,CAAC,SAAS,EAAE,CAAC;IACrB,CAAC;IAED;;;;;;OAMG;IACF,oCAAiB,GAAjB,UAAkB,IAAW,EAAC,MAAoB,EAAC,IAAkB,EAAC,WAAqB;QAA7D,uBAAA,EAAA,cAAoB;QAC/C,IAAI,KAAK,GAAC,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC,EAAC,IAAI,EAAC,MAAM,CAAC,CAAC;QACjD,IAAG,IAAI,EAAC;YACJ,IAAI,CAAC,KAAK,CAAC,qBAAqB,CAAC,KAAK,EAAC,UAAC,KAA0B,EAAE,KAAK;gBACrE,IAAG,KAAK,CAAC,IAAI,CAAC,IAAI,IAAE,IAAI,CAAC,IAAI,EAAC;oBAC1B,IAAI,CAAC,QAAQ,EAAE,CAAC;iBACnB;YACL,CAAC,CAAC,CAAA;SACL;QACD,IAAG,WAAW,EAAC;YACX,IAAI,CAAC,KAAK,CAAC,wBAAwB,CAAC,KAAK,EAAC,UAAC,KAA0B,EAAE,KAAK;gBACxE,KAAK,CAAC,QAAQ,GAAC,IAAI,CAAC;gBACpB,WAAW,EAAE,CAAC;YAClB,CAAC,CAAC,CAAA;SACL;IACL,CAAC;IAED,yBAAM,GAAN,UAAO,EAAS;QAEZ,IAAI,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;IACzB,CAAC;IAEO,8BAAW,GAAnB,UAAoB,EAAE;QAElB,IAAG,IAAI,CAAC,aAAa,IAAE,IAAI,EAC3B;YACI,IAAI,CAAC,YAAY,IAAE,EAAE,CAAC;YACtB,IAAG,IAAI,CAAC,YAAY,IAAE,IAAI,CAAC,aAAa,EACxC;gBACI,IAAI,QAAQ,GAAC,sBAAY,CAAC,WAAW,EAAE,CAAC,qBAAqB,CAAC,CAAC,EAAC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,EAAC,GAAG,CAAC,CAAC;gBAC7F,IAAG,QAAQ,EAAC;oBACR,MAAM;oBACN,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,YAAY,CAAC,sBAAY,CAAC,CAAC,UAAU,EAAE,CAAC,CAAC;iBACtE;aACJ;SACJ;IACL,CAAC;IAED,4BAAS,GAAT;QACI,IAAI,CAAC,iBAAiB,CAAC,WAAW,EAAC,IAAI,CAAC,CAAC;IAC7C,CAAC;IAED,2BAAQ,GAAR,UAAS,UAAkB;QAA3B,iBAgBC;QAfG,IAAI,CAAC,YAAY,GAAC,CAAC,CAAC;QACpB,IAAI,CAAC,aAAa,GAAC,KAAK,CAAC;QACzB,IAAI,IAAI,GAAC,IAAI,0BAAY,EAAE,CAAC;QAC5B,IAAI,CAAC,IAAI,GAAC,YAAY,CAAC;QACvB,IAAI,CAAC,QAAQ,GAAC;YACV,KAAK;YACL,IAAI,SAAS,GAAC,UAAU,CAAC,GAAG,CAAC,KAAI,CAAC,UAAU,CAAC,CAAC;YAC9C,IAAI,UAAU,GAAC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,EAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YACpD,MAAM;YACL,IAAI,IAAI,GAAC,sBAAY,CAAC,WAAW,EAAE,CAAC,gBAAgB,CAAC,KAAI,CAAC,UAAU,EAAC,UAAU,CAAC,CAAC;YACjF,KAAI,CAAC,aAAa,GAAC,IAAI,CAAC;QAC5B,CAAC,CAAA;QACD,IAAI,CAAC,iBAAiB,CAAC,aAAa,EAAC,KAAK,EAAC,IAAI,EAAC;YAC5C,KAAI,CAAC,SAAS,EAAE,CAAC;QACrB,CAAC,CAAC,CAAC;IACP,CAAC;IArFgB,QAAQ;QAD5B,OAAO;OACa,QAAQ,CAsF5B;IAAD,eAAC;CAtFD,AAsFC,CAtFqC,EAAE,CAAC,SAAS,GAsFjD;kBAtFoB,QAAQ","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport { Hero_State } from \"../Hero/Game/HeroConfig\";\r\nimport { KeyFrameData } from \"../Monster/MonsterData\";\r\nimport GuaJiManager from \"./GuaJiManager\";\r\nimport GuaJiMonster from \"./GuaJiMonster\";\r\n\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class GuaJiPet extends cc.Component {\r\n\r\n    //骨骼动画\r\n    spine:sp.Skeleton=null;    \r\n    /**英雄的状态 */\r\n    hero_state:Hero_State=Hero_State.idle;\r\n    //攻击计数\r\n    gongji_jishu:number=1;\r\n    /**攻击间隔 */\r\n    gongji_jiange:number=0.25;\r\n    /**子弹生成的位置 */\r\n    bullet_pos:cc.Vec2=cc.v2();\r\n    is_can_gongji:boolean=true;\r\n\r\n    onLoad () {\r\n        this.bullet_pos=this.node.getPosition().add(this.node.getChildByName('bullect').getPosition().mul(this.node.scaleY));\r\n        this.spine=this.node.getComponent(sp.Skeleton);\r\n        this.startIdle();\r\n    }\r\n\r\n    /**\r\n     * 播放一个骨骼动画\r\n     * @param name 骨骼动画名称\r\n     * @param isLoop 是否循环\r\n     * @param data 是否监听关键帧，关键帧数据包含关键帧名称，监听到关键帧后的回调\r\n     * @param endCallback 播放结束后的回调\r\n     */\r\n     playSpineAnimaton(name:string,isLoop:boolean=false,data?:KeyFrameData,endCallback?:Function){\r\n        let anima=this.spine.setAnimation(0,name,isLoop);\r\n        if(data){\r\n            this.spine.setTrackEventListener(anima,(entry: sp.spine.TrackEntry, event) =>{\r\n                if(event.data.name==data.name){\r\n                    data.callback();\r\n                }\r\n            })\r\n        }\r\n        if(endCallback){\r\n            this.spine.setTrackCompleteListener(anima,(entry: sp.spine.TrackEntry, event) =>{\r\n                anima.listener=null;\r\n                endCallback();\r\n            })\r\n        }\r\n    }\r\n\r\n    update(dt:number)\r\n    {              \r\n        this.checkAttack(dt);                \r\n    }\r\n\r\n    private checkAttack(dt)\r\n    {\r\n        if(this.is_can_gongji==true)\r\n        {\r\n            this.gongji_jishu+=dt;\r\n            if(this.gongji_jishu>=this.gongji_jiange)\r\n            {\r\n                let monsterS=GuaJiManager.getInstance().getMonstersForNearest(1,this.node.getPosition(),640);\r\n                if(monsterS){\r\n                    //开始攻击\r\n                    this.startAtt(monsterS[0].getComponent(GuaJiMonster).getJuJiPos());\r\n                }                             \r\n            }\r\n        }\r\n    }\r\n\r\n    startIdle(){\r\n        this.playSpineAnimaton(\"Side_Idle\",true);\r\n    }\r\n\r\n    startAtt(monsterPos:cc.Vec2){\r\n        this.gongji_jishu=0;\r\n        this.is_can_gongji=false;    \r\n        let data=new KeyFrameData();\r\n        data.name=\"OnDamaging\";\r\n        data.callback=()=>{\r\n            //正中心\r\n            let offsetPos=monsterPos.sub(this.bullet_pos);\r\n            let jianshiDir=Math.atan2(offsetPos.y,offsetPos.x);\r\n           //自动攻击\r\n            let node=GuaJiManager.getInstance().createPetBullect(this.bullet_pos,jianshiDir);\r\n            this.is_can_gongji=true;\r\n        }\r\n        this.playSpineAnimaton(\"Side_Attack\",false,data,()=>{\r\n            this.startIdle();\r\n        });\r\n    }\r\n}\r\n"]}