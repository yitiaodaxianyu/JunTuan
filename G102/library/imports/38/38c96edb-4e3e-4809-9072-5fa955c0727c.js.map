{"version":3,"sources":["assets\\Scripts\\Hero\\Game\\Bullect.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AACA,6CAA4C;AAC5C,oEAAiF;AACjF,iDAA4C;AAC5C,iDAA4C;AAE5C,mCAA8B;AAGxB,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAAqC,2BAAM;IAA3C;QAAA,qEA+LC;QA5LG,mBAAa,GAAW,IAAI,CAAC;QAC7B,UAAU;QACV,iBAAW,GAAS,IAAI,CAAC;QAEzB,oBAAc,GAAQ,CAAC,CAAC;QACxB,oBAAc,GAAQ,CAAC,CAAC;QACxB,gBAAU,GAAQ,GAAG,CAAC;QACtB,oBAAc,GAAQ,IAAI,CAAC,EAAE,GAAC,CAAC,CAAC;QAChC,iBAAW,GAAQ,EAAE,CAAC;QACtB,YAAM,GAAS,KAAK,CAAC;QACrB,qBAAe,GAAQ,EAAE,CAAC;QAE1B,gCAA0B,GAAU,IAAI,CAAC;QACzC,uBAAiB,GAAQ,CAAC,CAAC;QAC3B,uBAAiB,GAAQ,CAAC,CAAC;QAC3B,gBAAU,GAAQ,CAAC,CAAC;QACpB,0BAAoB,GAAU,IAAI,CAAC;QACnC,SAAS;QACT,kBAAY,GAAQ,CAAC,CAAC;QACtB,UAAU;QACV,kBAAY,GAAQ,CAAC,CAAC;QACtB,iBAAW,GAAQ,GAAG,CAAC;QACvB,oBAAoB;QACpB,kBAAY,GAAQ,CAAC,CAAC;;IAqK1B,CAAC;IAnKG,wBAAM,GAAN;QAEI,IAAI,CAAC,WAAW,GAAC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAC,CAAC,CAAC;IACxC,CAAC;IAED,sBAAI,GAAJ,UAAK,YAAyB,EAAC,KAAY,EAAC,GAAU,EAAC,MAAiB,EAAC,WAAqB,EAAC,YAAqB;QAA3C,4BAAA,EAAA,gBAAqB;QAAC,6BAAA,EAAA,gBAAqB;QAEhH,iBAAM,QAAQ,YAAC,MAAM,CAAC,CAAC;QACvB,IAAI,CAAC,cAAc,GAAC,YAAY,CAAC;QACjC,IAAI,CAAC,cAAc,GAAC,IAAI,CAAC,UAAU,GAAC,KAAK,CAAC;QAC1C,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;QACvB,IAAI,CAAC,MAAM,GAAC,KAAK,CAAC;QAClB,IAAI,CAAC,eAAe,GAAC,WAAW,CAAC;QACjC,IAAI,CAAC,iBAAiB,GAAC,YAAY,CAAC;QACpC,IAAI,CAAC,iBAAiB,GAAC,CAAC,CAAC;QACzB,IAAG,IAAI,CAAC,oBAAoB,EAAC;YACzB,IAAI,CAAC,oBAAoB,EAAE,CAAC;SAC/B;QACD,IAAG,IAAI,CAAC,aAAa,EAAC;YAClB,IAAI,CAAC,WAAW,GAAC,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YACpD,IAAI,CAAC,WAAW,CAAC,MAAM,GAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;YACzC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAC,CAAC,CAAC;YACnB,IAAI,CAAC,WAAW,GAAC,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,EAAE,CAAC,YAAY,CAAC,CAAC,QAAQ,CAAC;YACzE,IAAI,CAAC,YAAY,GAAC,CAAC,GAAC,IAAI,CAAC,WAAW,CAAC;SACxC;IACL,CAAC;IAED,uCAAqB,GAArB,UAAsB,QAAiB;QACnC,IAAI,CAAC,oBAAoB,GAAC,QAAQ,CAAC;IACvC,CAAC;IAES,2CAAyB,GAAnC,UAAoC,QAAiB;QACjD,IAAI,CAAC,0BAA0B,GAAC,QAAQ,CAAC;IAC7C,CAAC;IAEO,2BAAS,GAAjB,UAAkB,GAAU;QAExB,IAAI,CAAC,cAAc,GAAC,CAAC,GAAG,GAAC,IAAI,CAAC,EAAE,GAAC,CAAC,CAAC,GAAC,CAAC,IAAI,CAAC,EAAE,GAAC,CAAC,CAAC,CAAC;IACpD,CAAC;IAED,iCAAe,GAAf,UAAgB,QAAe;QAE3B,IAAG,QAAQ,IAAE,WAAW,IAAI,QAAQ,IAAE,YAAY,EAClD;YACI,IAAG,IAAI,CAAC,iBAAiB,GAAC,CAAC,EAAC;gBACxB,IAAI,CAAC,0BAA0B,CAAC,IAAI,CAAC,CAAA;aACxC;YACD,IAAI,CAAC,WAAW,EAAE,CAAC;SACtB;QACD,IAAG,QAAQ,IAAE,UAAU,EACvB;YACI,IAAG,IAAI,CAAC,iBAAiB,GAAC,CAAC,EAAC;gBACxB,IAAI,CAAC,0BAA0B,CAAC,IAAI,CAAC,CAAA;aACxC;YACD,IAAI,CAAC,WAAW,EAAE,CAAC;SACtB;IACL,CAAC;IACD,aAAa;IACb,4BAAU,GAAV,UAAW,EAAS;QAEhB,IAAI,EAAE,GAAC,qBAAW,CAAC,WAAW,EAAE,CAAC,WAAW,EAAE,CAAC;QAC/C,IAAG,EAAE,GAAC,CAAC,EAAC;YACJ,EAAE,GAAC,CAAC,CAAC;SACR;QACD,IAAI,QAAQ,GAAC,IAAI,CAAC,YAAY,GAAC,IAAI,CAAC,YAAY,GAAC,IAAI,CAAC,UAAU,GAAC,EAAE,GAAC,EAAE,CAAC;QACvE,IAAI,EAAE,GAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,GAAC,QAAQ,CAAC;QAC1D,IAAI,EAAE,GAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,GAAC,QAAQ,CAAC;QAC1D,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,EAAC,EAAE,CAAC,CAAC;IACxB,CAAC;IAED,4BAAU,GAAV;QACI,IAAI,QAAQ,GAAC,IAAI,CAAC,UAAU,GAAC,EAAE,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC;QACxD,IAAI,EAAE,GAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,GAAC,QAAQ,CAAC;QAC1D,IAAI,EAAE,GAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,GAAC,QAAQ,CAAC;QAC1D,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,EAAC,EAAE,CAAC,CAAC;IACxB,CAAC;IAED,yBAAO,GAAP,UAAQ,cAAqB;QACzB,IAAI,QAAQ,GAAC,IAAI,CAAC,UAAU,GAAC,EAAE,CAAC,QAAQ,CAAC,YAAY,EAAE,GAAC,cAAc,CAAC;QACvE,IAAI,EAAE,GAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,GAAC,QAAQ,CAAC;QAC1D,IAAI,EAAE,GAAC,IAAI,CAAC,IAAI,CAAC,CAAC,GAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,GAAC,QAAQ,CAAC;QAC1D,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE,EAAC,EAAE,CAAC,CAAC;IACxB,CAAC;IAED,wBAAM,GAAN,UAAQ,EAAE;QACN,IAAG,qBAAW,CAAC,WAAW,EAAE,CAAC,cAAc,IAAE,qBAAS,CAAC,YAAY;YACnE,OAAO;QACP,IAAI,CAAC,UAAU,IAAE,IAAI,CAAC,YAAY,GAAC,qBAAW,CAAC,WAAW,EAAE,CAAC,WAAW,EAAE,CAAC;QAC3E,IAAI,EAAE,GAAC,IAAI,CAAC,UAAU,GAAC,EAAE,GAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QACxD,IAAI,EAAE,GAAC,IAAI,CAAC,UAAU,GAAC,EAAE,GAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QACxD,IAAI,CAAC,IAAI,CAAC,CAAC,IAAE,EAAE,CAAC;QAChB,IAAI,CAAC,IAAI,CAAC,CAAC,IAAE,EAAE,CAAC;QAChB,IAAG,IAAI,CAAC,UAAU,GAAC,CAAC,EAAC;YACjB,IAAI,CAAC,IAAI,CAAC,KAAK,IAAE,IAAI,CAAC,UAAU,GAAC,EAAE,CAAC;SACvC;aAAI;YACD,IAAI,CAAC,IAAI,CAAC,KAAK,GAAC,GAAG,GAAC,IAAI,CAAC,cAAc,GAAC,IAAI,CAAC,EAAE,GAAC,IAAI,CAAC,eAAe,CAAC;SACxE;QACD,IAAG,IAAI,CAAC,iBAAiB,GAAC,CAAC,IAAE,IAAI,CAAC,iBAAiB,GAAC,IAAI,CAAC,iBAAiB,EAAC;YACvE,IAAI,QAAQ,GAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAC,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC;YAChC,IAAI,CAAC,iBAAiB,IAAE,QAAQ,CAAC;YACjC,IAAG,IAAI,CAAC,iBAAiB,IAAE,IAAI,CAAC,iBAAiB,EAAC;gBAC9C,IAAI,CAAC,0BAA0B,CAAC,IAAI,CAAC,CAAC;aACzC;SACJ;QACD,IAAG,IAAI,CAAC,IAAI,CAAC,CAAC,GAAC,EAAE,CAAC,OAAO,CAAC,MAAM,EAAC;YAC7B,IAAI,CAAC,WAAW,EAAE,CAAC;SACtB;QACD,IAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,GAAC,EAAE,CAAC,OAAO,CAAC,KAAK,EAAC;YACtC,IAAI,CAAC,WAAW,EAAE,CAAC;SACtB;QACD,IAAG,IAAI,CAAC,WAAW,EAAC;YAChB,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC,CAAC;SACrD;IACL,CAAC;IAED,6BAAW,GAAX;QAEI,IAAG,IAAI,CAAC,WAAW,EAAC;YAChB,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,UAAU,EAAE,CAAC,KAAK,EAAE,CAAC;YACxE,IAAI,CAAC,WAAW,GAAC,IAAI,CAAC;SACzB;QACD,uCAAkB,CAAC,WAAW,EAAE,CAAC,qBAAqB,CAAC,IAAI,CAAC,cAAc,EAAC,IAAI,CAAC,IAAI,CAAC,CAAC;IAC1F,CAAC;IAED,8BAAY,GAAZ,UAAa,GAAU;QAEnB,IAAI,CAAC,cAAc,GAAC,CAAC,GAAG,GAAC,IAAI,CAAC,EAAE,GAAC,CAAC,CAAC,GAAC,CAAC,IAAI,CAAC,EAAE,GAAC,CAAC,CAAC,CAAC;QAChD,IAAI,CAAC,IAAI,CAAC,KAAK,GAAC,GAAG,GAAC,GAAG,GAAC,IAAI,CAAC,EAAE,GAAC,IAAI,CAAC,eAAe,CAAC;IACzD,CAAC;IAED,kGAAkG;IAClG,kCAAgB,GAAhB,UAAiB,KAAiB,EAAC,IAAgB;QAC/C,IAAI,EAAE,GAAC,qBAAW,CAAC,WAAW,EAAE,CAAC;QACjC,IAAG,EAAE,CAAC,cAAc,IAAE,qBAAS,CAAC,SAAS,IAAI,IAAI,CAAC,MAAM,IAAE,IAAI;YAC1D,OAAO;QACX,IAAI,KAAK,GAAC,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC;QAC3B,QAAO,KAAK,EAAC;YACT,KAAK,OAAO;gBAAC;oBACT,IAAG,IAAI,CAAC,0BAA0B,EAAC;wBAC/B,IAAI,SAAS,GAAC,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,iBAAO,CAAC,CAAC;wBAC/C,IAAI,CAAC,MAAM,GAAC,IAAI,CAAC;wBACjB,IAAG,SAAS;4BACR,IAAI,CAAC,0BAA0B,CAAC,SAAS,CAAC,CAAC;qBAClD;iBACJ;gBAAA,MAAM;YACP,uBAAuB;YACvB,wBAAwB;YACxB,0BAA0B;YAC1B,qDAAqD;YACrD,oBAAoB;YACpB,qBAAqB;YACrB,2FAA2F;YAC3F,iEAAiE;YACjE,2FAA2F;YAC3F,oBAAoB;YACpB,6CAA6C;YAC7C,WAAW;YACX,UAAU;YACV,gCAAgC;YAChC,6CAA6C;YAC7C,UAAU;SACb;IACL,CAAC;IA3LD;QADC,QAAQ,CAAC,EAAC,IAAI,EAAC,EAAE,CAAC,MAAM,EAAC,CAAC;kDACE;IAHZ,OAAO;QAD3B,OAAO;OACa,OAAO,CA+L3B;IAAD,cAAC;CA/LD,AA+LC,CA/LoC,gBAAM,GA+L1C;kBA/LoB,OAAO","file":"","sourceRoot":"/","sourcesContent":["\r\nimport { GameState } from \"../../Constants\";\r\nimport { GameEffectId, GameEffectsManager } from \"../../Game/GameEffectsManager\";\r\nimport GameManager from \"../../GameManager\";\r\nimport Monster from \"../../Monster/Monster\";\r\nimport { GongJiData } from \"../Data/HeroData\";\r\nimport GongJi from \"./GongJi\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class Bullect extends GongJi {\r\n\r\n    @property({type:cc.Prefab})\r\n    prefab_tuowei:cc.Prefab=null;\r\n    /**拖尾节点 */\r\n    tuowei_node:cc.Node=null;\r\n\r\n    game_effect_id:number=0;\r\n    max_move_speed:number=0;\r\n    move_speed:number=700;\r\n    move_direction:number=Math.PI/2;\r\n    jiantou_dis:number=50;\r\n    is_att:boolean=false;\r\n    offset_xx_angle:number=90;\r\n\r\n    collision_monster_callback:Function=null;\r\n    max_move_distance:number=0;\r\n    cur_move_distance:number=0;\r\n    spin_speed:number=0;\r\n    init_finish_callback:Function=null;\r\n    /**加速度 */\r\n    acceleration:number=0;\r\n    /**拖尾身位 */\r\n    tuowei_space:number=1;\r\n    tuowei_time:number=0.5;\r\n    /**拖尾归1（原点位置）的身位数 */\r\n    tuowei_guiyi:number=1;\r\n\r\n    onLoad()\r\n    {\r\n        this.jiantou_dis=this.node.height/2;\r\n    }\r\n\r\n    init(gameEffectId:GameEffectId,speed:number,dir:number,gjData:GongJiData,offsetAngle:number=90,moveDistance:number=0)\r\n    {\r\n        super.initData(gjData);\r\n        this.game_effect_id=gameEffectId;\r\n        this.max_move_speed=this.move_speed=speed;\r\n        this.setDirection(dir);\r\n        this.is_att=false;        \r\n        this.offset_xx_angle=offsetAngle;\r\n        this.max_move_distance=moveDistance;\r\n        this.cur_move_distance=0;\r\n        if(this.init_finish_callback){\r\n            this.init_finish_callback();\r\n        }\r\n        if(this.prefab_tuowei){\r\n            this.tuowei_node=cc.instantiate(this.prefab_tuowei);\r\n            this.tuowei_node.parent=this.node.parent;\r\n            this.node.zIndex=1;\r\n            this.tuowei_time=this.tuowei_node.getComponent(cc.MotionStreak).fadeTime;\r\n            this.tuowei_guiyi=1/this.tuowei_time;\r\n        }\r\n    }\r\n\r\n    addInitFinishedListen(callback:Function){\r\n        this.init_finish_callback=callback;\r\n    }\r\n\r\n    protected addCollisionMonsterListen(callback:Function){\r\n        this.collision_monster_callback=callback;\r\n    }\r\n\r\n    private changeDir(dir:number)\r\n    {\r\n        this.move_direction=(dir+Math.PI*2)%(Math.PI*2);\r\n    }\r\n\r\n    collisionToWall(wallName:string)\r\n    {\r\n        if(wallName=='wall_left' || wallName=='wall_right')\r\n        {\r\n            if(this.max_move_distance>0){\r\n                this.collision_monster_callback(null)\r\n            }\r\n            this.destroySelf();\r\n        }\r\n        if(wallName=='wall_top')\r\n        {\r\n            if(this.max_move_distance>0){\r\n                this.collision_monster_callback(null)\r\n            }\r\n            this.destroySelf();            \r\n        }\r\n    }\r\n    /**获取下一帧位置 */\r\n    getNextPos(dt:number):cc.Vec2\r\n    {\r\n        let gr=GameManager.getInstance().getGameRate();\r\n        if(gr<1){\r\n            gr=1;\r\n        }\r\n        let distance=this.tuowei_space*this.tuowei_guiyi*this.move_speed*dt/gr;\r\n        let xx=this.node.x+Math.cos(this.move_direction)*distance;\r\n        let yy=this.node.y+Math.sin(this.move_direction)*distance;\r\n        return cc.v2(xx,yy);\r\n    }\r\n\r\n    getHeadPos():cc.Vec2{\r\n        let distance=this.move_speed*cc.director.getDeltaTime();\r\n        let xx=this.node.x+Math.cos(this.move_direction)*distance;\r\n        let yy=this.node.y+Math.sin(this.move_direction)*distance;\r\n        return cc.v2(xx,yy);\r\n    }\r\n\r\n    getAPos(offsetDistance:number):cc.Vec2{\r\n        let distance=this.move_speed*cc.director.getDeltaTime()-offsetDistance;\r\n        let xx=this.node.x+Math.cos(this.move_direction)*distance;\r\n        let yy=this.node.y+Math.sin(this.move_direction)*distance;\r\n        return cc.v2(xx,yy);\r\n    }\r\n\r\n    update (dt) {\r\n        if(GameManager.getInstance().cur_game_state!=GameState.Game_Playing)\r\n        return;\r\n        this.move_speed+=this.acceleration*GameManager.getInstance().getGameRate();\r\n        let xx=this.move_speed*dt*Math.cos(this.move_direction);\r\n        let yy=this.move_speed*dt*Math.sin(this.move_direction);\r\n        this.node.x+=xx;\r\n        this.node.y+=yy;\r\n        if(this.spin_speed>0){\r\n            this.node.angle+=this.spin_speed*dt;\r\n        }else{\r\n            this.node.angle=180*this.move_direction/Math.PI-this.offset_xx_angle;\r\n        }        \r\n        if(this.max_move_distance>0&&this.cur_move_distance<this.max_move_distance){\r\n            let distance=cc.v2(xx,yy).mag();\r\n            this.cur_move_distance+=distance;\r\n            if(this.cur_move_distance>=this.max_move_distance){\r\n                this.collision_monster_callback(null);\r\n            }\r\n        }\r\n        if(this.node.y>cc.winSize.height){\r\n            this.destroySelf();\r\n        }\r\n        if(Math.abs(this.node.x)>cc.winSize.width){\r\n            this.destroySelf();\r\n        }\r\n        if(this.tuowei_node){\r\n            this.tuowei_node.setPosition(this.getNextPos(dt));\r\n        }\r\n    }\r\n\r\n    destroySelf()\r\n    {\r\n        if(this.tuowei_node){\r\n            cc.tween(this.tuowei_node).delay(this.tuowei_time).removeSelf().start();\r\n            this.tuowei_node=null;\r\n        }\r\n        GameEffectsManager.getInstance().destroyGameEffectById(this.game_effect_id,this.node);\r\n    }\r\n\r\n    setDirection(dir:number)\r\n    {\r\n        this.move_direction=(dir+Math.PI*2)%(Math.PI*2);\r\n        this.node.angle=180*dir/Math.PI-this.offset_xx_angle;\r\n    }\r\n\r\n    ////--------------------------------------碰撞开始----------------------------------------------------\r\n    onCollisionEnter(other:cc.Collider,self:cc.Collider) {\r\n        let gm=GameManager.getInstance();        \r\n        if(gm.cur_game_state==GameState.Game_Lose || this.is_att==true)\r\n            return;\r\n        let group=other.node.group;\r\n        switch(group){\r\n            case 'enemy':{\r\n                if(this.collision_monster_callback){\r\n                    let monsterTs=other.node.getComponent(Monster);\r\n                    this.is_att=true;\r\n                    if(monsterTs)\r\n                        this.collision_monster_callback(monsterTs);\r\n                }\r\n            }break;\r\n            // case \"enemy_block\":{\r\n            //     this.is_att=true;\r\n            //     this.destroySelf();\r\n            //     // let gjData=other.node.getComponent(GongJi);\r\n            //     // //本次伤害直接减伤\r\n            //     // if(gjData){\r\n            //     //     this.monster_ts.jianshang_rate+=this.monster_ts.skill_data.getSkillValue1(1);\r\n            //     //     this.monster_ts.beFlashInjured(gjData.gongji_data);\r\n            //     //     this.monster_ts.jianshang_rate-=this.monster_ts.skill_data.getSkillValue1(1);\r\n            //     //     //直接销毁\r\n            //     //     gjData.node.removeFromParent();\r\n            //     // }\r\n            // }break;\r\n            // case 'wall':{                \r\n            //     this.collisionToWall(other.node.name);\r\n            // }break;\r\n        }\r\n    }\r\n}\r\n"]}