{"version":3,"sources":["assets\\Scripts\\UI\\home\\UserLevelUi.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { FuncType, GameScene, Go_Type } from \"../../Constants\";\r\nimport GameData from \"../../GameData\";\r\nimport GameManager from \"../../GameManager\";\r\nimport { FunctionDefinitionManager } from \"../../JsonData/FunctionDefinition\";\r\nimport { PlayerLevelUpManager } from \"../../JsonData/PlayerLevelUp\";\r\nimport LanguageManager from \"../../multiLanguage/LanguageManager\";\r\nimport { PropManager } from \"../../Prop/PropManager\";\r\nimport { PropId } from \"../../Prop/PropConfig\";\r\nimport { SoundIndex } from \"../../Sound/AudioConstants\";\r\nimport MyTool from \"../../Tools/MyTool\";\r\nimport UserData from \"../../UserData\";\r\nimport UIComponent from \"../UIComponent\";\r\n\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class UserLevelUi extends UIComponent {\r\n\r\n    // @property(cc.SpriteFrame)\r\n    // sp_kuang:cc.SpriteFrame=null;\r\n\r\n    @property(cc.SpriteAtlas)\r\n    atlas:cc.SpriteAtlas=null;\r\n\r\n    new_level:number=1;\r\n    new_exp:number=1;\r\n    total_level:number=1;\r\n    is_show_compelete:boolean=true;\r\n\r\n    start () {\r\n        this.node.getChildByName('bbg').on(cc.Node.EventType.TOUCH_END,this.destroySelf,this);\r\n        this.staring();\r\n        this.showLevel();     \r\n        \r\n        this.node.zIndex=2;\r\n    }\r\n\r\n    //星星之闪烁\r\n    staring(){\r\n        let starRoot=this.node.getChildByName(\"star_root\");\r\n        for(let i=0; i<starRoot.childrenCount; i++){\r\n            let node=starRoot.children[i];\r\n            let oldScale=node.scale;\r\n            let newScale=oldScale+Math.random()*0.5+0.2;\r\n            let act=Math.random()+0.5;\r\n            cc.tween(node).repeatForever(cc.tween().to(act,{scale:newScale}).to(act,{scale:oldScale})).start();\r\n        }\r\n    }\r\n\r\n    showLevel(){\r\n        //清算出可以升多少级\r\n        let remainExp=UserData.getInstance().getUserExp();\r\n        let curLevel=UserData.getInstance().getUserLevel();\r\n        let needExp=PlayerLevelUpManager.getInstance().getPlayerExpCost(curLevel);\r\n        let nextLevel=curLevel;\r\n        let maxLevel=PlayerLevelUpManager.getMaxPlayerLevel();\r\n        //let remainExp=allExp;\r\n        while(nextLevel<maxLevel&&remainExp>=needExp){\r\n            remainExp-=needExp;\r\n            nextLevel++;\r\n            needExp=PlayerLevelUpManager.getInstance().getPlayerExpCost(nextLevel);\r\n        }\r\n        \r\n        this.total_level=(nextLevel-curLevel);\r\n        this.new_level=curLevel+this.total_level;\r\n        let isMax=this.new_level>=maxLevel;\r\n        this.new_exp=remainExp;\r\n        let textRoot=this.node.getChildByName('text_root');\r\n        let nextLevelText=textRoot.getChildByName('nextLevel').getComponent(cc.Label);\r\n        let curLevelText=textRoot.getChildByName('curLevel').getComponent(cc.Label);\r\n        // let gemNumText=textRoot.getChildByName('gemNum').getComponent(cc.Label);\r\n        // gemNumText.string=''+10*this.total_level;\r\n        let item = PropManager.getInstance().createPropItem(PropId.Gem,10*this.total_level);\r\n        this.node.getChildByName(\"reward\").addChild(item);\r\n        item.setPosition(cc.v2(0,0));\r\n        if(isMax){\r\n            this.node.getChildByName('arrow').active=false;\r\n            this.node.getChildByName('bgl').active=false;\r\n            this.node.getChildByName('bgr').active=false;\r\n            textRoot.getChildByName('ygTx').active=false;\r\n            nextLevelText.node.active=false;\r\n        }else{\r\n            curLevelText.string=''+(curLevel);\r\n            nextLevelText.string=''+this.new_level;\r\n        }\r\n\r\n        //判断升级的区间内解锁的功能\r\n        let unlockList=new Array();\r\n        for(let type=FuncType.LiChengBei; type<FuncType.Num; type++){\r\n            let unlockLevel=FunctionDefinitionManager.getInstance().getUnlockCondictionParameter(type);\r\n            if(unlockLevel>curLevel&&unlockLevel<=this.new_level){\r\n                unlockList.push(type);\r\n            }\r\n        }\r\n        let len=unlockList.length;\r\n        let unlockIcon=this.node.getChildByName('unlockIcon');\r\n        let sroll=this.node.getChildByName(\"scroll\")\r\n        let content = sroll.getComponent(cc.ScrollView).content;\r\n        // let jiange=20;\r\n        // let isJi=unlockList.length%2?true:false;\r\n        // let centerIndex=Math.round(unlockList.length/2);        \r\n        //还需要判断当前解锁的是不是活动模块的功能\r\n        // let isCity=false;//214教程\r\n        // let touchPosCity=cc.v2(0,0);\r\n        // let isActivity=false;//224教程\r\n        // let touchPosActivity=cc.v2(0,0);\r\n        sroll.height=unlockIcon.height*len;\r\n        sroll.getChildByName('view').height=unlockIcon.height*len;\r\n        if(len>0){\r\n            //遍历\r\n            for(let i=1; i<=len; i++){\r\n                let type=unlockList[i-1];\r\n                let unlockItem=cc.instantiate(unlockIcon);\r\n                let icon=unlockItem.getChildByName('icon').getComponent(cc.Sprite);\r\n                icon.spriteFrame=this.atlas.getSpriteFrame(\"func\"+FunctionDefinitionManager.getIconIndex(type));\r\n                let iconName=unlockItem.getChildByName('iconName').getComponent(cc.Label);\r\n                let id=FunctionDefinitionManager.getInstance().getTextID(type);\r\n                iconName.string=LanguageManager.getInstance().getStrByTextId(id);\r\n                let goBtn=unlockItem.getComponent(cc.Button);\r\n                goBtn.clickEvents[0].customEventData=type+\"\";\r\n                content.addChild(unlockItem);\r\n                // this.node.addChild(unlockItem);\r\n                // let xx=0;\r\n                // if(isJi){\r\n                //     //奇数\r\n                //     xx=(i-centerIndex)*(unlockItem.width+jiange)\r\n                // }else{\r\n                //     //偶数\r\n                //     xx=(i-centerIndex)*(unlockItem.width+jiange)-(unlockItem.width+jiange)/2;\r\n                // }\r\n                // unlockItem.x=xx;                \r\n                // if(isActivity==false){\r\n                //     if(type==FuncType.WuJinTiaoZhan||type==FuncType.GeRenBoss||type==FuncType.ShiJieBoss||type==FuncType.PaTa){                    \r\n                //         isActivity=true;\r\n                //         touchPosActivity=cc.v2(xx,unlockItem.y-3);\r\n                //     }\r\n                // }\r\n                // if(isCity==false){\r\n                //     if(type==FuncType.ZhuangBeiHeCheng||type==FuncType.ChengBaoYangCheng||type==FuncType.TianFu){\r\n                //         isCity=true;\r\n                //         touchPosCity=cc.v2(xx,unlockItem.y-3);\r\n                //     }\r\n                // }                \r\n            }\r\n        }else{\r\n            this.node.getChildByName('bgr').active=false;\r\n            this.node.getChildByName('bgl').active=false;\r\n            textRoot.getChildByName('ygTx').active=false;\r\n        }\r\n        unlockIcon.active=false;\r\n        //教程\r\n        \r\n    }    \r\n\r\n    clickBtnGo(btn,index:string){\r\n        GameManager.getInstance().sound_manager.playSound(SoundIndex.click);\r\n        let type=parseInt(index);\r\n        if(this.is_show_compelete){\r\n            MyTool.allFadeOut(this.node,()=>{\r\n                this.goTo(type);\r\n            });\r\n        }\r\n    }\r\n\r\n    goTo(type:FuncType){\r\n        let goType=Go_Type.Main;\r\n        switch(type)\r\n        {\r\n            case FuncType.LiChengBei:{\r\n                goType=Go_Type.Main_Milestone;\r\n            } break;\r\n            case FuncType.GuaiWuTuJian:{\r\n                goType=Go_Type.Main_EnemyInfo;\r\n            } break;\r\n            case FuncType.ZhuanPan:{\r\n                goType=Go_Type.Main_Spin;\r\n            } break;\r\n            case FuncType.MeiRiRenWu:{\r\n                goType=Go_Type.Main_Task;\r\n            } break;\r\n            case FuncType.QianDao:{\r\n                goType=Go_Type.Main_Sign;\r\n            } break;\r\n            case FuncType.PaiHangBang:{\r\n                goType=Go_Type.Main_Rank;\r\n            } break;\r\n            case FuncType.ZhuangBeiHeCheng: {\r\n                goType=Go_Type.City;\r\n            } break;\r\n            case FuncType.GeRenBoss:\r\n            case FuncType.ShiJieBoss:\r\n            case FuncType.WuJinTiaoZhan:\r\n            case FuncType.MiGong:\r\n            case FuncType.PaTa:{\r\n                goType=Go_Type.Activity;\r\n            } break;\r\n            case FuncType.FanLi:\r\n            case FuncType.LiBao:\r\n            case FuncType.ZhanLing:\r\n            case FuncType.ZhouLiBao:\r\n            case FuncType.NeiGou:\r\n            case FuncType.FirstCharge:\r\n            {\r\n                goType=Go_Type.Main;\r\n            }break;\r\n            case FuncType.Shengtang:\r\n            case FuncType.XuYuanChi:\r\n            case FuncType.LongChao:\r\n            case FuncType.ShangDian:\r\n            case FuncType.TieJiangPu:\r\n            case FuncType.ChongWuXiTong:\r\n            {\r\n                goType=Go_Type.City;\r\n            }break;\r\n        }\r\n        GameManager.getInstance().game_to_home=goType;\r\n        if(GameManager.getInstance().cur_game_scene==GameScene.home){            \r\n            this.destroySelf();\r\n        }else{\r\n            GameManager.getInstance().backToHome();\r\n            this.destroySelf();\r\n        }\r\n    }\r\n\r\n    private startFly(node:cc.Node,num:number) {\r\n        if(GameManager.getInstance().cur_game_scene!=GameScene.home){\r\n            return;\r\n        }\r\n        let disPos=cc.v2(0,0)\r\n        let disNode=cc.find('Canvas/Top_Ui/top/iconGem');\r\n        let wordPos=disNode.parent.convertToWorldSpaceAR(disNode.getPosition());\r\n        let uiRoot=cc.find('Canvas/Ui_Root')\r\n        disPos=uiRoot.convertToNodeSpaceAR(wordPos);\r\n        let nodePos=node.getPosition();\r\n        \r\n        for(let i=0; i<num; i++){\r\n            let startPosX=Math.random()*300-200+nodePos.x;\r\n            let startPosY=Math.random()*300-200+nodePos.y;\r\n            let startPos=cc.v2(startPosX,startPosY)\r\n            let newNode=cc.instantiate(node);\r\n            newNode.setPosition(startPos);\r\n            uiRoot.addChild(newNode);\r\n            cc.tween(newNode).then(MyTool.getBezierAct(startPos,disPos)).removeSelf().start();\r\n            let num=newNode.getChildByName('num');\r\n            if(num){\r\n                num.active=false;\r\n            }\r\n        }                                  \r\n     }\r\n\r\n     destroySelf(){\r\n        if(this.is_show_compelete){\r\n            PropManager.getInstance().changePropNum(PropId.Gem,10*this.total_level);\r\n            UserData.getInstance().saveUserLevel(this.new_level);\r\n            UserData.getInstance().saveUserExp(this.new_exp);\r\n            GameManager.getInstance().refreshUserExpShow();\r\n            GameManager.getInstance().jumoAndShowUi();\r\n            MyTool.allFadeOut(this.node,()=>{\r\n                // this.startFly(this.node.getChildByName('kuang').getChildByName('icon'),10);\r\n                super.onClose();\r\n            });\r\n            // if(TutorailsManager.getInstance().isShowTutorials(224)){\r\n            //     TutorailsManager.getInstance().saveTutorials(224);\r\n            // }\r\n        }    \r\n     }\r\n}\r\n"]}